<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8">
    <title>How to Setup GPG+SSH in KDE</title>
    <meta name="description" content="When both GPG and SSH are integrated with KDE, it makes inter-operating with those systems very easy. It will make the difference between a loose-fitting glove, and one that fits snugly.  This quick tutorial will go over the steps on how to go about it. T...">
    <meta name="author"      content="Rommel Martinez">
    <meta name="keywords"    content="gpg, ssh, sysadmin">
    <meta name="viewport"    content="width=device-width, initial-scale=1.0">
    <link rel="icon"      href="/favicon.ico">
    <link rel="canonical" href="http://www.example.com/blog/2014/09/17/how-to-setup-gpg-ssh-in-kde/">
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/css/pygments.css">
    <link rel="stylesheet" type="text/css" href="/css/scribble.css">
    <link rel="stylesheet" type="text/css" href="/css/custom.css">
    <!-- Feeds -->
    <link ref="alternate" type="application/atom+xml"
          href="/feeds/all.atom.xml" title="Atom Feed">
    <link ref="alternate" type="application/rss+xml"
          href="/feeds/all.rss.xml" title="RSS Feed">
    <!-- JS -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-xxxxx']);
      _gaq.push(['_setDomainName', 'example.com']);
      _gaq.push(['_trackPageview']);
      setTimeout(function(){_gaq.push(['_trackEvent', '30_seconds', 'read'])}, 30000); // http://drawingablank.me/blog/fix-your-bounce-rate.html
      (function() {
          var ga = document.createElement('script');
          ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>
  <body>
    <!-- A standard Twitter Bootstrap nav bar -->
    <header class="navbar navbar-default navbar-inverse"
            role="banner">
      <div class="container">
        <div class="navbar-header">
          <button type="button"
                  class="navbar-toggle"
                  data-toggle="collapse"
                  data-target=".our-nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <!-- <a href="/index.html" class="navbar-brand">Home</a> -->
          <a href="/index.html" class="navbar-brand">#</a>
        </div>
        <div class="collapse navbar-collapse our-nav-collapse"
             role="navigation">
          <ul class="nav navbar-nav">

            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                Tags <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="/index.html">All Posts</a></li>

<li><a href="/tags/backups.html">backups</a></li>

<li><a href="/tags/emacs.html">emacs</a></li>

<li><a href="/tags/gpg.html">gpg</a></li>

<li><a href="/tags/mail.html">mail</a></li>

<li><a href="/tags/programming.html">programming</a></li>

<li><a href="/tags/racket.html">racket</a></li>

<li><a href="/tags/rants.html">rants</a></li>

<li><a href="/tags/scheme.html">scheme</a></li>

<li><a href="/tags/ssh.html">ssh</a></li>

<li><a href="/tags/sysadmin.html">sysadmin</a></li>

<li><a href="/tags/web.html">web</a></li>
              </ul>
            </li>
            <li>
              <a href="/About.html">About</a>
            </li> 
            <li><a href="/feeds/all.atom.xml">Atom</a></li>
            <li><a href="/feeds/all.rss.xml">RSS</a></li>
          </ul>
        </div>
    </header>
    <div class="container">
      <div class="row">

        <!-- Main column -->
        <div id="content" class="col-md-12">





          <article>
  <header>
    <h1>How to Setup GPG+SSH in KDE</h1>

<p class="date-and-tags">
 <time datetime="2014-09-17" pubdate="true">2014-09-17</time> :: <span class="tags"><a href="/tags/gpg.html">gpg</a>, <a href="/tags/ssh.html">ssh</a>, <a href="/tags/sysadmin.html">sysadmin</a></span></p>
  </header>

<p>When both GPG and SSH are integrated with KDE, it makes inter-operating with those systems very easy. It will make the difference between a loose-fitting glove, and one that fits snugly.</p>

<p>This quick tutorial will go over the steps on how to go about it. To accommodate everyone, I&rsquo;ll still go about how to install and configure all the necessary components.</p>
<!-- more-->

<h1 id="prerequisites">Prerequisites</h1>

<p>Chances are, you already have both GPG and SSH installed on your system. But if you don&rsquo;t have them, you can install them with:</p>

<pre><code>sudo apt-get install gnupg2 ssh</code></pre>

<p>Another important software that we need to install is pinentry:</p>

<pre><code>sudo apt-get install pinentry-qt4</code></pre>

<p>It&rsquo;s the component that prompts the user for passphrases.</p>

<h1 id="configure-ssh">Configure SSH</h1>

<p>Now that we have the parts in front of us, it&rsquo;s time to assemble them. The first thing that we need to do (although in reality the files that we are going to open in this section can be done in any order that you wish), is create your SSH keys:</p>

<pre><code>ssh-keygen -t rsa</code></pre>

<p><strong>DO NOT</strong> leave the passphrase empty. Shoot yourself first in the  head, if you really want to.</p>

<p>The above command will create two files: 1) your public key, and 2) your private key. I need not tell you what they are because you know what they are already. Am I right?</p>

<pre><code>~/.ssh/id_rsa.pub
~/.ssh/id_rsa</code></pre>

<p>At this point, copy your SSH keys to the servers that you manage:</p>

<pre><code>ssh-copy-id user@host</code></pre>

<h1 id="configure-gpg">Configure GPG</h1>

<p>In case you forgot how to your keys, the command is:</p>

<pre><code>gpg2 --gen-key</code></pre>

<p>I should have this earlier, that if you want to create strong passphrases, use the <a href="http://world.std.com/~reinhold/diceware.html">Diceware method</a>. An <a href="https://xkcd.com/936/">XKCD comic</a> was written in case you&rsquo;re wondering what it is, without reading the earlier link.</p>

<p>Next thing to do is edit the main GPG config file:</p>

<pre><code>emacs ~/.gnupg/gpg.conf</code></pre>

<p>Find the line that contains <code>use-agent</code> and uncomment it, if it is commented. If that line does not exist just put <code>use agent</code> at the end.</p>

<p>We need to edit the agent file next:</p>

<pre><code>emacs ~/.gnupg/gpg-agent.conf</code></pre>

<p>Then put the following lines:</p>

<pre><code>no-grab
default-cache-ttl 10800
default-cache-ttl-ssh 10800
pinentry-program /usr/bin/pinentry-qt4</code></pre>

<p>Those are <em>my</em> preferred values. If you want to change them, look at the manpage first:</p>

<pre><code>man gpg-agent</code></pre>

<h1 id="configure-kde">Configure KDE</h1>

<p>We now need to link the GPG agent with KDE. We&rsquo;re going to create a <em>startup</em> script for KDE that will invoke the GPG agent at startup. We&rsquo;ll also tell the GPG agent to enable SSH support (in the old days, the SSH agent has to be ran separately from GPG).</p>

<pre><code>mkdir ~/.kde/env
emacs ~/.kde/env/01_gpg-agent.sh</code></pre>

<p>Then put in the following lines:</p>

<pre><code>#!/bin/sh

killall gpg-agent
eval `gpg-agent --enable-ssh-support --daemon`</code></pre>

<p>Make it executable:</p>

<pre><code>chmod +x ~/.kde/env/01_gpg-agent.sh</code></pre>

<p>Finally, we&rsquo;ll create the <em>shutdown</em> script for the GPG agent:</p>

<pre><code>mkdir ~/.kde/shutdown
emacs ~/.kde/shutdown/01_gpg-agent.sh</code></pre>

<p>Then put in the following lines:</p>

<pre><code>#!/bin/sh

killall gpg-agent</code></pre>

<p>Also make it executable:</p>

<pre><code>chmod +x ~/.kde/shutdown/01_gpg-agent.sh</code></pre>

<h1 id="verification">Verification</h1>

<p>Unfortunately, we have to restart our KDE session to take these settings into effect. If you how to make them work, without logging out, please let me know in the comments below.</p>

<p>Press <code>Ctrl+Alt+Del</code> to logout, then login with your account.</p>

<p>Open a Konsole window, then connect to your favorite SSH server:</p>

<pre><code>ssh user@remotehost</code></pre>

<p>A pinentry dialog box should appear prompting you for your passphrase. This passphrase will be cached according to your settings in <code>~/.gnupg/gpg-agent.conf</code>. Subsequent SSH connection attempts will not prompt you for the passphrase within this timeout period.</p>

<p>A similar behavior will happen if you encrypt a file with GPG:</p>

<pre><code>gpg2 -s -e -a -r john@remotehost file.dat</code></pre>

<h1 id="conclusion">Conclusion</h1>

<p>The steps outline above are meant to be succinct without going through the gory details. I avoided reiterating what was already said before so as not to bore you to death. If you found this useful, feel free to comment below.</p>
  <footer>
    <script type="text/javascript">
      !function(d,s,id){
          var js,fjs=d.getElementsByTagName(s)[0];
          if(!d.getElementById(id)){
              js=d.createElement(s);
              js.id=id;
              js.src="//platform.twitter.com/widgets.js";
              fjs.parentNode.insertBefore(js,fjs);
          }
      }(document,"script","twitter-wjs");
    </script>
    <a href="https://twitter.com/share"
       class="twitter-share-button"
       data-url="http://www.example.com/blog/2014/09/17/how-to-setup-gpg-ssh-in-kde/"
       data-dnt="true">
      "Tweet"</a>
    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>
    <g:plusone size="medium" href="http://www.example.com/blog/2014/09/17/how-to-setup-gpg-ssh-in-kde/"></g:plusone>
    <script type="text/javascript">
      var disqus_shortname = 'ebzzry';
      (function() {
          var dsq = document.createElement('script');
          dsq.type = 'text/javascript';
          dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
    </script>
    <div id="disqus_thread"></div>
    <ul class="pager">

    <li class="next">
      <a href="/blog/2014/02/21/an-introduction-to-ugarit/"><em>An Introduction to Ugarit</em> &rarr;</a>
    </li>
    </ul>
  </footer>
</article>
        </div>
      </div>
      <footer>
        <hr />
        <p><a href="https://twitter.com/ebzzry"
              class="twitter-follow-button"
              data-show-count="false"
              data-lang="en">
             "Follow Rommel"
           </a>
           <script type="text/javascript">
             !function(d,s,id){
                 var js,fjs=d.getElementsByTagName(s)[0];
                 if(!d.getElementById(id)){
                     js=d.createElement(s);
                     js.id=id;
                     js.src="//platform.twitter.com/widgets.js";
                     fjs.parentNode.insertBefore(js,fjs);
                 }
             }(document,"script","twitter-wjs");
           </script></p>
        <p>Site created with
          <a href="http://www.racket-lang.org">Racket</a>,
          <a href="http://github.com/greghendershott/frog">Frog</a>,
          <a href="http://www.gnu.org/software/emacs/">Emacs</a>, and
          <a href="http://twitter.github.io/bootstrap">Bootstrap</a></p>
        <p><em>Copyright &copy; by <a href="http://rmm.meta.ph">Rommel M. Martinez</a></em></p>
      </footer>
    </div>
    <!-- </body> JS -->
    <script type="text/javascript" src="//code.jquery.com/jquery.js"></script>
    <script type="text/javascript" src="/js/bootstrap.min.js"></script>
  </body>
</html>