<html><head><title>Emacs and Hacks (Part 2)</title><meta charset="utf-8" /><meta content="width=device-width, initial-scale=1.0, user-scalable=yes" name="viewport" /><link href="static/ico/apple-touch-icon-57x57.png" rel="apple-touch-icon" sizes="57x57" /><link href="static/ico/apple-touch-icon-60x60.png" rel="apple-touch-icon" sizes="60x60" /><link href="static/ico/apple-touch-icon-72x72.png" rel="apple-touch-icon" sizes="72x72" /><link href="static/ico/apple-touch-icon-76x76.png" rel="apple-touch-icon" sizes="76x76" /><link href="static/ico/apple-touch-icon-114x114.png" rel="apple-touch-icon" sizes="114x114" /><link href="static/ico/apple-touch-icon-120x120.png" rel="apple-touch-icon" sizes="120x120" /><link href="static/ico/apple-touch-icon-144x144.png" rel="apple-touch-icon" sizes="144x144" /><link href="static/ico/apple-touch-icon-152x152.png" rel="apple-touch-icon" sizes="152x152" /><link href="static/ico/apple-touch-icon-180x180.png" rel="apple-touch-icon" sizes="180x180" /><link href="static/ico/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" /><link href="static/ico/favicon-194x194.png" rel="icon" sizes="194x194" type="image/png" /><link href="static/ico/favicon-96x96.png" rel="icon" sizes="96x96" type="image/png" /><link href="static/ico/android-chrome-192x192.png" rel="icon" sizes="192x192" type="image/png" /><link href="static/ico/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" /><link href="static/ico/manifest.json" rel="manifest" /><link href="static/ico/favicon.ico" rel="shortcut icon" /><meta content="#da532c" name="msapplication-TileColor" /><meta content="static/ico/mstile-144x144.png" name="msapplication-TileImage" /><meta content="static/ico/browserconfig.xml" name="msapplication-config" /><meta content="#ffffff" name="theme-color" /><link href="static/ico/glider.ico" rel="icon" type="image/x-icon" /><link href="static/css/main.css" media="all" rel="stylesheet" /><link href="static/css/ewan.css" media="all" rel="stylesheet" /><script src="static/js/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="content"><h1>Emacs and Hacks (Part 2)</h1><p><center>2015-06-12 06:30:00</center></p><p>This is second part of my Emacs tips series. The contents of this post are written in no particular order. It explores session management, packages, managing indents, and other things.</p><h2>Desktop</h2><p>An indispensable tool that I use now is desktop. It saves the state of my Emacs session, so that in the event of crash, power outage, or anything that will make me lose my session, I can back to it. Desktop comes built-in with the recent versions of GNU Emacs. Here's my snippet:</p><pre><code class="lisp">&#40;require 'desktop&#41;

&#40;desktop-save-mode&#41;

&#40;setq desktop-dirname &quot;&#126;/.emacs.d&quot;
      desktop-base-file-name &quot;desktop&quot;
      desktop-base-lock-name &quot;desktop.lock&quot;
      desktop-restore-frames t
      desktop-restore-reuses-frames t
      desktop-restore-in-current-display t
      desktop-restore-forces-onscreen t&#41;

&#40;defun desktop-save &#40;&#41;
  &#40;interactive&#41;
  &#40;if &#40;eq &#40;desktop-owner&#41; &#40;emacs-pid&#41;&#41;
      &#40;desktop-save desktop-dirname&#41;&#41;&#41;
</code></pre><h2>Savehist</h2><p>Another important functionality that I use is savehist. It saves the minibuffer history. It's roughly similar to saving the command line history. Here's my snippet</p><pre><code class="lisp">&#40;savehist-mode t&#41;

&#40;setq savehist-file &quot;&#126;/.emacs.d/savehist&quot;&#41;
</code></pre><h2>Consolidation</h2><p>No, that is not the name of the library. There are a lot of times, when I want to manually save the state of as much session information that I could save. I'd want to save the buffers, minibuffer history, bookmarks, and comint mode histories. To do that, I have the following:</p><pre><code class="lisp">&#40;defun save-defaults &#40;&#41;
  &#40;desktop-save desktop-dirname&#41;
  &#40;savehist-save&#41;
  &#40;bookmark-save&#41;&#41;

&#40;defun save-histories &#40;&#41;
  &#40;let &#40;&#40;buf &#40;current-buffer&#41;&#41;&#41;
    &#40;save-excursion
      &#40;dolist &#40;b &#40;buffer-list&#41;&#41;
        &#40;switch-to-buffer b&#41;
        &#40;save-history&#41;&#41;&#41;
    &#40;switch-to-buffer buf&#41;&#41;&#41;

&#40;defun save &#40;&#41;
  &#40;interactive&#41;
  &#40;save-desktop&#41;
  &#40;save-defaults&#41;
  &#40;save-histories&#41;&#41;
</code></pre><p>This gives you a nice:</p><pre><code>M-x save RET
</code></pre><h2>Packages</h2><h3>ELPA</h3><p>If you aren't using the package system yet, use it now. All you need to get started is the following:</p><pre><code class="lisp">&#40;require 'package&#41;

&#40;setq package-archives
      '&#40;&#40;&quot;gnu&quot; . &quot;http://elpa.gnu.org/packages/&quot;&#41;
        &#40;&quot;marmalade&quot; . &quot;http://marmalade-repo.org/packages/&quot;&#41;
        &#40;&quot;melpa&quot; . &quot;http://melpa.milkbox.net/packages/&quot;&#41;&#41;&#41;

&#40;package-initialize&#41;

&#40;defalias 'pi 'package-install&#41;
&#40;defalias 'pl 'package-list-packages&#41;
</code></pre><p>To list all the available packages, hit:</p><pre><code>M-x pl RET
</code></pre><p>If you know the name of package, hit:</p><pre><code>M-x pi RET package RET
</code></pre><h3>use-package</h3><p>This one is a real gem. It's like <code>require</code>, but on steroids. When "requiring" a package, you have the option to specify to install that package, if it does not exist, yet. It also enables you to configure that package, in a unified expression. But unlike <code>require</code>, <code>use-package</code> does not come built-in with Emacs. You need to install it via <code>package-install</code>:</p><pre><code>M-x pi RET use-package RET
</code></pre><p>You can then require it, on subsequent uses:</p><pre><code class="lisp">&#40;require 'use-package&#41;
</code></pre><p>To install <code>markdown-mode</code>, even if it doesn't exist yet, and configure its related options, after loading it, have:</p><pre><code class="lisp">&#40;use-package markdown-mode
    :ensure t
    :config
    &#40;progn
      &#40;push '&#40;&quot;\\.text\\'&quot; . markdown-mode&#41; auto-mode-alist&#41;
      &#40;push '&#40;&quot;\\.markdown\\'&quot; . markdown-mode&#41; auto-mode-alist&#41;
      &#40;push '&#40;&quot;\\.md\\'&quot; . markdown-mode&#41; auto-mode-alist&#41;&#41;&#41;
</code></pre><h2>Line Numbers</h2><p>I really like to have the line numbers displayed at the left margin. It gives me a rough idea how big the file is, and where am I currently. Turning on <code>linum-mode</code> achieves it:</p><pre><code class="lisp">&#40;setq linum-format &quot;%4d&quot;&#41;

&#40;defun my-linum-mode-hook &#40;&#41;
  &#40;linum-mode t&#41;&#41;

&#40;add-hook 'find-file-hook 'my-linum-mode-hook&#41;
</code></pre><h2>Timestamps</h2><p>I frequently find the need to insert timestamps, especially when I'm editing my daily log file. Here are some snippets to help you with it:</p><pre><code class="lisp">&#40;defun format-date &#40;format&#41;
  &#40;let &#40;&#40;system-time-locale &quot;en&#95;US.UTF-8&quot;&#41;&#41;
    &#40;insert &#40;format-time-string format&#41;&#41;&#41;&#41;

&#40;defun insert-date &#40;&#41;
  &#40;interactive&#41;
  &#40;format-date &quot;%A, %B %d %Y&quot;&#41;&#41;

&#40;defun insert-date-and-time &#40;&#41;
  &#40;interactive&#41;
  &#40;format-date &quot;%Y-%m-%d %H:%M:%S&quot;&#41;&#41;
</code></pre><p>The code above sets the correct value for <code>system-time-locale</code>, and binds keys for <code>insert-date/long</code> and <code>insert-date/short</code>.</p><h2>Keys</h2><p>When your key bindings are not organized, it's not easy to find what key did you bind to what. Fortunately, you have <code>bind-key</code>, which comes as part of <code>use-package</code>.</p><p>An example would look like:</p><pre><code class="lisp">&#40;bind-keys
 :map global-map
 &#40;&quot;C-;&quot; . eval-expression&#41;
 &#40;&quot;C-j&quot; . delete-indentation&#41;&#41;
</code></pre><h2>Newline Sans Indent</h2><p>This command creates a newline, then moves the cursor. It simulates a behavior wherein the new line doesn't indent.</p><pre><code class="lisp">&#40;defun newline-and-no-indent &#40;&amp;optional arg&#41;
  &#40;interactive &quot;p&quot;&#41;
  &#40;open-line arg&#41;
  &#40;next-line arg&#41;&#41;
</code></pre><h2>Fills</h2><p>This snippet works great when working when working with plain text. It indent a paragraph, or the current paragraph context. If there is a mark, the region becomes filled.</p><pre><code class="lisp">&#40;defun fill-region-or-paragraph &#40;&#41;
  &#40;interactive&#41;
  &#40;if &#40;region-active-p&#41;
      &#40;fill-region&#41;
      &#40;fill-paragraph&#41;&#41;&#41;
</code></pre><h2>Pasting</h2><p>Emacs, by default, pastes (yanks) from the secondary, or clipboard selection. This command yanks from the primary selection â€” mouse highlights.</p><pre><code class="lisp">&#40;defun yank-primary &#40;&#41;
  &#40;interactive&#41;
  &#40;insert-for-yank &#40;x-get-selection 'PRIMARY&#41;&#41;&#41;
</code></pre><h2>Cursor Movement</h2><p>The command <code>move-to-window-line-top-bottom</code>, bound by default to <kbd>M-r</kbd> is great when you want to move the cursor from the center, top, and bottom position, relative to the window, similar to Vim's <kbd>H</kbd>, <kbd>M</kbd>, and <kbd>L</kbd> commands. However, it's not very efficient when specifically targetting areas of the screen. The commands below position point, specifically to the top, center, and bottom window positions, respectively.</p><pre><code class="lisp">&#40;defun move-to-window-line-top &#40;&#41;
  &#40;interactive&#41;
  &#40;move-to-window-line 0&#41;&#41;

&#40;defun move-to-window-line-center &#40;&#41;
  &#40;interactive&#41;
  &#40;move-to-window-line nil&#41;&#41;

&#40;defun move-to-window-line-bottom &#40;&#41;
  &#40;interactive&#41;
  &#40;move-to-window-line -1&#41;&#41;
</code></pre><h2>Git Status in Dired</h2><p>This small snippet gives visual indications of the status of git-managed files in a Dired buffer. Pressing <kbd>g</kbd> reloads the buffer, then updates the status.</p><pre><code class="lisp">&#40;use-package dired-k
    :ensure t
    :config
  &#40;progn
    &#40;add-hook 'dired-initial-position-hook 'dired-k&#41;&#41;&#41;
</code></pre><h2>Key Bindings</h2><p>The key bindings for the commands above, are listed below:</p><pre><code class="lisp">&#40;bind-keys
 :map global-map
 &#40;&quot;C-c d&quot;   . insert-date&#41;
 &#40;&quot;C-c C-d&quot; . insert-date-and-time&#41;
 
 &#40;&quot;S-&lt;return&gt;&quot; . newline-and-no-indent&#41;

 &#40;&quot;M-q&quot; . fill-region-or-paragraph&#41;

 &#40;&quot;C-M-y&quot; . yank-primary&#41;

 &#40;&quot;M-1&quot; . move-to-window-line-top&#41;
 &#40;&quot;M-2&quot; . move-to-window-line-center&#41;
 &#40;&quot;M-3&quot; . move-to-window-line-bottom&#41;&#41;

&#40;bind-keys
 :map dired-mode-map
 &#40;&quot;K&quot; . dired-k&#41;
 &#40;&quot;g&quot; . dired-k&#41;&#41;
</code></pre><h2>Conclusion</h2><p>In this post, it was demonstrated that small tweaks can generate huge benefits.</p><p>The rest of the configuration can be found at <a href="https://github.com/ebzzry/dotemacs">https://github.com/ebzzry/dotemacs</a>. If you an Emacs hack to share, send a pull request.</p><hr/><div style='text-align: center'><p style='font-size: small'><a href='index.html'>Home</a> Â· <a href='about.html'>About</a> Â· <a href='quotes.html'>Quotes</a> Â· <a href='https://github.com/ebzzry/ebzzry.github.io'>Source</a></p><p style='font-size: x-small'>Site created with <a href='https://github.com/ebzzry/emem'>emem</a><br />Copyright Â© Rommel M. Martinez</p></div></div></body></html>