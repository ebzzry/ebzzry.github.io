<!DOCTYPE html>
<html lang="en"><head><title>A Gentle Introduction to Non-determinism in Scheme</title><meta charset="utf-8" /><meta content="width=device-width,initial-scale=1.0,user-scalable=yes" name="viewport" /><meta content="noodp,noydir" name="robots" /><link rel='apple-touch-icon' sizes='180x180' href='/images/ico/apple-touch-icon.png'><link rel='icon' type='image/png' sizes='32x32' href='/images/ico/favicon-32x32.png'><link rel='icon' type='image/png' sizes='16x16' href='/images/ico/favicon-16x16.png'><link rel='manifest' href='/images/ico/site.webmanifest'><link rel='mask-icon' href='/images/ico/safari-pinned-tab.svg' color='#5bbad5'><link rel='shortcut icon' href='/images/ico/favicon.ico'> <meta name='msapplication-TileColor' content='#da532c'> <meta name='msapplication-config' content='/images/ico/browserconfig.xml'> <meta name='theme-color' content='#ffffff'><meta content="A Gentle Introduction to Non-determinism in Scheme" name="description" /><meta content="non-determinism, scheme, lisp, current continuation, continuation, call/cc, amb, choice, choose" name="keywords" /><meta content="A Gentle Introduction to Non-determinism in Scheme" property="og:title" /><meta content="article" property="og:type" /><meta content="https://ebzzry.com/en/amb/" property="og:url" /><meta content="https://ebzzry.com/images/ico/android-chrome-512x512.png" property="og:image" /><style media="all" type="text/css">html {    color: #333;    font-size: 1em;    font-family: Georgia, Cambria, Palatino, "Palatino Linotype", "Times New Roman", Times, serif;    line-height: 1.45;    text-align: left:    width: 100%;    max-width: 40em;    margin: 0 auto 0 auto;    padding: 0;}body {    border-top: hidden;    border-bottom: hidden;    padding: 0 1.5em 1em 1.5em;    margin: 0;}#content {    -webkit-column-count: 1;    -moz-column-count: 1;    column-count: 1;}code {    font-size: 0.9em;    font-family: "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Lucida Console", "Courier New", Courier, monospace;    color: black;    display: inline-block;    font-weight: bold;}pre code {    font-size: 1em;    font-family: monospace;    line-height: 1.3em;    overflow: auto;    font-weight: normal;}kbd {    font-size: 1.1em;    padding: 0.1em 0.6em;    border: 1px solid #ccc;    font-family: monospace;    background-color: #f7f7f7;    color: #333;    -moz-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    -webkit-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    -moz-border-radius: 3px;    -webkit-border-radius: 3px;    border-radius: 3px;    display: inline-block;    margin: 0 0.1em;    text-shadow: 0 1px 0 #fff;    white-space: nowrap;}h1, h2, h3, h4, h5, h6 {    font-family: Calibri, "Gill Sans", "Gill Sans MT", "Myriad Pro", Myriad, "DejaVu Sans", Tahoma, Geneva, Helvetica, Arial, sans-serif;    margin-bottom: 0;}h1 {    font-size: 2.5em;    text-align: center;    border-bottom: 6px solid black;}h2 {    font-size: 2.0em;    text-align: left;    border-bottom: 2px solid black;}h3 {    font-size: 1.6em;    text-align: left;    border-bottom: 1px solid lightgrey;}h4 {    font-size: 1.5em;    text-align: left;}h5 {    font-size: 1.3em;    text-align: left;}ul, ol {    padding-left: 2em;}ul li {    list-style-type: square;}ul li li {    list-style-type: disc;}ul li li li {    list-style-type: circle;}ol li {    list-style-type: decimal;}p, para, b, strong, i, em, emph {    font-size: 1em;}blockquote {    font-size: 1.2em;    font-style: italic;    margin-left: 2em;}b, strong {    font-weight: bold;}i, em, emph {    font-style: italic;}table {    margin: 0.5em;    border-spacing: 0;    border-collapse: collapse;}th, td {    border: 1px solid lightgray;    padding-top: 0;    padding-bottom: 0;    padding-left: 0.45em;    padding-right: 0.45em;}.text-right {    text-align: right;}.text-small {    font-size: small;}.text-x-small {    font-size: x-small;}.banner {    display: block;    width: 100%;    margin-left: auto;    margin-right: auto;}.footer {    text-align: right;    float: right;    max-width: 18em;}.cc {    border-width: 0}.center {    text-align: center;}</style><style media="all" type="text/css">html { max-width: 50em; }</style><style media="all" type="text/css">/* Ewan Themes -- based 99.99% from Tomorrow Night Theme *//* http://jmblog.github.com/color-themes-for-google-code-highlightjs *//* Original theme - https://github.com/chriskempson/tomorrow-theme *//* http://jmblog.github.com/color-themes-for-google-code-highlightjs *//* Tomorrow Comment */.hljs-comment {  color: #969896;}/* Tomorrow Red */.hljs-variable,.hljs-attribute,.hljs-tag,.hljs-regexp,.ruby .hljs-constant,.xml .hljs-tag .hljs-title,.xml .hljs-pi,.xml .hljs-doctype,.html .hljs-doctype,.css .hljs-id,.css .hljs-class,.css .hljs-pseudo {  color: #cc6666;}/* Tomorrow Orange */.hljs-number,.hljs-preprocessor,.hljs-pragma,.hljs-built_in,.hljs-literal,.hljs-params,.hljs-constant {  color: #de935f;}/* Tomorrow Yellow */.ruby .hljs-class .hljs-title,.css .hljs-rule .hljs-attribute {  color: #f0c674;}/* Tomorrow Green */.hljs-string,.hljs-value,.hljs-inheritance,.hljs-header,.hljs-name,.ruby .hljs-symbol,.xml .hljs-cdata {  color: #b5bd68;}/* Tomorrow Aqua */.hljs-title,.css .hljs-hexcolor {  color: #8abeb7;}/* Tomorrow Blue */.hljs-function,.python .hljs-decorator,.python .hljs-title,.ruby .hljs-function .hljs-title,.ruby .hljs-title .hljs-keyword,.perl .hljs-sub,.javascript .hljs-title,.coffeescript .hljs-title {  color: #81a2be;}/* Tomorrow Purple */.hljs-keyword,.javascript .hljs-function {  color: #b294bb;}.hljs {  display: block;  overflow-x: auto;  background: #1d1f21;  color: #c5c8c6;  padding: 0.5em;  -webkit-text-size-adjust: none;}.coffeescript .javascript,.javascript .xml,.tex .hljs-formula,.xml .javascript,.xml .vbscript,.xml .css,.xml .hljs-cdata {  opacity: 0.5;}pre code {    font-size: 1.1em;    font-family: monospace;    line-height: 1.3em;    overflow: auto;}</style></head><body><div id="content"><h1>A Gentle Introduction to Non-determinism in Scheme</h1><p><div class="center"><a href='/eo/amb/'>Esperanto</a> ■ English</div> <div class="center">Last updated: June 1, 2019</div></p><blockquote><p>Some of the most crucial steps in mental growth are based not simply on acquiring new skills, but on acquiring new administrative ways to use what one already knows.<br> —Marvin Minsky </p></blockquote><p><img src="/bil/wallhaven-333472-1008x250.webp" style="display: block; width: 100%; margin-left: auto; margin-right: auto;" alt="wallhaven-333472" title="wallhaven-333472"/></p><h2><a name="toc">Table of contents</a></h2><ul><li><a href='#introduction'>Introduction</a></li><li><a href='#cc'>The current continuation</a><ul><li><a href='#ccexamples'>Examples</a></li></ul></li><li><a href='#callcc'>The call/cc operator</a><ul><li><a href='#callcccapturing'>Capturing</a></li><li><a href='#callccapplication'>Application</a></li><li><a href='#callccescaping'>Escaping</a></li><li><a href='#callccexamples'>Examples</a></li></ul></li><li><a href='#amb'>The amb operator</a><ul><li><a href='#ambdefinition'>Definition</a></li><li><a href='#ambdeconstruction'>Deconstruction</a></li><li><a href='#ambevaluation'>Evaluation</a></li></ul></li><li><a href='#closing'>Closing remarks</a></li></ul><h2><a name="introduction">Introduction</a></h2><p>Nondeterministic programming is a technique wherein the flow of an algorithm is not linear, and there exists multiple possible continuations. The behavior of a computation can also change with the same inputs. There are several methods to achieve nondeterminism. In this article the method that I’ll use is backtracking.</p><p>Additionally, I’ll use <a href='https://goo.gl/zAHR9A'>Scheme</a> to do it. In Scheme, you are permitted to go back in an early computation and back, later, with ease.</p><p>I will also discuss the prerequisite topics to make nondeterminism in Scheme easier to understand.</p><h2><a name="cc">The current continuation</a></h2><p>In Scheme, the current continuation or the remaining computation is the remaining work to evaluate the rest of the computation.</p><p>In the expression</p><pre><code class="scheme">0
</code></pre><p>the current continuation—the remaining computation—is</p><pre><code class="scheme">&#40;lambda &#40;v&#41; v&#41;
</code></pre><p>and the remaining operation is</p><pre><code class="scheme">&#40;&#40;lambda &#40;v&#41; v&#41; 0&#41;
</code></pre><p>which returns</p><pre><code class="scheme">0
</code></pre><p>That is the result because the remaining computation on that level—the top-level—is the identity function.</p><p>Bear in mind, that the name of the argument of the lambda is not important. It can be <code>v</code>, <code>x</code>, or <code>dog-cat-mouse</code>:</p><pre><code class="scheme">&#40;&#40;lambda &#40;dog-cat-mouse&#41; dog-cat-mouse&#41; 0&#41;
</code></pre><h3><a name="ccexamples">Examples</a></h3><p>In the expression</p><pre><code class="scheme">&#40;&#42; 1 2&#41;
</code></pre><p>the remaining computation for <code>2</code>—the second argument of <code>&#42;</code>—is</p><pre><code class="scheme">&#40;lambda &#40;v&#41; &#40;&#42; 1 v&#41;&#41;
</code></pre><p>and the remaining operation is</p><pre><code class="scheme">&#40;&#40;lambda &#40;v&#41; &#40;&#42; 1 v&#41;&#41; 2&#41;
</code></pre><p>which, in that level of computation returns</p><pre><code class="scheme">2
</code></pre><p>Consequently, the remaining computation is</p><pre><code class="scheme">&#40;lambda &#40;v&#41; v&#41;
</code></pre><p>and the remaining operation is</p><pre><code class="scheme">&#40;&#40;lambda &#40;v&#41; v&#41; 2&#41;
</code></pre><p>which finally returns, at the top-level:</p><pre><code class="scheme">2
</code></pre><p>In the expression</p><pre><code class="scheme">&#40;+ &#40;&#42; 1 2&#41; 3&#41;
</code></pre><p>the flow of the computation is</p><pre><code class="scheme">   &#40;&#42; 1 2&#41;
&#40;+         3&#41;
</code></pre><p>Firstly, <code>&#40;&#42; 1 2&#41;</code> will be evaluated then the result becomes the first argument for <code>&#40;+   3&#41;</code>. In that empty space, the remaining computation is</p><pre><code class="scheme">&#40;lambda &#40;v&#41; &#40;+ v 3&#41;&#41;
</code></pre><p>and the remaining operation is</p><pre><code class="scheme">&#40;&#40;lambda &#40;v&#41; &#40;+ v 3&#41;&#41; &#40;&#42; 1 2&#41;&#41;
</code></pre><h2><a name="callcc">The call/cc operator</a></h2><p>In Scheme, you can capture the current continuation—the next computation—as a variable. You can do that with <a href='https://scheme.com/tspl4/further.html#./further:h3'>call/cc</a>. It is an operator which accepts only one argument exclusively—a <a href='/en/lambda-calculus/'>lambda</a>—an anonymous function, with one argument:</p><pre><code class="scheme">&#40;call/cc &#40;lambda &#40;k&#41; k&#41;&#41;
</code></pre><p>If you don’t have <code>call/cc</code> define it with:</p><pre><code class="scheme">&#40;define call/cc call-with-current-continuation&#41;
</code></pre><p>The phrase <i>call with current continuation</i> can also be treated as <i>call with next computation</i>. The function that it calls is the lambda. Additionally, <code>call/cc</code> passes the current continuation—the next computation—to that anonymous function.</p><p>In this lambda:</p><pre><code class="scheme">&#40;lambda &#40;k&#41; k&#41;
</code></pre><p><code>k</code> is a function itself which accepts one argument. So, in</p><pre><code class="scheme">&#40;call/cc &#40;lambda &#40;k&#41; k&#41;&#41;
</code></pre><p><code>call/cc</code> returns the current continuation—simply the function. However, in</p><pre><code class="scheme">&#40;call/cc &#40;lambda &#40;k&#41; &#40;k 0&#41;&#41;&#41;
</code></pre><p><code>call/cc</code> simply returns <code>0</code> because in that level—the top-level—<code>k</code> is</p><pre><code class="scheme">&#40;lambda &#40;v&#41; v&#41;
</code></pre><p>—the identity function. Because of that, the function</p><pre><code class="scheme">&#40;call/cc &#40;lambda &#40;k&#41; &#40;k 0&#41;&#41;&#41;
</code></pre><p>is functionally equivalent to</p><pre><code class="scheme">&#40;&#40;lambda &#40;v&#41; v&#41; 0&#41;
</code></pre><h3><a name="callcccapturing">Capturing</a></h3><p>Going back to the earlier example:</p><pre><code class="scheme">&#40;+ &#40;&#42; 1 2&#41; 3&#41;
</code></pre><p>you can capture the current continuation of <code>&#40;&#42; 1 2&#41;</code>  with <code>call/cc</code>:</p><pre><code class="scheme">&#40;+ &#40;call/cc &#40;lambda &#40;k&#41; &#40;&#42; 1 2&#41;&#41;&#41; 3&#41;
</code></pre><p>However, you may notice that you did not apply the function <code>k</code> to anything. The expression <code>&#40;&#42; 1 2&#41;</code> is evaluated, then the result goes to <code>&#40;+ &#95; 3&#41;</code>. In other words, that expression is functionally equivalent to:</p><pre><code class="scheme">&#40;+ &#40;&#42; 1 2&#41; 3&#41;
</code></pre><h3><a name="callccapplication">Application</a></h3><p>Using the same example, let’s apply the function <code>k</code>:</p><pre><code class="scheme">&#40;+ &#40;call/cc &#40;lambda &#40;k&#41; &#40;k &#40;&#42; 1 2&#41;&#41;&#41;&#41; 3&#41;
</code></pre><p>Inside the call of <code>call/cc</code>:</p><pre><code class="scheme">            &#40;lambda &#40;k&#41; &#40;k &#40;&#42; 1 2&#41;&#41;&#41;
</code></pre><p>the variable <code>k</code> is the current continuation—the remaining computation. What is the remaining computation? This:</p><pre><code class="scheme">&#40;+                                    3&#41;
</code></pre><p>the addition to <code>3</code>. In order to represent that computation as function, it becomes:</p><pre><code class="scheme">&#40;lambda &#40;v&#41; &#40;+ v 3&#41;&#41;
</code></pre><p>Wherein <code>&#40;+ &#95; 3&#41;</code> is going to be represented by this lambda.</p><p>So, the role of <code>call/cc</code> is to call a lambda, which accepts the remaining computation. Here, the remaining computation is called <code>k</code>. Because of that, the consequence of:</p><pre><code class="scheme">&#40;+ &#40;call/cc &#40;lambda &#40;k&#41; &#40;k &#40;&#42; 1 2&#41;&#41;&#41;&#41; 3&#41;
</code></pre><p>is functionally equivalent to</p><pre><code class="scheme">&#40;&#40;lambda &#40;v&#41; &#40;+ v 3&#41;&#41; &#40;&#42; 1 2&#41;&#41;
</code></pre><h3><a name="callccescaping">Escaping</a></h3><p>In</p><pre><code class="scheme">&#40;define z #f&#41;
&#40;+ &#40;call/cc &#40;lambda &#40;k&#41; &#40;set! z k&#41; &#40;&#42; 1 2&#41;&#41;&#41; 3&#41;
</code></pre><p>normally the result is</p><pre><code class="scheme">5
</code></pre><p>however, because we saved the current continuation—<code>k</code>—in <code>z</code>, we can return to that saved location with:</p><pre><code class="scheme">&#40;z 1&#41;
</code></pre><p>which returns</p><pre><code class="scheme">4
</code></pre><p>—another value. That mechanisms gives us the capability to escape computations, whether with a new value, an old value, or nothing.</p><p>For the reason that the current continuation is:</p><pre><code class="scheme">&#40;lambda &#40;v&#41; &#40;+ v 3&#41;&#41;
</code></pre><p>the call</p><pre><code class="scheme">&#40;z 1&#41;
</code></pre><p>is functionally equivalent to</p><pre><code class="scheme">&#40;&#40;lambda &#40;v&#41; &#40;+ v 3&#41;&#41; 1&#41;
</code></pre><p>instead of</p><pre><code class="scheme">&#40;&#40;lambda &#40;v&#41; &#40;+ v 3&#41;&#41; &#40;&#42; 1 2&#41;&#41;
</code></pre><h3><a name="callccexamples">Examples</a></h3><p>In</p><pre><code class="scheme">&#40;let &#40;&#40;x &#40;call/cc &#40;lambda &#40;k&#41; k&#41;&#41;&#41;&#41; &#40;x &#40;lambda &#40;o&#41; &quot;hi&quot;&#41;&#41;&#41;
</code></pre><p>the call</p><pre><code class="scheme">&#40;x &#40;lambda &#40;o&#41; &quot;hi&quot;&#41;&#41;
</code></pre><p>becomes</p><pre><code class="scheme">&#40;&#40;call/cc &#40;lambda &#40;k&#41; k&#41;&#41; &#40;lambda &#40;o&#41; &quot;hi&quot;&#41;&#41;
</code></pre><p>there, the remaining computation is</p><pre><code class="scheme">&#40;lambda &#40;o&#41; &quot;hi&quot;&#41;
</code></pre><p>which goes to the variable <code>k</code> in the body of <code>call/cc</code>. Like earlier, we apply <code>k</code> to <code>&#40;lambda &#40;o&#41; &quot;hi&quot;&#41;</code> inside another lambda:</p><pre><code class="scheme">&#40;&#40;lambda &#40;v&#41; &#40;v &#40;lambda &#40;o&#41; &quot;hi&quot;&#41;&#41;&#41; &#40;lambda &#40;o&#41; &quot;hi&quot;&#41;&#41;
</code></pre><p>which returns</p><pre><code class="scheme">&quot;hi&quot;
</code></pre><p>In</p><pre><code class="scheme">&#40;&#40;&#40;call/cc &#40;lambda &#40;k&#41; k&#41;&#41; &#40;lambda &#40;x&#41; x&#41;&#41; &quot;hi&quot;&#41;
</code></pre><p>the key is</p><pre><code class="scheme">&#40;&#40;call/cc &#40;lambda &#40;k&#41; k&#41;&#41; &#40;lambda &#40;x&#41; x&#41;&#41;
</code></pre><p>In the body of <code>call/cc</code>, the remaining computation is</p><pre><code class="scheme">&#40;lambda &#40;x&#41; x&#41;
</code></pre><p>which goes to the variable <code>k</code> in the body of <code>call/cc</code>. Like earlier again, we apply it to the lambda:</p><pre><code class="scheme">&#40;&#40;lambda &#40;v&#41; &#40;v &#40;lambda &#40;x&#41; x&#41;&#41;&#41; &#40;lambda &#40;x&#41; x&#41;&#41;
</code></pre><p>which returns</p><pre><code class="scheme">#&lt;procedure x&gt;
</code></pre><p>It means, that you can now apply this function to the remaining argument:</p><pre><code class="scheme">&#40;&#40;&#40;lambda &#40;v&#41; &#40;v &#40;lambda &#40;x&#41; x&#41;&#41;&#41; &#40;lambda &#40;x&#41; x&#41;&#41; &quot;hi&quot;&#41;
</code></pre><p>which returns</p><pre><code class="scheme">&quot;hi&quot;
</code></pre><h2><a name="amb">The amb operator</a></h2><p>One of the uses of the famous amb operator in Scheme is to implement non-deterministic programming by means of backtracking. With that mechanism, the computation can go to an earlier state; carry computations; change change; escape computations; and more.</p><p>In this article we’re going to use the amb operator to enable the backtracking mechanism.</p><h3><a name="ambdefinition">Definition</a></h3><p>The definition that we’ll use is the one by shido.info/lisp. It is a macro to ensure that the arguments are not evaluated. Additionally, it uses lists internally.</p><pre><code class="scheme">&#40;define call/cc call-with-current-continuation&#41; ;  1
                                                ;  2
&#40;define f #f&#41;                                   ;  3
                                                ;  4
&#40;define-syntax amb                              ;  5
  &#40;syntax-rules &#40;&#41;                              ;  6
    &#40;&#40;&#95;&#41; &#40;f&#41;&#41;                                   ;  7
    &#40;&#40;&#95; a&#41; a&#41;                                   ;  8
    &#40;&#40;&#95; a b ...&#41;                                ;  9
     &#40;let &#40;&#40;s f&#41;&#41;                               ; 10
       &#40;call/cc                                 ; 11
        &#40;lambda &#40;k&#41;                             ; 12
          &#40;set! f &#40;lambda &#40;&#41;                    ; 13
                    &#40;set! f s&#41;                  ; 14
                    &#40;k &#40;amb b ...&#41;&#41;&#41;&#41;           ; 15
          &#40;k a&#41;&#41;&#41;&#41;&#41;&#41;&#41;                           ; 16
                                                ; 17
&#40;define &#40;really? x y&#41;                           ; 18
  &#40;if &#40;equal? x y&#41;                              ; 19
      &#40;list x y&#41;                                ; 20
      &#40;amb&#41;&#41;&#41;                                   ; 21
                                                ; 22
&#40;call/cc                                        ; 23
 &#40;lambda &#40;k&#41;                                    ; 24
   &#40;set! f &#40;lambda &#40;&#41;                           ; 25
             &#40;k 'no-choices&#41;&#41;&#41;&#41;&#41;                ; 26
</code></pre><p>These definitions work on <a href='https://www.gnu.org/software/mit-scheme/'>MIT/GNU Scheme</a>, <a href='https://www.gnu.org/software/guile/'>Guile</a>, <a href='http://s48.org/'>Scheme48</a>, <a href='https://scsh.net/'>Scsh</a>, <a href='http://synthcode.com/wiki/chibi-scheme'>chibi-scheme</a>, <a href='https://cons.io/'>Gerbil</a>, <a href='https://www.scheme.com/'>Chez Scheme</a>, <a href='http://call-cc.org/'>Chicken</a>, <a href='https://www-sop.inria.fr/indes/fp/Bigloo/'>Bigloo</a>, <a href='https://practical-scheme.net/gauche/memo.html'>Gauche</a>, and <a href='https://racket-lang.org/'>Racket</a>.</p><h3><a name="ambdeconstruction">Deconstruction</a></h3><p>In this section, we are going to deconstruct the definitions of the amb operator and other functions. The function <code>really?</code> technically is not part of the definition, however, we’ll use it to demonstrate the functionality of <code>amb</code>.</p><p>Here are superficial steps of the definitions:</p><ol><li>In line 1 <code>call/cc</code> is bound to <code>call-with-current-continuation</code> mainly for implementations which   doesn’t have that definition.</li><li>In line 3 <code>f</code> is bound to a default value.</li><li>In lines 5 to 16 is the body of <code>amb</code>.</li><li>In lines 18 to 21 is an example function: if <code>x</code> and <code>y</code> are equal, it returns a list; if not,   <code>amb</code> is called.</li><li>In lines 23 to 26, <code>call/cc</code> is called, in which the true initial value of <code>f</code> is initialized   with a lambda which returns <code>'no-choices</code>.</li><li>Let’s go back to the body of <code>amb</code> in lines 5 to 16. In line 7, if <code>amb</code> is called as such:<pre><code class="scheme">&#40;amb&#41;
</code></pre>the function <code>f</code> is called, with whatever that <code>f</code> can do.</li><li>In line 8, if <code>amb</code> is called as such:<pre><code class="scheme">&#40;amb &quot;dog&quot;&#41;
</code></pre>the argument <code>&quot;dog&quot;</code> is simply returned.</li><li>However, with more than one arguments, the behavior of <code>amb</code> changes. Firstly, in line 10, the   current value of <code>f</code> is bound to <code>s</code>, next in line 11, <code>call/cc</code> is called, capturing the current   continuation to <code>k</code>.</li><li>Inside the body of the lambda, the global variable <code>f</code> will have a new value—another lambda—which   will not be evaluated until it is explicitly requested. In that body, <code>f</code> will have the earlier   value of <code>s</code>, then <code>k</code> will be called with the value <code>b ...</code>, which are the remaining arguments   for <code>amb</code>.</li><li>Lastly, the <code>k</code> function—the remaining computation—will be applied to the value <code>a</code>.</li></ol><h3><a name="ambevaluation">Evaluation</a></h3><p>Using <code>really?</code> we will watch the evaluation steps in the use of <code>amb</code>. If we have the following expression,</p><pre><code class="scheme">&#40;really? &#40;amb &quot;dog&quot; &quot;cat&quot; 9&#41; &#40;amb &quot;mouse&quot; 9&#41;&#41;
</code></pre><p>here are the simplified evaluation steps:</p><ol><li><code>&#40;amb &quot;dog&quot; &quot;cat&quot; 9&#41;</code> will be evaluated;</li><li>For the reason that more than one argument is passed to <code>amb</code> let’s go to line 9;</li><li>The local variable <code>s</code> will have the current value of <code>f</code> in the top-level:<pre><code class="scheme">&#40;lambda &#40;&#41; &#40;k 'no-choices&#41;&#41;
</code></pre></li><li>The lambda in line 12 will be called with the remaining computation to <code>k</code>;</li><li>In line 13 <code>f</code> will have a new value. The value will be a lambda;</li><li>When the lambda is called, <code>k</code> again will have the value of <code>s</code>, which is the lambda in step 3.</li><li><code>k</code> will be applied to <code>a</code>, wherein, <code>&#40;k a&#41;</code> is:<pre><code class="scheme">&#40;&#40;lambda &#40;v&#41; &#40;really? v &#40;amb &quot;mouse&quot; 9&#41;&#41;&#41; &quot;dog&quot;&#41;
</code></pre>which consequently becomes<pre><code class="scheme">&#40;&#40;lambda &#40;v&#41; &#40;&#40;lambda &#40;w&#41; &#40;really? v w&#41;&#41; &quot;dog&quot;&#41;&#41; &quot;mouse&quot;&#41;
</code></pre>because of the call <code>&#40;amb &quot;mouse&quot; 9&#41;</code>;</li><li>Because <code>&quot;dog&quot;</code> is not equal to <code>&quot;mouse&quot;</code> the <code>amb</code> operator will be called like:<pre><code class="scheme">&#40;amb&#41;
</code></pre></li><li>Because <code>&#40;amb&#41;</code> doesn’t have arguments, the expression in line 7 happens;<pre><code class="scheme">&#40;f&#41;
</code></pre>wherein the value of <code>k</code> is the lambda in lines 13 to 15. The value of <code>f</code> again becomes:<pre><code class="scheme">&#40;lambda &#40;&#41; &#40;k 'no-choices&#41;&#41;
</code></pre></li><li>Then, in line 15 <code>k</code> will be called like <code>&#40;k &quot;cat&quot; 9&#41;</code>.</li><li>The steps will be repeated, calling <code>really?</code> many times. The steps will look like:<pre><code class="scheme">&#40;really? &quot;dog&quot; &quot;mouse&quot;&#41;
&#40;really? &quot;dog&quot; 9&#41;
&#40;really? &quot;cat&quot; &quot;mouse&quot;&#41;
&#40;really? &quot;cat&quot; 9&#41;
&#40;really? 9 &quot;mouse&quot;&#41;
&#40;really? 9 9&#41;
</code></pre></li><li>Because <code>9</code> is equal to <code>9</code>, the expression<pre><code class="scheme">&#40;list 9 9&#41;
</code></pre>will be evaluated in the body of <code>really?</code> which finally returns<pre><code>'&#40;9 9&#41;
</code></pre></li></ol><h2><a name="closing">Closing remarks</a></h2><p>In this article, we noticed that with <code>call/cc</code> we have easily achieved non-determinism through backtracking with <code>amb</code> and basic Scheme functions. However, there are more elaborate and better methods of achieving this.</p><p>The type of continuations that we dealt with is the <a href='https://en.wikipedia.org/wiki/Continuation'>non-delimited continuation</a> in contrast with a <a href='https://en.wikipedia.org/wiki/Delimited_continuation'>delimited continuation</a>. I must also mention, that there’s an <a href='http://okmij.org/ftp/continuations/against-callcc.html'>argument</a> against the use of <code>call/cc</code>.</p><p>Anyway, I hope that you learned something good from this post.</p><hr/><div class="footer"><p><div class="text-small"> <a href='/en/'>Home</a> ■ <a href='/en/about/'>About</a> ■ <a href='/en/quotes/'>Quotes</a> ■ <a href='/en/reflections/'>Reflections</a> ■ <a href='https://github.com/ebzzry/ebzzry.github.io'>Source</a> </div></p><p><div class="text-x-small"> <a rel="license" href="https://creativecommons.org/publicdomain/zero/1.0/deed.en"><img alt="CC0 1.0 Universal (CC0 1.0) Public Domain Dedication" class="cc" src="/bil/cc0-88x31.webp" /></a><br> This work is in the <a rel="license" href="https://creativecommons.org/publicdomain/zero/1.0/deed.en">public domain.</a><br> </div></p><p></div></p></div><script src="/static/js/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></body></html>
