<!DOCTYPE html>
<html lang="en"><head><title>Haskell Development with Emacs</title><meta charset="utf-8" /><meta content="width=device-width,initial-scale=1.0,user-scalable=yes" name="viewport" /><meta content="noodp,noydir" name="robots" /><link rel='apple-touch-icon' sizes='180x180' href='/images/ico/apple-touch-icon.png'><link rel='icon' type='image/png' sizes='32x32' href='/images/ico/favicon-32x32.png'><link rel='icon' type='image/png' sizes='16x16' href='/images/ico/favicon-16x16.png'><link rel='manifest' href='/images/ico/site.webmanifest'><link rel='mask-icon' href='/images/ico/safari-pinned-tab.svg' color='#5bbad5'><link rel='shortcut icon' href='/images/ico/favicon.ico'> <meta name='msapplication-TileColor' content='#da532c'> <meta name='msapplication-config' content='/images/ico/browserconfig.xml'> <meta name='theme-color' content='#ffffff'><meta content="Haskell Development with Emacs" name="description" /><meta content="emacs, haskell, programming, configuration, setup, settings" name="keywords" /><meta content="Haskell Development with Emacs " property="og:title" /><meta content="article" property="og:type" /><meta content="https://ebzzry.com/en/emacs-haskell/" property="og:url" /><meta content="https://ebzzry.com/images/site/kevin-mueller-0gJqD3dtluU-unsplash-2000x1125.jpg" property="og:image" /><style media="all" type="text/css">html {    color: #333;    font-size: 1em;    font-family: Georgia, Cambria, Palatino, "Palatino Linotype", "Times New Roman", Times, serif;    line-height: 1.45;    text-align: left:    width: 100%;    max-width: 40em;    margin: 0 auto 0 auto;    padding: 0;}body {    border-top: hidden;    border-bottom: hidden;    padding: 0 1.5em 1em 1.5em;    margin: 0;}#content {    -webkit-column-count: 1;    -moz-column-count: 1;    column-count: 1;}code {    font-size: 0.9em;    font-family: "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Lucida Console", "Courier New", Courier, monospace;    color: black;    display: inline-block;}pre code {    font-size: 1em;    font-family: monospace;    line-height: 1.3em;    overflow: auto;    font-weight: normal;}kbd {    font-size: 1.1em;    padding: 0.1em 0.6em;    border: 1px solid #ccc;    font-family: monospace;    background-color: #f7f7f7;    color: #333;    -moz-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    -webkit-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    -moz-border-radius: 3px;    -webkit-border-radius: 3px;    border-radius: 3px;    display: inline-block;    margin: 0 0.1em;    text-shadow: 0 1px 0 #fff;    white-space: nowrap;}h1, h2, h3, h4, h5, h6 {    font-family: Calibri, "Gill Sans", "Gill Sans MT", "Myriad Pro", Myriad, "DejaVu Sans", Tahoma, Geneva, Helvetica, Arial, sans-serif;    margin-bottom: 0;}h1 {    font-size: 2.5em;    text-align: center;    border-bottom: 6px solid black;}h2 {    font-size: 2.0em;    text-align: left;    border-bottom: 2px solid black;}h3 {    font-size: 1.6em;    text-align: left;    border-bottom: 1px solid lightgrey;}h4 {    font-size: 1.5em;    text-align: left;}h5 {    font-size: 1.3em;    text-align: left;}ul, ol {    padding-left: 2em;}ul li {    list-style-type: square;}ul li li {    list-style-type: disc;}ul li li li {    list-style-type: circle;}ol li {    list-style-type: decimal;}p, para, b, strong, i, em, emph {    font-size: 1em;}blockquote {    font-size: 1.2em;    font-style: italic;    margin-left: 2em;}b, strong {    font-weight: bold;}i, em, emph {    font-style: italic;}table {    margin: 0.5em;    border-spacing: 0;    border-collapse: collapse;}th, td {    border: 1px solid lightgray;    padding-top: 0;    padding-bottom: 0;    padding-left: 0.45em;    padding-right: 0.45em;}.text-right {    text-align: right;}.text-small {    font-size: small;}.text-x-small {    font-size: x-small;}.banner {    display: block;    width: 100%;    margin-left: auto;    margin-right: auto;}.footer {    text-align: right;    float: right;    max-width: 18em;}.cc {    border-width: 0}.center {    text-align: center;}</style><style media="all" type="text/css">/* Ewan Themes -- based 99.99% from Tomorrow Night Theme *//* http://jmblog.github.com/color-themes-for-google-code-highlightjs *//* Original theme - https://github.com/chriskempson/tomorrow-theme *//* http://jmblog.github.com/color-themes-for-google-code-highlightjs *//* Tomorrow Comment */.hljs-comment {  color: #969896;}/* Tomorrow Red */.hljs-variable,.hljs-attribute,.hljs-tag,.hljs-regexp,.ruby .hljs-constant,.xml .hljs-tag .hljs-title,.xml .hljs-pi,.xml .hljs-doctype,.html .hljs-doctype,.css .hljs-id,.css .hljs-class,.css .hljs-pseudo {  color: #cc6666;}/* Tomorrow Orange */.hljs-number,.hljs-preprocessor,.hljs-pragma,.hljs-built_in,.hljs-literal,.hljs-params,.hljs-constant {  color: #de935f;}/* Tomorrow Yellow */.ruby .hljs-class .hljs-title,.css .hljs-rule .hljs-attribute {  color: #f0c674;}/* Tomorrow Green */.hljs-string,.hljs-value,.hljs-inheritance,.hljs-header,.hljs-name,.ruby .hljs-symbol,.xml .hljs-cdata {  color: #b5bd68;}/* Tomorrow Aqua */.hljs-title,.css .hljs-hexcolor {  color: #8abeb7;}/* Tomorrow Blue */.hljs-function,.python .hljs-decorator,.python .hljs-title,.ruby .hljs-function .hljs-title,.ruby .hljs-title .hljs-keyword,.perl .hljs-sub,.javascript .hljs-title,.coffeescript .hljs-title {  color: #81a2be;}/* Tomorrow Purple */.hljs-keyword,.javascript .hljs-function {  color: #b294bb;}.hljs {  display: block;  overflow-x: auto;  background: #1d1f21;  color: #c5c8c6;  padding: 0.5em;  -webkit-text-size-adjust: none;}.coffeescript .javascript,.javascript .xml,.tex .hljs-formula,.xml .javascript,.xml .vbscript,.xml .css,.xml .hljs-cdata {  opacity: 0.5;}pre code {    font-size: 1.1em;    font-family: monospace;    line-height: 1.3em;    overflow: auto;}</style></head><body><div id="content"><h1>Haskell Development with Emacs</h1><p><div class="center">English ‚äª <a href='/eo/emakso-haskelo/'>Esperanto</a></div> <div class="center">2025-12-25 23:10:40 +0800</div></p><blockquote><p>You can‚Äôt truly call yourself peaceful unless you are capable of great violence. If you‚Äôre not capable of violence, you‚Äôre not peaceful, you‚Äôre harmless.<br> ‚ÄîStef Starkgaryen </p></blockquote><p><img src="/images/site/kevin-mueller-0gJqD3dtluU-unsplash-2000x1125.jpg" style="display: block; width: 100%; margin-left: auto; margin-right: auto;" /></p><h2><a name="toc">Table of contents</a></h2><ul><li><a href='#introduction'>Introduction</a></li><li><a href='#doom'>Doom</a></li><li><a href='#direnv'>Direnv</a></li><li><a href='#stack'>Stack</a></li><li><a href='#nix'>Nix</a></li><li><a href='#miscellany'>Miscellany</a></li><li><a href='#testing'>Testing</a></li><li><a href='#closing'>Closing remarks</a></li></ul><h2><a name="introduction">Introduction</a></h2><p>Haskell is a beautiful language. Let me just say that. It is one of those languages that was designed to be elegant and powerful. On the other side of the rainbow is Lisp and on the other side is Haskell. It‚Äôs not just because it is purely functional, statically typed, lazily evaluated, abounding with research, and has rich community. It is because it has all those. </p><p>But with Haskell, things are different. You look at things from a different perspective. You go out of your comfort zones. You become curious what‚Äôs all those fireworks there on that side of the city? You choose Haskell because you not only want to become a better programmer, but because you want to become a better thinker.</p><p>In this article I‚Äôm going to talk about I setup my own Haskell development environment. Of course, Emacs is just one part of it. If I had to put all the parts that I need, then the title of the article would have already become too long. I use GHC, Stack, Doom Emacs, Nix, and Direnv.</p><p>Beware, though, that this is a highly opinionated guide. The commands and instructions that I use are finely tuned for my use cases.</p><h2><a name="doom">Doom</a></h2><p>For the past six years, I‚Äôve been steadily using <a href='https://github.com/doomemacs/doomemacs'>Doom¬†Emacs</a> as my main editor instead of vanilla Emacs. Doom is fast, reliable, and comes with batteries. Despite being marketed as a beginner-friendly Emacs distribution, it also works well for advanced users. I have also tried Spacemacs but it wasn‚Äôt stable enough.</p><p>First, we need to enable Haskell support in <code>&#126;/.doom.d/init.el</code>. Find the <code>:lang</code> section, and add the following:</p><pre><code class="lisp">:lang
‚Ä¶
&#40;haskell +lsp&#41;
‚Ä¶
</code></pre><p>I also like to enable ligatures, so that the symbols will look prettier. Find the <code>:ui</code> section, and the following:</p><pre><code class="lisp">:ui
‚Ä¶
&#40;ligatures +extra&#41;
‚Ä¶
</code></pre><p>Then, we need to add support for direnv, so that opening a <code>.hs</code> file will also load direnv. Open the file <code>&#126;/.doom.d/config.el</code> and put the following:</p><pre><code class="lisp">&#40;use-package! direnv
  :config
  &#40;direnv-mode&#41;&#41;
</code></pre><p>Then, let‚Äôs tell the Haskell mode to use GHCi that comes with Stack. Open the file <code>&#126;/.doom.d/config.el</code>, again, and put the following:</p><pre><code class="lisp">&#40;after! haskell
  &#40;setq haskell-process-type 'stack-ghci&#41;&#41;
</code></pre><p>Finally, reload your config on the command line with:</p><pre><code class="sh">doom sync
</code></pre><p>or inside Doom itself:</p><pre><code>SPC h r r
</code></pre><h2><a name="direnv">Direnv</a></h2><p><a href='https://github.com/direnv/direnv'>direnv</a> is a nice little tool that allows you to create directory-specific environment variables. The creation of these variables happen when you change to a directory where direnv is enabled.</p><p>You can install direnv by enabling it in your configuration.nix file or install it to your local profile. For simplicity, let‚Äôs go with the latter:</p><pre><code class="sh">nix profile install nixpkgs#direnv
</code></pre><p>Then, let‚Äôs create the top-level configuration file for direnv. Put the following in the file <code>&#126;/.direnvrc</code>:</p><pre><code class="sh">use&#95;flake&#40;&#41; {
  watch&#95;file flake.nix
  watch&#95;file flake.lock
  eval &quot;$&#40;nix print-dev-env&#41;&quot;
}
</code></pre><h2><a name="stack">Stack</a></h2><p>It‚Äôs now time to create a new project. Let‚Äôs do it with <a href='https://docs.haskellstack.org/en/stable/'>Stack</a> because it stable, has sane defaults, and integrates well with <a href='https://hackage.haskell.org/'>Hackage</a> and <a href='https://www.stackage.org/'>Stackage</a>.</p><p>Let‚Äôs presume that we‚Äôre in the home directory of user <code>john</code>‚Äî<code>/home/john/</code>:</p><pre><code class="sh">nix run nixpkgs#stack new foo
</code></pre><p>When the command completes, the directory <code>/home/john/foo/</code> will contain the following files:</p><pre><code>foo
‚îú‚îÄ‚îÄ app
‚îÇ   ‚îî‚îÄ‚îÄ Main.hs
‚îú‚îÄ‚îÄ CHANGELOG.md
‚îú‚îÄ‚îÄ foo.cabal
‚îú‚îÄ‚îÄ LICENSE
‚îú‚îÄ‚îÄ package.yaml
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ Setup.hs
‚îú‚îÄ‚îÄ src
‚îÇ   ‚îî‚îÄ‚îÄ Lib.hs
‚îú‚îÄ‚îÄ stack.yaml
‚îî‚îÄ‚îÄ test
    ‚îî‚îÄ‚îÄ Spec.hs
</code></pre><h2><a name="nix">Nix</a></h2><p>To create a reproducible environment, we‚Äôre now going to populate the <code>foo</code> directory with files that will integrate everything together. Create the following files inside the directory <code>foo/</code> that was just created.</p><p>First up is <code>flake.nix</code>:</p><pre><code class="nix">{
  inputs = {
    nixpkgs.url = &quot;github:nixos/nixpkgs&quot;;
    flake-utils.url = &quot;github:numtide/flake-utils&quot;;
  };
  outputs =
    inputs@{
      self,
      nixpkgs,
      flake-utils,
    }:
    flake-utils.lib.eachDefaultSystem &#40;
      system:
      let
        pkgs = nixpkgs.legacyPackages.${system};
      in
      {
        devShells = import ./shells.nix { inherit nixpkgs pkgs; };
      }
    &#41;;
}

</code></pre><p>Next is <code>shells.nix</code>:</p><pre><code class="nix">{
  nixpkgs,
  pkgs,
  ...
}:
with pkgs;
let
  comPkgs = &#91;
    which
    rlwrap
  &#93;;
  addComPkgs = l: l ++ comPkgs;
  inherits = {
    inherit nixpkgs pkgs addComPkgs;
  };
  import' = m: import m inherits;
in
rec {
  haskell = import' ./haskell.nix;
  default = haskell;
}
</code></pre><p>Then, <code>haskell.nix</code>:</p><pre><code class="nix">{
  nixpkgs,
  pkgs,
  addComPkgs,
  ...
}:
with pkgs;
let
  extraPkgs = &#91;
  &#93;;
  haskellPkgs = haskell.packages.&quot;ghc9103&quot;;
  stackWrapped = symlinkJoin {
    name = &quot;stack&quot;;
    paths = &#91; stack &#93;;
    buildInputs = &#91; makeWrapper &#93;;
    postBuild = ''
      wrapProgram $out/bin/stack \
        --add-flags &quot;\
          --nix \
          --system-ghc \
          --no-install-ghc \
        &quot;
    '';
  };
  mainPkgs = &#91;
    haskellPkgs.ghc
    haskellPkgs.haskell-language-server
    stackWrapped
    fourmolu
  &#93;;
in
mkShell {
  buildInputs = addComPkgs mainPkgs ++ extraPkgs;
  LD&#95;LIBRARY&#95;PATH = lib.makeLibraryPath mainPkgs;
}
</code></pre><p>Finally, create <code>.envrc</code>:</p><pre><code class="sh">use flake
if &#91;&#91; -f .env &#93;&#93;; then dotenv .env; fi
</code></pre><h2><a name="misc">Miscellany</a></h2><p>While inside the <code>foo/</code> directory, you need to enable‚Äîor allow‚Äî direnv:</p><pre><code class="sh">direnv allow
</code></pre><p>and you have to create the lock file for Nix:</p><pre><code class="sh">nix flake update
</code></pre><p>In <a href='https://veda-tech.com'>VTI</a>, we like to use Ormolu's default of using two spaces for indentation. We use this <code>fourmolu.yaml</code> config for our needs:</p><pre><code class="yaml">indentation: 2
column-limit: none
function-arrows: trailing
comma-style: leading
import-export-style: diff-friendly
import-grouping: legacy
indent-wheres: false
record-brace-space: false
newlines-between-decls: 1
haddock-style: multi-line
haddock-style-module: null
haddock-location-signature: auto
let-style: auto
in-style: right-align
if-style: indented
single-constraint-parens: always
single-deriving-parens: always
sort-constraints: false
sort-derived-classes: false
sort-deriving-clauses: false
trailing-section-operators: true
unicode: never
respectful: true
fixities: &#91;&#93;
reexports: &#91;&#93;
local-modules: &#91;&#93;
</code></pre><h2><a name="testing">Testing</a></h2><p>At this point, the directory <code>foo/</code> will look like the following:</p><pre><code>foo
‚îú‚îÄ‚îÄ app
‚îÇ   ‚îî‚îÄ‚îÄ Main.hs
‚îú‚îÄ‚îÄ CHANGELOG.md
‚îú‚îÄ‚îÄ flake.lock
‚îú‚îÄ‚îÄ flake.nix
‚îú‚îÄ‚îÄ foo.cabal
‚îú‚îÄ‚îÄ fourmolu.yaml
‚îú‚îÄ‚îÄ haskell.nix
‚îú‚îÄ‚îÄ LICENSE
‚îú‚îÄ‚îÄ package.yaml
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ Setup.hs
‚îú‚îÄ‚îÄ shells.nix
‚îú‚îÄ‚îÄ src
‚îÇ   ‚îî‚îÄ‚îÄ Lib.hs
‚îú‚îÄ‚îÄ stack.yaml
‚îî‚îÄ‚îÄ test
    ‚îî‚îÄ‚îÄ Spec.hs
</code></pre><p>When you cd to <code>&#126;/foo/</code> you‚Äôll be informed that direnv has loaded.</p><pre><code class="sh">cd &#126;/foo
</code></pre><p>When you find the file <code>&#126;/foo/app/Main.hs</code> with Doom:</p><pre><code>SPC f f &#126;/foo/app/Main.hs RET
</code></pre><p>you‚Äôll also be notified that direnv has loaded.</p><p>To verify that the Haskell program indeed builds, run:</p><pre><code class="sh">stack build
</code></pre><p>Bear in mind that this <code>stack</code> binary is the one that came inside the Nix environment as specified by <code>flake.nix</code>. When the build completes, run it with:</p><pre><code class="sh">stack exec foo-exe
</code></pre><h2><a name="closing">Closing remarks</a></h2><p>If you‚Äôre already a Nix user, you‚Äôll find these instructions relatively easy to follow. If you‚Äôre not familiar with Nix, however, you may need to invest time learning more about it, its ecosystem, and what makes it unique.</p><p>I have yet to see a better integrated development environment for Haskell than the one that I described above. The initial setup can be daunting, but once you get past the intial hurdle everything becomes easy.</p><hr/><div class="footer"><p><div class="text-small"> <a href='/en/'>Home</a> ‚äª <a href='/en/about/'>About</a> ‚äª <a href='/en/quotes/'>Quotes</a> ‚äª <a href='/en/reflections/'>Reflections</a> </div></p><p><div class="text-x-small"> Made in üáµüá≠ with ‚ù§Ô∏è by Rommel Mart√≠nez </div></p><p></div></p></div><script src="/static/js/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></body></html>