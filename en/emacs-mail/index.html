<!DOCTYPE html>
<html lang="en"><head><title>Setting Up Mail in Emacs</title><meta charset="utf-8" /><meta content="width=device-width,initial-scale=1.0,user-scalable=yes" name="viewport" /><meta content="noodp,noydir" name="robots" /><meta content="A journal about computing, human predilections, and random krakaboom." name="description" /><meta content="ebzzry, rommel, martinez, rommel martinez, journal, blog, krakaboom, y, y combinator, lambda, lambda calculus, lisp, scheme, racket, clojure, haskell, nixos, nixpkgs, nix, fallacies, symbols, marks, symbols and marks, emacs, emacs hacks, emacs tutorials, emacs commands, emacs basics, dired, retrospect, livefrog, usync, essays, english, esperanto, esperanta, verb tenses, git, github, primer, introduction, linux, macos, kvm, frog, ugarit, gpg, ssh, division by zero, communicate, human, communicate like a human, human predilections, predilections, computing, inspiration, quotes, famous quotes, words, emem, tutorials, guides, M-x ebzzry RET" name="keywords" /><meta content="Setting Up Mail in Emacs" property="og:title" /><meta content="article" property="og:type" /><meta content="http://ebzzry.io/en/emacs-mail/" property="og:url" /><meta content="http://ebzzry.io/static/ico/android-chrome-512x512.png" property="og:image" /><link href="/static/ico/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180" /><link href="/static/ico/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" /><link href="/static/ico/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" /><link href="/static/ico/manifest.json" rel="manifest" /><link color="#5bbad5" href="/static/ico/safari-pinned-tab.svg" rel="mask-icon" /><meta content="#ffffff" name="theme-color" /><style media="all" type="text/css">html {    color: #333;    font-size: 1em;    font-family: Georgia, Cambria, Palatino, "Palatino Linotype", "Times New Roman", Times, serif;    line-height: 1.45;    text-align: left:    width: 100%;    max-width: 40em;    margin: 0 auto 0 auto;    padding: 0;}body {    border-top: hidden;    border-bottom: hidden;    padding: 0 1.5em 1em 1.5em;    margin: 0;}#content {    -webkit-column-count: 1;    -moz-column-count: 1;    column-count: 1;}code {    font-size: 0.9em;    font-family: "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Lucida Console", "Courier New", Courier, monospace;    color: black;    display: inline-block;    font-weight: bold;}pre code {    font-size: 1em;    font-family: monospace;    line-height: 1.3em;    overflow: auto;    font-weight: normal;}kbd {    font-size: 1.1em;    padding: 0.1em 0.6em;    border: 1px solid #ccc;    font-family: monospace;    background-color: #f7f7f7;    color: #333;    -moz-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    -webkit-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    -moz-border-radius: 3px;    -webkit-border-radius: 3px;    border-radius: 3px;    display: inline-block;    margin: 0 0.1em;    text-shadow: 0 1px 0 #fff;    white-space: nowrap;}h1, h2, h3, h4, h5, h6 {    font-family: Calibri, "Gill Sans", "Gill Sans MT", "Myriad Pro", Myriad, "DejaVu Sans", Tahoma, Geneva, Helvetica, Arial, sans-serif;    margin-bottom: 0;}h1 {    font-size: 2.5em;    text-align: center;    border-bottom: 6px solid black;}h2 {    font-size: 2.0em;    text-align: left;    border-bottom: 2px solid black;}h3 {    font-size: 1.6em;    text-align: left;    border-bottom: 1px solid lightgrey;}h4 {    font-size: 1.5em;    text-align: left;}h5 {    font-size: 1.3em;    text-align: left;}ul, ol {    padding-left: 2em;}ul li {    list-style-type: square;}ul li li {    list-style-type: disc;}ul li li li {    list-style-type: circle;}ol li {    list-style-type: decimal;}p, para, b, strong, i, em, emph {    font-size: 1em;}blockquote {    font-size: 1.2em;    font-style: italic;    margin-left: 2em;}b, strong {    font-weight: bold;}i, em, emph {    font-style: italic;}table {    margin: 0.5em;    border-spacing: 0;    border-collapse: collapse;}th, td {    border: 1px solid lightgray;    padding-top: 0;    padding-bottom: 0;    padding-left: 0.45em;    padding-right: 0.45em;}.text-right {    text-align: right;}.text-small {    font-size: small;}.text-x-small {    font-size: x-small;}.banner {    display: block;    width: 100%;    margin-left: auto;    margin-right: auto;}.footer {    text-align: right;    float: right;    max-width: 18em;}.cc {    border-width: 0}.center {    text-align: center;}</style><style media="all" type="text/css">/* Ewan Themes -- based 99.99% from Tomorrow Night Theme *//* http://jmblog.github.com/color-themes-for-google-code-highlightjs *//* Original theme - https://github.com/chriskempson/tomorrow-theme *//* http://jmblog.github.com/color-themes-for-google-code-highlightjs *//* Tomorrow Comment */.hljs-comment {  color: #969896;}/* Tomorrow Red */.hljs-variable,.hljs-attribute,.hljs-tag,.hljs-regexp,.ruby .hljs-constant,.xml .hljs-tag .hljs-title,.xml .hljs-pi,.xml .hljs-doctype,.html .hljs-doctype,.css .hljs-id,.css .hljs-class,.css .hljs-pseudo {  color: #cc6666;}/* Tomorrow Orange */.hljs-number,.hljs-preprocessor,.hljs-pragma,.hljs-built_in,.hljs-literal,.hljs-params,.hljs-constant {  color: #de935f;}/* Tomorrow Yellow */.ruby .hljs-class .hljs-title,.css .hljs-rule .hljs-attribute {  color: #f0c674;}/* Tomorrow Green */.hljs-string,.hljs-value,.hljs-inheritance,.hljs-header,.hljs-name,.ruby .hljs-symbol,.xml .hljs-cdata {  color: #b5bd68;}/* Tomorrow Aqua */.hljs-title,.css .hljs-hexcolor {  color: #8abeb7;}/* Tomorrow Blue */.hljs-function,.python .hljs-decorator,.python .hljs-title,.ruby .hljs-function .hljs-title,.ruby .hljs-title .hljs-keyword,.perl .hljs-sub,.javascript .hljs-title,.coffeescript .hljs-title {  color: #81a2be;}/* Tomorrow Purple */.hljs-keyword,.javascript .hljs-function {  color: #b294bb;}.hljs {  display: block;  overflow-x: auto;  background: #1d1f21;  color: #c5c8c6;  padding: 0.5em;  -webkit-text-size-adjust: none;}.coffeescript .javascript,.javascript .xml,.tex .hljs-formula,.xml .javascript,.xml .vbscript,.xml .css,.xml .hljs-cdata {  opacity: 0.5;}pre code {    font-size: 1.1em;    font-family: monospace;    line-height: 1.3em;    overflow: auto;}</style></head><body><div id="content"><h1>Setting Up Mail in Emacs</h1><p><div class="center">February 2, 2014</div> <div class="center">Updated: March 31, 2017</div></p><blockquote><p>“Just because it isn’t done doesn’t mean it can’t be done. Just because it can be done doesn’t mean it should be.”<br> ―Barry Glasford </p></blockquote><p>In this day and age, checking your mail means going to the website of your mail provider, or using a mobile app. However, there are some cases when you want to have more control over your messages, especially when the feature you want is not present with the mainstream options.</p><p>Emacs provides a plethora (Gnus, Wanderlust, VM, etc.) of ways of sending and receiving mail. in this post, I’ll talk about <a href='http://pyropus.ca/software/getmail/'>getmail</a>, <a href='http://www.djcbsoftware.nl/code/mu/'>mu</a>, and <a href='http://www.djcbsoftware.nl/code/mu/mu4e.html'>mu4e</a>, and how to set them up quickly. In this tutorial I’ll assume that you’re going to get your messages from <a href='https://gmail.com'>Gmail</a> via its IMAP interface.</p><h2>Table of contents</h2><ul><li><a href='#fetching'>Fetching messages</a><ul><li><a href='#fetchinstallation'>Installation</a></li><li><a href='#fetchconfiguration'>Configuration</a></li><li><a href='#fetchexecution'>Execution</a></li></ul></li><li><a href='#reading'>Reading messages</a><ul><li><a href='#readinstallation'>Installation</a></li><li><a href='#readconfiguration'>Configuration</a></li><li><a href='#readexecution'>Execution</a></li></ul></li><li><a href='#encryption'>Encryption</a></li><li><a href='#closing'>Closing remarks</a></li></ul><h2>Fetching messages <a name="fetching"></a></h2><p>You first need to have a way to download your mails, off your mail server. A easy-to-use application that will do that for you is <a href='http://pyropus.ca/software/getmail/'>getmail</a>.</p><h3>Installation <a name="fetchinstallation"></a></h3><p>Most of the time, getmail can be readily installed via your system’s package manager.</p><p>Nix:</p><pre><code>$ nix-env -i getmail</code></pre><p>APT:</p><pre><code>$ sudo apt-get install getmail4</code></pre><p>However, if your system doesn’t provide an easy way for you to install getmail, you can always head to its <a href='http://pyropus.ca/software/getmail/'>homepage</a> , then download the tarball.</p><h3>Configuration <a name="fetchconfiguration"></a></h3><p>Next, you need to conjure the incantation so that getmail knows how to get your stuff. Create the file <code>&#126;/.getmail/getmailrc</code>. In addition to that, you need to create and specify where the messages will go:</p><pre><code>$ mkdir &#126;/Maildir
$ mkdir &#126;/.getmail
$ emacs &#126;/.getmail/getmailrc</code></pre><p>Then put in the following:</p><pre><code>&#91;retriever&#93;
type = SimpleIMAPSSLRetriever
server = imap.gmail.com
username = USERNAME@gmail.com
password = PASSWORD

&#91;destination&#93;
type = Maildir
path = &#126;/Maildir/

&#91;options&#93;
verbose = 2
message&#95;log = &#126;/.getmail/gmail.log
read&#95;all = false
delivered&#95;to = false
received = false
</code></pre><p>Replace <i>USERNAME</i> with your Gmail username, then replace <i>PASSWORD</i> with your Gmail password. However, if you are using <a href='https://www.google.com/landing/2step/'>2-step authentication</a>, use an <a href='https://accounts.google.com/IssuedAuthSubTokens'>application-specific</a> password for the password field. Take note, that <code>&#126;/Maildir</code> is the default directory that Mail Transfer Agents (MTA) which use the <a href='https://en.wikipedia.org/wiki/Maildir'>maildir</a> format use, to store data.</p><h3>Execution <a name="fetchexecution"></a></h3><p>To verify that you can indeed fetch your messages, run getmail:</p><pre><code>$ getmail</code></pre><p>If it doesn’t choke, and displays something like the following, then you have configured getmail correctly.</p><pre><code class="bash">getmail version 4.43.0
Copyright &#40;C&#41; 1998-2012 Charles Cazabon.  Licensed under the GNU GPL version 2.
SimpleIMAPSSLRetriever:foobar@gmail.com@imap.gmail.com:993:
...
</code></pre><h2>Reading messages <a name="reading"></a></h2><p>Now that you can download your messages, you need to have a way to read them. This is where mu and the accompanying emacs-based client, <i>mu</i>, comes in.</p><h3>Installation <a name="readinstallation"></a></h3><p>Just like with getmail above, chances are, mu can be installed via your system’s package manager.</p><p>Nix:</p><pre><code>$ nix-env -i mu</code></pre><p>APT:</p><pre><code>$ sudo apt-get install maildir-utils</code></pre><p>In addition to the above, you need to fetch mu4e. This comes with mu’s source code. Download it by running:</p><pre><code>$ mkdir &#126;/.emacs.d
$ cd &#126;/.emacs.d
$ git clone git@github.com:djcb/mu.git</code></pre><p>This creates a <code>mu/</code> directory in the current directory, which happens to be the default location from which emacs looks for init files. Take note, that the git command above actually fetches the source code of mu, and you can actually use it to install mu. But since, you have your package manager, you’ll ignore that. Also the location from which the <code>mu/mu4e/</code> subdirectory exists from the package manager’s installation, varies between systems. So, for now, you’re only interested with the <code>mu/mu4e/</code> subdirectory.</p><h3>Configuration <a name="readconfiguration"></a></h3><p>You now need to make that mu4e directory accessible to emacs. To do so, you need to edit either <code>&#126;/.emacs.d/init.el</code> or <code>&#126;/.emacs</code>:</p><pre><code>$ emacs &#126;/.emacs.d/init.el</code></pre><p>Then add the following:</p><pre><code class="lisp">&#40;setq load-path &#40;append load-path '&#40;&quot;&#126;/.emacs.d/mu/mu4e&quot;&#41;&#41;&#41;
&#40;require 'mu4e&#41;
</code></pre><p>Additionally you need to put in some information about you, so that emacs won’t bother asking you about those details later on:</p><pre><code class="lisp">&#40;setq user-full-name &quot;Foo B. Baz&quot;
      user-mail-address &quot;foo@bar.baz&quot;&#41;
</code></pre><p>To make your life even easier, you’ll set some variables:</p><pre><code class="lisp">&#40;setq mu4e-get-mail-command &quot;getmail&quot;
      mu4e-update-interval 300
      mu4e-attachment-dir &quot;&#126;/Downloads&quot;&#41;
</code></pre><h3>Execution <a name="readexecution"></a></h3><p>You can restart emacs so that those settings can take effect, or alternatively, you can mark those lines with <kbd>C-Space</kbd>, then hit:</p><pre><code>M-x eval-region RET</code></pre><p>At this point, you can now use mu4e, by hitting:</p><pre><code>M-x mu4e RET</code></pre><p>You’ll get a sexy menu, wherein you can hit shortcuts to get you to where you want. To compose a message, hit <kbd>C</kbd>, fill in the fields, then hit <kbd>C-c C-c</kbd> to send the message. The rest of the commands should be self-explanatory, but if you want to learn more, you can read the nice <a href='http://www.djcbsoftware.nl/code/mu/mu4e/index.html'>mu4e manual</a>.</p><h2>Encryption <a name="encryption"></a></h2><p>Optionally, you may want to add some tweaks so that encryption and decryption of messages, will be easier. This is actually one of my primary reasons why I’m using mu4e—it has been pointed out to me that despite using browser extensions like <a href='http://getfiregpg.org/s/home'>FireGPG</a>, and <a href='https://addons.mozilla.org/en-US/firefox/addon/its-all-text/'>It’s All Text!</a>, the supposedly private message that you composed got auto-saved by default to the <i>Drafts</i> folder. This implies, that your unencrypted message, was still saved somewhere. Ahem.</p><p>To make use of these cryptographic utilities, edit your emacs init:</p><pre><code>$ emacs &#126;/.emacs.d/init.el</code></pre><p>Then add the following:</p><pre><code class="lisp">&#40;require 'mml2015&#41;
&#40;require 'epa-file&#41;

&#40;defun encrypt-message &#40;&amp;optional arg&#41;
  &#40;interactive &quot;p&quot;&#41;
  &#40;mml-secure-message-encrypt-pgp&#41;&#41;

&#40;defun decrypt-message &#40;&amp;optional arg&#41;
  &#40;interactive &quot;p&quot;&#41;
  &#40;epa-decrypt-armor-in-region &#40;point-min&#41; &#40;point-max&#41;&#41;&#41;

&#40;defalias 'ec 'encrypt-message&#41;
&#40;defalias 'dc 'decrypt-message&#41;
</code></pre><p>Mark those lines, then hit:</p><pre><code>M-x eval-region RET</code></pre><p>To make the settings take effect, immediately.</p><p>To send an encrypt a message, hit <kbd>C</kbd> from the main menu of mu4e, fill in the usual fields like <code>To:</code>, and <code>Subject:</code>, then on the message body, hit:</p><pre><code>M-x ec RET</code></pre><p>This will tag your outgoing message to be signed and encrypted. To send the it, hit <kbd>C-c C-c</kbd>. This will then prompt you to input your passphrase. It will also ask you to fill in some information regarding your outgoing mail server (SMTP). The SMTP server for Gmail is <em>smtp.gmail.com</em>, then use <code>USERNAME@gmail</code>.com when prompted for the username. Use your regular password, when prompted, or input your application-specific password, as described earlier. These information will be saved to <code>&#126;/.authinfo</code>, and will be used for later messages.</p><p>To decrypt a message, open the message, then hit:</p><pre><code>M-x dc RET</code></pre><p>This will prompt you to input your passphrase. After which, you’ll be prompted if you’ll want to replace the contents of the buffer, say yes to this.</p><p>These approaches are not fool-proof, because there’s at least two gaping holes that you have to be aware of—Emacs backups, and mu4e drafts. With the former, when you are using Emacs’s backup facility, or a package like <a href='https://www.emacswiki.org/emacs/BackupDirectory'>backup-dir</a>, messages that you compose, presumably before you encrypt it, will have an unencrypted copy to the local disk. With the latter, the same principle applies. So be wary of these situations, and tweak your configuration, as necessary.</p><h2>Closing remarks <a name="closing"></a></h2><p>Bear in mind that I purposely avoided fleshing out many details, as it would conflate the attempt of this article to make things simple. However, if you want to learn more, you can always go to the <a href='http://pyropus.ca/software/getmail/documentation.html'>getmail</a> and <a href='http://www.djcbsoftware.nl/code/mu/mu4e/index.html'>mu4e</a> documentation, to fill in missing gaps, that you may have.</p><hr/><div class="footer"><p><div class="text-small"> <a href='/en'>Home</a>  <a href='/en/about'>About</a>  <a href='/en/quotes'>Quotes</a>  <a href='/en/words'>Words</a>  <a href='https://github.com/ebzzry/ebzzry.github.io'>Source</a> </div> <div class="text-x-small"> Site created with <a href='https://github.com/ebzzry/emem'>emem</a> </div></p><p><div class="text-x-small"> <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" class="cc" src="/images/cc4-88x31.png" /></a><br> This work by <a xmlns:cc="http://creativecommons.org/ns#" href="http://ebzzry.io" property="cc:attributionName" rel="cc:attributionURL">Rommel Martinez</a> is licensed under a<br> <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Common Attribution 4.0 International License</a>. </div></p><p></div></p></div><script src="/static/js/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create', 'UA-93746003-1', 'auto');ga('send', 'pageview');</script></body></html>