<!DOCTYPE html>
<html lang="en"><head><title>Emacs Tips and Tricks 2: Sessions and Packages</title><meta charset="utf-8" /><meta content="width=device-width,initial-scale=1.0,user-scalable=yes" name="viewport" /><meta content="noodp,noydir" name="robots" /><meta content="Emacs Tips and Tricks 2: Sessions and Packages" name="description" /><meta content="emacs, tips, sessions, packages, desktop, savehist, packages, elpa, melpa, line numbers, time stamps, keys, newline, filling, cursor, git, configuration, setup, settings" name="keywords" /><meta content="Emacs Tips and Tricks 2: Sessions and Packages" property="og:title" /><meta content="article" property="og:type" /><meta content="https://ebzzry.io/en/emacs-tips-2/" property="og:url" /><meta content="https://ebzzry.io/static/ico/android-chrome-512x512.png" property="og:image" /><link href="/static/ico/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180" /><link href="/static/ico/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" /><link href="/static/ico/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" /><link href="/static/ico/manifest.json" rel="manifest" /><link color="#5bbad5" href="/static/ico/safari-pinned-tab.svg" rel="mask-icon" /><meta content="#ffffff" name="theme-color" /><style media="all" type="text/css">html {    color: #333;    font-size: 1em;    font-family: Georgia, Cambria, Palatino, "Palatino Linotype", "Times New Roman", Times, serif;    line-height: 1.45;    text-align: left:    width: 100%;    max-width: 40em;    margin: 0 auto 0 auto;    padding: 0;}body {    border-top: hidden;    border-bottom: hidden;    padding: 0 1.5em 1em 1.5em;    margin: 0;}#content {    -webkit-column-count: 1;    -moz-column-count: 1;    column-count: 1;}code {    font-size: 0.9em;    font-family: "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Lucida Console", "Courier New", Courier, monospace;    color: black;    display: inline-block;    font-weight: bold;}pre code {    font-size: 1em;    font-family: monospace;    line-height: 1.3em;    overflow: auto;    font-weight: normal;}kbd {    font-size: 1.1em;    padding: 0.1em 0.6em;    border: 1px solid #ccc;    font-family: monospace;    background-color: #f7f7f7;    color: #333;    -moz-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    -webkit-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    -moz-border-radius: 3px;    -webkit-border-radius: 3px;    border-radius: 3px;    display: inline-block;    margin: 0 0.1em;    text-shadow: 0 1px 0 #fff;    white-space: nowrap;}h1, h2, h3, h4, h5, h6 {    font-family: Calibri, "Gill Sans", "Gill Sans MT", "Myriad Pro", Myriad, "DejaVu Sans", Tahoma, Geneva, Helvetica, Arial, sans-serif;    margin-bottom: 0;}h1 {    font-size: 2.5em;    text-align: center;    border-bottom: 6px solid black;}h2 {    font-size: 2.0em;    text-align: left;    border-bottom: 2px solid black;}h3 {    font-size: 1.6em;    text-align: left;    border-bottom: 1px solid lightgrey;}h4 {    font-size: 1.5em;    text-align: left;}h5 {    font-size: 1.3em;    text-align: left;}ul, ol {    padding-left: 2em;}ul li {    list-style-type: square;}ul li li {    list-style-type: disc;}ul li li li {    list-style-type: circle;}ol li {    list-style-type: decimal;}p, para, b, strong, i, em, emph {    font-size: 1em;}blockquote {    font-size: 1.2em;    font-style: italic;    margin-left: 2em;}b, strong {    font-weight: bold;}i, em, emph {    font-style: italic;}table {    margin: 0.5em;    border-spacing: 0;    border-collapse: collapse;}th, td {    border: 1px solid lightgray;    padding-top: 0;    padding-bottom: 0;    padding-left: 0.45em;    padding-right: 0.45em;}.text-right {    text-align: right;}.text-small {    font-size: small;}.text-x-small {    font-size: x-small;}.banner {    display: block;    width: 100%;    margin-left: auto;    margin-right: auto;}.footer {    text-align: right;    float: right;    max-width: 18em;}.cc {    border-width: 0}.center {    text-align: center;}</style><style media="all" type="text/css">/* Ewan Themes -- based 99.99% from Tomorrow Night Theme *//* http://jmblog.github.com/color-themes-for-google-code-highlightjs *//* Original theme - https://github.com/chriskempson/tomorrow-theme *//* http://jmblog.github.com/color-themes-for-google-code-highlightjs *//* Tomorrow Comment */.hljs-comment {  color: #969896;}/* Tomorrow Red */.hljs-variable,.hljs-attribute,.hljs-tag,.hljs-regexp,.ruby .hljs-constant,.xml .hljs-tag .hljs-title,.xml .hljs-pi,.xml .hljs-doctype,.html .hljs-doctype,.css .hljs-id,.css .hljs-class,.css .hljs-pseudo {  color: #cc6666;}/* Tomorrow Orange */.hljs-number,.hljs-preprocessor,.hljs-pragma,.hljs-built_in,.hljs-literal,.hljs-params,.hljs-constant {  color: #de935f;}/* Tomorrow Yellow */.ruby .hljs-class .hljs-title,.css .hljs-rule .hljs-attribute {  color: #f0c674;}/* Tomorrow Green */.hljs-string,.hljs-value,.hljs-inheritance,.hljs-header,.hljs-name,.ruby .hljs-symbol,.xml .hljs-cdata {  color: #b5bd68;}/* Tomorrow Aqua */.hljs-title,.css .hljs-hexcolor {  color: #8abeb7;}/* Tomorrow Blue */.hljs-function,.python .hljs-decorator,.python .hljs-title,.ruby .hljs-function .hljs-title,.ruby .hljs-title .hljs-keyword,.perl .hljs-sub,.javascript .hljs-title,.coffeescript .hljs-title {  color: #81a2be;}/* Tomorrow Purple */.hljs-keyword,.javascript .hljs-function {  color: #b294bb;}.hljs {  display: block;  overflow-x: auto;  background: #1d1f21;  color: #c5c8c6;  padding: 0.5em;  -webkit-text-size-adjust: none;}.coffeescript .javascript,.javascript .xml,.tex .hljs-formula,.xml .javascript,.xml .vbscript,.xml .css,.xml .hljs-cdata {  opacity: 0.5;}pre code {    font-size: 1.1em;    font-family: monospace;    line-height: 1.3em;    overflow: auto;}</style></head><body><div id="content"><h1>Emacs Tips and Tricks 2: Sessions and Packages</h1><p><div class="center">June 12, 2015</div> <div class="center">Updated: October 18, 2017</div></p><p>This is the continuation of my series on Emacs tips and tricks. In this article, we explore session management, packages, managing indents, and other nice little things.</p><h2>Table of contents</h2><ul><li><a href='#desktop'>Desktop</a></li><li><a href='#savehist'>Savehist</a></li><li><a href='#consolidation'>Consolidation</a></li><li><a href='#packages'>Packages</a><ul><li><a href='#elpa'>ELPA</a></li><li><a href='#use-package'>use-package</a></li></ul></li><li><a href='#linenumbers'>Line numbers</a></li><li><a href='#timestamps'>Timestamps</a></li><li><a href='#keys'>Keys</a></li><li><a href='#newline'>Newline sans indent</a></li><li><a href='#filling'>Filling</a></li><li><a href='#cursormovement'>Cursor movement</a></li><li><a href='#gitdired'>Git status in dired</a></li><li><a href='#keybindings'>Key bindings</a></li><li><a href='#closing'>Closing remarks</a></li></ul><h2><a name="desktop"></a> Desktop</h2><p>An indispensable tool that I use now is desktop. It saves the state of my Emacs session, so that in the event of crash, power outage, or anything that will make me lose my session, I can back to it. Desktop comes built-in with the recent versions of GNU Emacs. Here's my snippet:</p><pre><code class="lisp">&#40;require 'desktop&#41;

&#40;desktop-save-mode&#41;

&#40;setq desktop-dirname &quot;&#126;/.emacs.d&quot;
      desktop-base-file-name &quot;desktop&quot;
      desktop-base-lock-name &quot;desktop.lock&quot;
      desktop-restore-frames t
      desktop-restore-reuses-frames t
      desktop-restore-in-current-display t
      desktop-restore-forces-onscreen t&#41;

&#40;defun desktop-save &#40;&#41;
  &#40;interactive&#41;
  &#40;if &#40;eq &#40;desktop-owner&#41; &#40;emacs-pid&#41;&#41;
      &#40;desktop-save desktop-dirname&#41;&#41;&#41;
</code></pre><h2><a name="savehist"></a> Savehist</h2><p>Another important functionality that I use is savehist. It saves the minibuffer history. It’s roughly similar to saving the command line history. Here’s my snippet</p><pre><code class="lisp">&#40;savehist-mode t&#41;

&#40;setq savehist-file &quot;&#126;/.emacs.d/savehist&quot;&#41;
</code></pre><h2><a name="consolidation"></a> Consolidation</h2><p>No, that is not the name of a library. However, there were a lot of times, when I want to manually save the state of as much session information that I could save. I’d want to save the buffers, minibuffer history, bookmarks, and comint mode histories. To do that, I have the following:</p><pre><code class="lisp">&#40;defun save-defaults &#40;&#41;
  &#40;desktop-save desktop-dirname&#41;
  &#40;savehist-save&#41;
  &#40;bookmark-save&#41;&#41;

&#40;defun save-histories &#40;&#41;
  &#40;let &#40;&#40;buf &#40;current-buffer&#41;&#41;&#41;
    &#40;save-excursion
      &#40;dolist &#40;b &#40;buffer-list&#41;&#41;
        &#40;switch-to-buffer b&#41;
        &#40;save-history&#41;&#41;&#41;
    &#40;switch-to-buffer buf&#41;&#41;&#41;

&#40;defun save &#40;&#41;
  &#40;interactive&#41;
  &#40;save-desktop&#41;
  &#40;save-defaults&#41;
  &#40;save-histories&#41;&#41;
</code></pre><p>This gives you a nice:</p><pre><code>M-x save RET
</code></pre><h2><a name="packages"></a> Packages</h2><h3><a name="elpa"></a> ELPA</h3><p>If you aren’t using the package system yet, use it now. All you need to get started is the following:</p><pre><code class="lisp">&#40;require 'package&#41;

&#40;setq package-archives
      '&#40;&#40;&quot;gnu&quot; . &quot;http://elpa.gnu.org/packages/&quot;&#41;
        &#40;&quot;marmalade&quot; . &quot;http://marmalade-repo.org/packages/&quot;&#41;
        &#40;&quot;melpa&quot; . &quot;http://melpa.milkbox.net/packages/&quot;&#41;&#41;&#41;

&#40;package-initialize&#41;

&#40;defalias 'pi 'package-install&#41;
&#40;defalias 'pl 'package-list-packages&#41;
</code></pre><p>To list all the available packages, hit:</p><pre><code>M-x pl RET
</code></pre><p>If you know the name of package, hit:</p><pre><code>M-x pi RET package RET
</code></pre><h3><a name="use-package"></a> use-package</h3><p>This one is a real gem. It’s like <code>require</code>, but on steroids. When “requiring” a package, you have the option to specify to install that package, if it does not exist, yet. It also enables you to configure that package, in a unified expression. But unlike <code>require</code>, <code>use-package</code> does not come built-in with Emacs. You need to install it via <code>package-install</code>:</p><pre><code>M-x pi RET use-package RET
</code></pre><p>You can then require it, on subsequent uses:</p><pre><code class="lisp">&#40;require 'use-package&#41;
</code></pre><p>To install <code>markdown-mode</code>, even if it doesn’t exist yet, and configure its related options, after loading it, have:</p><pre><code class="lisp">&#40;use-package markdown-mode
    :ensure t
    :config
    &#40;progn
      &#40;push '&#40;&quot;\\.text\\'&quot; . markdown-mode&#41; auto-mode-alist&#41;
      &#40;push '&#40;&quot;\\.markdown\\'&quot; . markdown-mode&#41; auto-mode-alist&#41;
      &#40;push '&#40;&quot;\\.md\\'&quot; . markdown-mode&#41; auto-mode-alist&#41;&#41;&#41;
</code></pre><h2><a name="linenumbers"></a> Line numbers</h2><p>I really like to have the line numbers displayed at the left margin. It gives me a rough idea how big the file is, and where am I currently. Turning on <code>linum-mode</code> achieves it:</p><pre><code class="lisp">&#40;setq linum-format &quot;%4d&quot;&#41;

&#40;defun my-linum-mode-hook &#40;&#41;
  &#40;linum-mode t&#41;&#41;

&#40;add-hook 'find-file-hook 'my-linum-mode-hook&#41;
</code></pre><h2><a name="timestamps"></a> Timestamps</h2><p>I frequently find the need to insert timestamps, especially when I'm editing my daily log file. Here are some snippets to help you with it:</p><pre><code class="lisp">&#40;defun format-date &#40;format&#41;
  &#40;let &#40;&#40;system-time-locale &quot;en&#95;US.UTF-8&quot;&#41;&#41;
    &#40;insert &#40;format-time-string format&#41;&#41;&#41;&#41;

&#40;defun insert-date &#40;&#41;
  &#40;interactive&#41;
  &#40;format-date &quot;%A, %B %d %Y&quot;&#41;&#41;

&#40;defun insert-date-and-time &#40;&#41;
  &#40;interactive&#41;
  &#40;format-date &quot;%Y-%m-%d %H:%M:%S&quot;&#41;&#41;
</code></pre><p>The code above sets the correct value for <code>system-time-locale</code>, and binds keys for <code>insert-date/long</code> and <code>insert-date/short</code>.</p><h2><a name="keys"></a> Keys</h2><p>When your key bindings are not organized, it’s not easy to find what key did you bind to what. Fortunately, you have <code>bind-key</code>, which comes as part of <code>use-package</code>.</p><p>An example would look like:</p><pre><code class="lisp">&#40;bind-keys
 :map global-map
 &#40;&quot;C-;&quot; . eval-expression&#41;
 &#40;&quot;C-j&quot; . delete-indentation&#41;&#41;
</code></pre><h2><a name="newline"></a> Newline sans indent</h2><p>This command creates a newline, then moves the cursor. It simulates a behavior wherein the new line doesn’t indent.</p><pre><code class="lisp">&#40;defun newline-and-no-indent &#40;&amp;optional arg&#41;
  &#40;interactive &quot;p&quot;&#41;
  &#40;open-line arg&#41;
  &#40;next-line arg&#41;&#41;
</code></pre><h2><a name="filling"></a> Filling</h2><p>This snippet works great when working when working with plain text. It indent a paragraph, or the current paragraph context. If there is a mark, the region becomes filled.</p><pre><code class="lisp">&#40;defun fill-region-or-paragraph &#40;&#41;
  &#40;interactive&#41;
  &#40;if &#40;region-active-p&#41;
      &#40;fill-region&#41;
      &#40;fill-paragraph&#41;&#41;&#41;
</code></pre><h2><a name="cursormovement"></a> Cursor movement</h2><p>The command <code>move-to-window-line-top-bottom</code>, bound by default to <kbd>M-r</kbd> is great when you want to move the cursor from the center, top, and bottom position, relative to the window, similar to Vim’s <kbd>H</kbd>, <kbd>M</kbd>, and <kbd>L</kbd> commands. However, it’s not very efficient when specifically targetting areas of the screen. The commands below position point, specifically to the top, center, and bottom window positions, respectively.</p><pre><code class="lisp">&#40;defun move-to-window-line-top &#40;&#41;
  &#40;interactive&#41;
  &#40;move-to-window-line 0&#41;&#41;

&#40;defun move-to-window-line-center &#40;&#41;
  &#40;interactive&#41;
  &#40;move-to-window-line nil&#41;&#41;

&#40;defun move-to-window-line-bottom &#40;&#41;
  &#40;interactive&#41;
  &#40;move-to-window-line -1&#41;&#41;
</code></pre><h2><a name="gitdired"></a> Git status in dired</h2><p>This small snippet gives visual indications of the status of git-managed files in a Dired buffer. Pressing <kbd>g</kbd> reloads the buffer, then updates the status.</p><pre><code class="lisp">&#40;use-package dired-k
    :ensure t
    :config
  &#40;progn
    &#40;add-hook 'dired-initial-position-hook 'dired-k&#41;&#41;&#41;
</code></pre><h2><a name="keybindings"></a> Key bindings</h2><p>The key bindings for the commands above, are listed below:</p><pre><code class="lisp">&#40;bind-keys
 :map global-map
 &#40;&quot;C-c d&quot;   . insert-date&#41;
 &#40;&quot;C-c C-d&quot; . insert-date-and-time&#41;

 &#40;&quot;S-&lt;return&gt;&quot; . newline-and-no-indent&#41;

 &#40;&quot;M-q&quot; . fill-region-or-paragraph&#41;

 &#40;&quot;C-M-y&quot; . yank-primary&#41;

 &#40;&quot;M-1&quot; . move-to-window-line-top&#41;
 &#40;&quot;M-2&quot; . move-to-window-line-center&#41;
 &#40;&quot;M-3&quot; . move-to-window-line-bottom&#41;&#41;

&#40;bind-keys
 :map dired-mode-map
 &#40;&quot;K&quot; . dired-k&#41;
 &#40;&quot;g&quot; . dired-k&#41;&#41;
</code></pre><h2><a name="closing"></a> Closing remarks </h2><p>In this post, I demonstrated that small tweaks can generate huge benefits. The rest of the configuration can be found <a href='https://github.com/ebzzry/dotfiles/tree/master/emacs'>here</a>. If you have an Emacs hack to share, send a pull request!</p><hr/><div class="footer"><p><div class="text-small"> <a href='/en'>Home</a>  <a href='/en/about'>About</a>  <a href='/en/quotes'>Quotes</a>  <a href='/en/words'>Words</a>  <a href='https://github.com/ebzzry/ebzzry.github.io'>Source</a> </div> <div class="text-x-small"> Site created with <a href='https://github.com/ebzzry/emem'>emem</a> </div></p><p><div class="text-x-small"> <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/deed.en"><img alt="Creative Commons Attribution-ShareAlike 4.0 International License" class="cc" src="/images/cc4-sa-88x31.png" /></a><br> This work by is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/deed.en">CC BY-SA 4.0 License.</a><br> </div></p><p></div></p></div><script src="/static/js/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create', 'UA-93746003-1', 'auto');ga('send', 'pageview');</script></body></html>