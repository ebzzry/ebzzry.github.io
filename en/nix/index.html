<!DOCTYPE html>
<html lang="en"><head><title>Nix and Why it Matters</title><meta charset="utf-8" /><meta content="width=device-width,initial-scale=1.0,user-scalable=yes" name="viewport" /><meta content="noodp,noydir" name="robots" /><meta content="A journal about computing, human predilections, and random krakaboom." name="description" /><meta content="ebzzry, rommel, martinez, rommel martinez, journal, blog, krakaboom, y, y combinator, lambda, lambda calculus, lisp, scheme, racket, clojure, haskell, fallacies, symbols, marks, symbols and marks, emacs, emacs hacks, emacs tutorials, emacs commands, emacs basics, dired, retrospect, livefrog, usync, essays, english, esperanto, verb tenses, git, github, primer, introduction, linux, macos, kvm, frog, ugarit, gpg, ssh, division by zero, communicate, human, communicate like a human, human predilections, predilections, computing, inspiration, quotes, famous quotes, words, emem" name="keywords" /><meta content="Nix and Why it Matters" property="og:title" /><meta content="article" property="og:type" /><meta content="http://ebzzry.io/en/nix/" property="og:url" /><meta content="http://ebzzry.io/static/ico/android-chrome-512x512.png" property="og:image" /><link href="/static/ico/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180" /><link href="/static/ico/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" /><link href="/static/ico/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" /><link href="/static/ico/manifest.json" rel="manifest" /><link color="#5bbad5" href="/static/ico/safari-pinned-tab.svg" rel="mask-icon" /><meta content="#ffffff" name="theme-color" /><style media="all" type="text/css">html {    color: #333;    font-size: 1em;    font-family: Georgia, Cambria, Palatino, "Palatino Linotype", "Times New Roman", Times, serif;    line-height: 1.45;    text-align: left:    width: 100%;    max-width: 40em;    margin: 0 auto 0 auto;    padding: 0;}body {    border-top: hidden;    border-bottom: hidden;    padding: 0 1.5em 1em 1.5em;    margin: 0;}#content {    -webkit-column-count: 1;    -moz-column-count: 1;    column-count: 1;}code {    font-size: 0.9em;    font-family: "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Lucida Console", "Courier New", Courier, monospace;    color: black;    display: inline-block;    font-weight: bold;}pre code {    font-size: 1em;    font-family: monospace;    line-height: 1.3em;    overflow: auto;    font-weight: normal;}kbd {    font-size: 1.1em;    padding: 0.1em 0.6em;    border: 1px solid #ccc;    font-family: monospace;    background-color: #f7f7f7;    color: #333;    -moz-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    -webkit-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    -moz-border-radius: 3px;    -webkit-border-radius: 3px;    border-radius: 3px;    display: inline-block;    margin: 0 0.1em;    text-shadow: 0 1px 0 #fff;    white-space: nowrap;}h1, h2, h3, h4, h5, h6 {    font-family: Calibri, "Gill Sans", "Gill Sans MT", "Myriad Pro", Myriad, "DejaVu Sans", Tahoma, Geneva, Helvetica, Arial, sans-serif;    margin-bottom: 0;}h1 {    font-size: 2.5em;    text-align: center;    border-bottom: 6px solid black;}h2 {    font-size: 2.0em;    text-align: left;    border-bottom: 2px solid black;}h3 {    font-size: 1.6em;    text-align: left;    border-bottom: 1px solid lightgrey;}h4 {    font-size: 1.5em;    text-align: left;}h5 {    font-size: 1.3em;    text-align: left;}ul, ol {    padding-left: 2em;}ul li {    list-style-type: square;}ul li li {    list-style-type: disc;}ul li li li {    list-style-type: circle;}ol li {    list-style-type: decimal;}p, para, b, strong, i, em, emph {    font-size: 1em;}blockquote {    font-size: 1.2em;    font-style: italic;    margin-left: 2em;}b, strong {    font-weight: bold;}i, em, emph {    font-style: italic;}table {    margin: 0.5em;    border-spacing: 0;    border-collapse: collapse;}th, td {    border: 1px solid lightgray;    padding-top: 0;    padding-bottom: 0;    padding-left: 0.45em;    padding-right: 0.45em;}.text-right {    text-align: right;}.text-small {    font-size: small;}.text-x-small {    font-size: x-small;}.banner {    display: block;    width: 100%;    margin-left: auto;    margin-right: auto;}.footer {    text-align: right;    float: right;    max-width: 18em;}.cc {    border-width: 0}.center {    text-align: center;}</style><style media="all" type="text/css">/* Ewan Themes -- based 99.99% from Tomorrow Night Theme *//* http://jmblog.github.com/color-themes-for-google-code-highlightjs *//* Original theme - https://github.com/chriskempson/tomorrow-theme *//* http://jmblog.github.com/color-themes-for-google-code-highlightjs *//* Tomorrow Comment */.hljs-comment {  color: #969896;}/* Tomorrow Red */.hljs-variable,.hljs-attribute,.hljs-tag,.hljs-regexp,.ruby .hljs-constant,.xml .hljs-tag .hljs-title,.xml .hljs-pi,.xml .hljs-doctype,.html .hljs-doctype,.css .hljs-id,.css .hljs-class,.css .hljs-pseudo {  color: #cc6666;}/* Tomorrow Orange */.hljs-number,.hljs-preprocessor,.hljs-pragma,.hljs-built_in,.hljs-literal,.hljs-params,.hljs-constant {  color: #de935f;}/* Tomorrow Yellow */.ruby .hljs-class .hljs-title,.css .hljs-rule .hljs-attribute {  color: #f0c674;}/* Tomorrow Green */.hljs-string,.hljs-value,.hljs-inheritance,.hljs-header,.hljs-name,.ruby .hljs-symbol,.xml .hljs-cdata {  color: #b5bd68;}/* Tomorrow Aqua */.hljs-title,.css .hljs-hexcolor {  color: #8abeb7;}/* Tomorrow Blue */.hljs-function,.python .hljs-decorator,.python .hljs-title,.ruby .hljs-function .hljs-title,.ruby .hljs-title .hljs-keyword,.perl .hljs-sub,.javascript .hljs-title,.coffeescript .hljs-title {  color: #81a2be;}/* Tomorrow Purple */.hljs-keyword,.javascript .hljs-function {  color: #b294bb;}.hljs {  display: block;  overflow-x: auto;  background: #1d1f21;  color: #c5c8c6;  padding: 0.5em;  -webkit-text-size-adjust: none;}.coffeescript .javascript,.javascript .xml,.tex .hljs-formula,.xml .javascript,.xml .vbscript,.xml .css,.xml .hljs-cdata {  opacity: 0.5;}pre code {    font-size: 1.1em;    font-family: monospace;    line-height: 1.3em;    overflow: auto;}</style></head><body><div id="content"><h1>Nix and Why it Matters</h1><p><div class="center">March 22, 2017 (Wed)</div> <div class="center">Updated: March 26, 2017 (Wed)</div></p><p>Ideas that change the way we do computing come rarely. A lot of the technology that we are using now are just re-hashes of old ones. Layers upon layers of cosmetics envelop old concepts. Entire product lines are based upon this lack of creativity and ingenuity. Old problems are not solved. Instead, these so-called <em>innovative solutions</em> merely around the problem while painting it with a new shade, claiming that at least they made it more colorful. This mentality harms progress in innumerable ways. This gives the false impression that solutions are actually being done. This creates a false sense of assurance of improvements.</p><p>Several years ago <a href='https://nixos.org/~eelco/'>Eelco Dolstra</a> wrote the seminal <a href='https://nixos.org/docs/papers.html'>papers</a> that described radical ways to deploy software. These papers effectively formed the cornerstones of <a href='https://nixos.org/nix/'>Nix</a>, a purely functional package manager language that solves the disease that plagued computing for a long time—package management. In this article I’ll talk about Nix and friends, and how to use them to your advantage.</p><p>The <code>$</code> symbol will be used to indicate the shell prompt for a regular user, while the <code>#</code> symbol will denote the shell for the root user. There are cases when the EUID of a command will be 0 due to the use of sudo.</p><h2>Table of contents</h2><ul><li><a href='#nixos'>NixOS</a></li><li><a href='#nixpkgs'>Nixpkgs</a></li><li><a href='#nix'>Nix</a></li><li><a href='#closing'>Closing remarks</a></li></ul><h2>NixOS <a name="nixos"></a></h2><p>How many times have you had a broken system because you upgraded a software that other components depended on? How many late night stays have you had because you had to make an application work, that you so greatly depend on because the new package that you installed broke it? How many times, when in frustration, you gave up repairing your system and just decided to re-install your system from scratch? Restoring data files is easy; restoring system configuration from the last working state, however, is a one-way ticket to hell.</p><p><a href='https://nixos.org'>NixOS</a> is a Linux distribution that solves that by leveraging on the determinism of Nix and by using a single declarative configuration file that contains all settings in knobs in one place—<code>/etc/nixos/configuration.nix</code>. This file may contain information about your filesystems, users, services, network configuration, input devices, kernel parameters, and more. This means that you can take a <code>configuration.nix</code> of someone, and have his exact system configuration! In NixOS you don’t have to fiddle around the with whole system manually for configuration that want. You don’t have to use ad-hoc solutions to specify a desired configuration state. You don’t need to install additional software to manage system configuration.</p><p>NixOS does not follow the <a href='https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard'>Filesystem Hierarchy Standard (FHS)</a>, effectively preventing additional brain damage.  This gives room for a lot of flexibility and ingenuity. It does not have <code>/usr/</code> and <code>/opt/</code>. It does have <code>/bin/</code>, which contains only <code>sh</code> and <code>/usr/bin/</code> which contains only <code>env</code>, both of which are actually symlinks to the real programs somewhere in <code>/nix/store/</code>. The top-level location for system binaries—the ones installed explicitly by the administrator—are located in <code>/run/curren-system/sw/bin/</code> and <code>/run/curren-system/sw/sbin/</code>. User-installed programs, on the other hand, are available at their respective <code>&#126;/.nix-profile/bin/</code>. These locations cannot be modified through normal means; dedicated programs must be used to write to these trees.</p><h3>Installation</h3><p>Installation of NixOS is straightforward. For bare metal systems, download an installer from <a href='https://nixos.org/nixos/download.html'>nixos.org/nixos/download.html</a>. VM images are also available from that page. For my last installation, I installed with the following setup:</p><ul><li><a href='https://en.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface'>UEFI</a></li><li>USB boot</li><li>Wi-Fi connectivity</li><li><a href='https://en.wikipedia.org/wiki/GUID_Partition_Table'>GUID Partition Table (GPT)</a></li><li><a href='https://en.wikipedia.org/wiki/Linux_Unified_Key_Setup'>LUKS</a> over <a href='https://en.wikipedia.org/wiki/Logical_volume_management'>LVM</a></li></ul><h4>Booting</h4><p>Boot from the USB drive in UEFI mode. In the login prompt, login as <code>root</code>.</p><h4>Setup networking</h4><p>Scan for available networks</p><pre><code class="bash"># nmcli d wifi list
</code></pre><p>Then, connect to the router of choice</p><pre><code class="bash"># nmcli d wifi con Foobarbaz name Foo password supersecretkey
</code></pre><h4>Prepare the disk</h4><p>Create the partitions:</p><pre><code class="bash"># gdisk /dev/sda
sda1: EF00 &#40;EFI system&#41;, 512 MiB
sda2: 8E00 &#40;Linux LVM&#41;, rest
</code></pre><p>Format <code>/dev/sda1</code>:</p><pre><code class="bash"># mkfs.vfat -F32 /dev/sda1
</code></pre><p>Create the physical volume</p><pre><code class="bash"># pvcreate /dev/sda2
</code></pre><p>Create the volume group</p><pre><code class="bash">vgcreate vg /dev/sda2
</code></pre><p>Create the logical volumes</p><pre><code class="bash"># lvcreate -L 20G -n swap vg
# lvcreate -l 100%FREE -n root vg
</code></pre><p>Encrypt root</p><pre><code class="bash"># cryptsetup luksFormat /dev/vg/root
# cryptsetup luksOpen /dev/vg/root root
</code></pre><p>Format root</p><pre><code class="bash"># mkfs.ext4 -j -L root /dev/mapper/root
</code></pre><p>Format swap</p><pre><code class="bash"># mkswap -L /dev/vg/swap
</code></pre><p>Mount the filesystems</p><pre><code class="bash"># mount /dev/mapper/root /mnt
# mkdir /mnt/boot
# mount /dev/sda1 /mnt/boot
</code></pre><p>Enable swap</p><pre><code class="bash"># swapon /dev/vg/swap
</code></pre><h4>Install NixOS to disk</h4><p>Create the base config</p><pre><code class="bash"># nixos-generate-config --root /mnt
</code></pre><p>Edit the config file</p><pre><code class="bash">nano /mnt/etc/nixos/configuration.nix
</code></pre><p>A version of <a href='https://github.com/ebzzry/dotfiles/blob/master/nixos/configuration.nix'>my configuration</a> follows. Replace the values as it suits you.</p><pre><code>{ config, lib, pkgs, ... }:

{
  imports = &#91;
      ./hardware-configuration.nix
  &#93;;

  boot = {
    loader = {
      systemd-boot.enable = true;
      efi.canTouchEfiVariables = true;
    };

    initrd.availableKernelModules = &#91;
      &quot;xhci&#95;pci&quot;
      &quot;ehci&#95;pci&quot;
      &quot;ahci&quot;
      &quot;usb&#95;storage&quot;
      &quot;sd&#95;mod&quot;
      &quot;rtsx&#95;pci&#95;sdmmc&quot;
    &#93;;

    initrd.luks.devices = &#91;
      {
        device = &quot;/dev/vg/root&quot;;
        name = &quot;root&quot;;
        preLVM = false;
      }
    &#93;;

    cleanTmpDir = true;
  };

  fileSystems = &#91;
    {
      device = &quot;/dev/disk/by-uuid/6106-6BF8&quot;;
      fsType = &quot;vfat&quot;;
      mountPoint = &quot;/boot&quot;;
    }

    {
      device = &quot;/dev/mapper/root&quot;;
      fsType = &quot;ext4&quot;;
      mountPoint = &quot;/&quot;;
    }
  &#93;;

  swapDevices = &#91;
    {
      device = &quot;/dev/vg/swap&quot;;
    }
  &#93;;

  networking = {
    hostName = &quot;mehfoo&quot;;
    hostId = &quot;7B1548AE&quot;;
    enableIPv6 = true;
    networkmanager.enable = true;
  };

  environment = {
    systemPackages = with pkgs; &#91; zsh &#93;;
  };

  time.timeZone = &quot;Asia/Manila&quot;;

  security.sudo = {
    enable = true;
    configFile = ''
      Defaults env&#95;reset
      root ALL = &#40;ALL:ALL&#41; ALL
      %wheel ALL = &#40;ALL&#41; SETENV: NOPASSWD: ALL
    '';
  };

  services = {
    xserver = {
      autorun = true;
      defaultDepth = 24;
      enable = true;
      displayManager.kdm.enable = true;
      desktopManager.kde5.enable = true;
      videoDrivers = &#91; &quot;intel&quot; &#93;;
    };
  };

  users = {
    extraUsers.user = {
      isNormalUser = true;
      uid = 1000;
      extraGroups = &#91; &quot;wheel&quot; &quot;networkmanager&quot; &quot;docker&quot; &#93;;
    };
    defaultUserShell = &quot;/run/current-system/sw/bin/zsh&quot;;
  };
}
</code></pre><p>You may save this with:</p><pre><code class="bash"># curl -sSLo /mnt/etc/nixos/configuration.nix https://goo.gl/ZTQcGs
</code></pre><p>A longer version is available with:</p><pre><code class="bash"># curl -sSLo /mnt/etc/nixos/configuration.nix https://goo.gl/K4P7l5
</code></pre><p>Replace the UUID of the disk with the one that you have. Use the command <code>blkid</code> to get the UUIDs. For <code>networking.hostID</code>, use the following command:</p><pre><code class="bash"># cksum /etc/machine-id | while read c rest; do printf &quot;%x&quot; $c; done
</code></pre><p>The above configuration specifies the following, among other things:</p><ul><li>It creates a user <code>mel</code> with full sudo access</li><li>It uses KDE 5 as the desktop environment</li><li>It enables SSH</li><li>It specifies the LUKS parameters</li></ul><p>Install NixOS to the disk:</p><pre><code class="bash"># nixos-install
</code></pre><p>This will parse <code>/etc/nixos/configuration.nix</code>, making sure that there are no errors. This command will download all the necessary packages to match the specification, making sure that no stones are left unturned.</p><p>When the installation completes, reboot your system:</p><pre><code class="bash"># reboot
</code></pre><h3>Configuration</h3><p>After installation, updating your existing configuration is trivial. All you have to do is edit the configuration file then rebuild the system:</p><pre><code class="bash"># nano /etc/nixos/configuration.nix
# nixos-rebuild switch
</code></pre><p>If you make a mistake, the system will notify you of it, instead of proceeding with an incorrect configuration. All the possible knobs are available <a href='https://nixos.org/nixos/options.html'>here</a>. After the system has completed booting, switch to the console <kbd>Ctrl+Alt+F1</kbd>, then login as <code>root</code>, then set a password for the user that we specified in <code>configuration.nix</code>:</p><pre><code class="bash"># passwd user
</code></pre><p>Exit the shell, switch to the graphical interface <kbd>Alt+F7</kbd>, then login as <code>user</code>.</p><h2>Nixpkgs <a name="nixpkgs"></a></h2><p>Nixpkgs is a collection of thousands of packages curated and maintained by users worldwide. Since the source code is in <a href='https://github.com/nixos/nixpkgs'>GitHub</a>, it is able to take advantage of the powerful collaboration models that that platform offers. At the time of writing, there are almost 6500 packages in the collection. It contains a wide array of packages ranging from productivity applications to theorem provers.</p><p>Most of the popular operating systems handle packages well, until, they don’t. As long as you are moving in a straight line, alone, you’ll be fine. Things change, when you introduce other people in the walk. For the whole cast to move in unison, everyone must be strictly connected to one another. If a member decides to break off, and walk on his own, the entire cast becomes crippled. However, if that member clones himself so that the departing copy becomes independent, the original walking cast becomes undisturbed.</p><p>Let’s take the case of a distribution aimed as a multi-user production development environment. When you install Firefox 100, the main binary goes to either <code>/usr/bin/firefox</code> or <code>/usr/local/bin/firefox</code>. All the users then, in this system, will be able to access the application from that path; John, Mary, and Peter are happy. However, when John upgrades it to version 200, the same application that is being used by Mary and Peter are also upgraded. That’s not a good thing if they prefer the old version that works with them! Nixpkgs allows you have multiple versions of a software, without collisions from the other versions. John, Mary, and Peter can all have their versions of Firefox without conflicting with the other versions. How does it do it? It does it by not using a common global location.</p><p>Each user has their own versions of <code>&#126;/.nix-profile</code> and all of the contents of those directories do not contain regular files. Instead, they are all symbolic files to the actual files located in <code>/nix/store/</code>. This directory is where programs and their dependencies are actually installed. The only way to write to that directory is through the Nix-specific programs. There is no way to modify the contents of that directory through normal means. So, when regular user <code>john</code> installs Vim 8, the program becomes installed as something like <code>/nix/store/w4cr4j13lqzry2b8830819vdz3sdypfa-vim-8.0.0329</code>. The characters before the package name is the checksum of all the inputs to build the package. The file <code>/home/john/.nix-profile/bin/vim</code> then points to a symlink to a file in <code>/nix/store/</code> that will lead to the actual Vim binary in <code>/nix/store/w4cr4j13lqzry2b8830819vdz3sdypfa-vim-8.0.0329/bin/vim</code>.</p><h3>Installation</h3><p>Although Nixpkgs nicely complements NixOS, it is not limited to that platform. Nixpkgs can also be installed on other GNU/Linux systems and recent versions of macOS. To install Nixpkgs for your platform, run:</p><pre><code class="bash">$ curl https://nixos.org/nix/install | bash
</code></pre><p>You’ll be prompted to enter credentials for root access via sudo because it will install the resources to <code>/nix/</code>. After the installation, you may also be requested to append a line of command to your shell initialization file. When you spawn a new shell instance, the Nix-specific commands will become available for use.</p><h3>Usage</h3><p>There are two ways to install packages with Nixpkgs: the git checkout, which is the bleeding edge, up-to-the-minute updated version, or by using channels. The <a href='https://github.com/nixos/nixpkgs'>git repository</a>is ideal for people who want to use the latest and greatest available version of a package, or for those who want to test things out. <a href='https://nixos.org/channels/'>Channels</a> on the other hand, are essentially snapshots of the git repository at an earlier version.</p><h4>Git checkout</h4><p>Updates to the git repository happen frequently—aAs you are reading this article, new commits are made to the main tree. To use the git checkout, clone the <a href='https://github.com/nixos/nixpkgs'>repository</a>:</p><pre><code class="bash">$ git clone https://github.com/nixos/nixpkgs &#126;/nixpkgs
</code></pre><p>This command creates a <code>nixpkgs/</code> directory under your home. If your username is <code>ogag</code>, the clone of the repository is available at <code>/home/ogag/nixpkgs/</code> or <code>/Users/ogag/nixpkgs</code>, if you’re using a GNU/Linux or macOS system, respectively.</p><p>To install a package, say emem—a Markdown to HTML converter, using the git checkout, run:</p><pre><code class="bash">$ nix-env -f &#126;/nixpkgs/default.nix -iA emem
</code></pre><p>This will download emem along with all its dependencies, and then it will make the program available to you. To make sure that emem has successfully installed, run:</p><pre><code class="bash">$ emem --version
</code></pre><p>If your doesn’t barf and complain that you’re looking for something that does not exist, and instead you see a version number, it means that you have successfully installed emem.</p><p>To get the most recent changes from the git repo, run:</p><pre><code class="bash">$ cd &#126;/nixpkgs &amp;&amp; git pull origin master
</code></pre><h4>Channels</h4><p>Installing packages via channels is nicer, because the commands to install packages with it are more convenient. The trade-off is that the packages will be out-of-date by a few weeks. If you’re fine with it, then use channels instead of the git checkout.</p><p>Channels are labeled <strong>stable</strong>, <strong>unstable</strong>, or with a specific version number, e.g., <strong>16.09</strong>. For this article, let’s use the unstable channel—it’s not as dated as stable, nor as recent as the git checkout. To subscribe to the unstable channel, run:</p><pre><code class="bash">$ nix-channel --add https://nixos.org/channels/nixpkgs-unstable nixpkgs
</code></pre><p>This fetches the channel labeled <code>nixpkgs-unstable</code> from nixos.org, then installs it to your user profile.</p><p>Uisng the example above, to install emem, run the following commands for NixOS and other systems, respectively:</p><pre><code class="bash">$ nix-env -iA nixos.emem
</code></pre><pre><code class="bash">$ nix-env -iA nixpkgs.emem
</code></pre><p>To update your channels, run:</p><pre><code class="bash">$ nix-channel --update
</code></pre><h3>Other commands</h3><p>To uninstall a package, run:</p><pre><code class="bash">$ nix-env -e emem
</code></pre><p>To list all your installed packages, run:</p><pre><code class="bash">$ nix-env -q --installed
</code></pre><p>To list all available packages, run:</p><pre><code class="bash">$ nix-env -q --available
</code></pre><p>If you know the binary name of a program, and you want to know which package does it belong to, run:</p><pre><code class="bash">$ command-not-found emem
</code></pre><h3>Notes</h3><p>If at any point during the installation of a package, the process is interrupted, the package being installed will not be in a half-baked state. The very last step of installing a package is atomic. The secret to it is that it the operation that makes it available to a user creates a symlink from <code>/nix/store</code>, where the actual program data is, to your profile, which is located at <code>&#126;/.nix-profile/</code>. Symbolic link creation in GNU/Linux and macOS systems are either successful or not.</p><p>On NixOS, the channel used by the root user is important because it is the one used when rebuilding the system when changes to <code>/etc/nixos/configuration.nix</code> are made. To make sure that you using the right channel, list it with:</p><pre><code class="bash">$ sudo nix-channel --list
</code></pre><p>To change the root channel similar to the one used above:</p><pre><code class="bash">$ sudo nix-channel --add https://nixos.org/channels/nixos-unstable nixos
</code></pre><h2>Nix <a name="nix"></a></h2><p>The component that forms the heart of NixOS and Nixpkgs is the <a href='https://nixos.org/nix'>Nix</a> language. It is a declarative language designed in mind to handle packages.</p><p>To make it easier to understand the language, let’s install the Nix REPL. Run the following commands for NixOS and other systems, respectively:</p><pre><code class="bash">$ nix-env -iA nixos.nix-repl
</code></pre><pre><code class="bash">$ nix-env -iA nixpkgs.nix-repl
</code></pre><p>Next, let’s run it. You’ll be greeted with the version number, and the nix-repl prompt. At the time of writing, the latest version is 1.11.8:</p><pre><code class="bash">$ nix-repl
Welcome to Nix version 1.11.8. Type :? for help.

nix-repl&gt;
</code></pre><p>Let’s try out some basic expressions.</p><p>Strings evaluate to themselves:</p><pre><code class="bash">nix-repl&gt; &quot;foo&quot;
&quot;foo&quot;
</code></pre><p>Arithmetic:</p><pre><code class="bash">nix-repl&gt; 6+2
8

nix-repl&gt; 6-2
4

nix-repl&gt; 6&#42;2
12

nix-repl&gt; 6/2
/home/user/6/2
</code></pre><p>Oops, that wasn’t what we expected. Since Nix was designed with files and directories in mind, it made a special case that when a <code>/</code> character is surrounded by non-space characters, it interprets it as a directory path, resulting in an absolute path. To actually perform division, add at least one space before and after the <code>/</code> character:</p><pre><code class="bash">nix-repl&gt; 6 / 2
</code></pre><p>There are no floating point numbers in Nix. So, if you try to evaluate one, you’ll get:</p><pre><code class="bash">nix-repl&gt; 1.0
error: syntax error, unexpected INT, expecting ID or OR&#95;KW or DOLLAR&#95;CURLY or '&quot;', at &#40;string&#41;:1:3
'&quot;'
</code></pre><p>Boolean values:</p><pre><code class="bash">nix-repl&gt; 1 &lt; 2
true

nix-repl&gt; 1 &gt; 2
false

nix-repl&gt; 1 == 1
true

nix-repl&gt; &quot;foo&quot; == &quot;foo&quot;
true
</code></pre><h3>environmonts</h3><ul><li>environments</li></ul><h3>user commands</h3><ul><li>nix-instantiate</li><li>nix-store</li><li>nix-build</li></ul><h3>nix-shell</h3><h3>configuration</h3><ul><li><code>&#126;/.nixpkgs/config.nix</code></li></ul><h3>same package</h3><h3>nix-repl</h3><h2>Closing remarks <a name="closing"></a></h2><p>??? Docker, along with Kubernetes and OpenShift solves a different class of problems. ??? Docker is good at what it does, and it does it well. However, the key philosophy with Docker is that it assumes that the underlying systems may not exhibit reproducibility. Hence, treating them as expendables.</p><ul><li>purely functional</li><li>stateless</li><li>declarative</li><li>Building Declarative Deterministic Systems with Nix</li></ul><p>flatpak</p><hr/><div class="footer"><p><div class="text-small"> <a href='/en'>Home</a>  <a href='about'>About</a>  <a href='quotes'>Quotes</a>  <a href='words'>Words</a>  <a href='https://github.com/ebzzry/ebzzry.github.io'>Source</a> </div> <div class="text-x-small"> Site created with <a href='https://github.com/ebzzry/emem'>emem</a> </div></p><p><div class="text-x-small"> <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" class="cc" src="/images/cc4-88x31.png" /></a><br> This work by <a xmlns:cc="http://creativecommons.org/ns#" href="http://ebzzry.io" property="cc:attributionName" rel="cc:attributionURL">Rommel Martinez</a> is licensed under a<br> <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Common Attribution 4.0 International License</a>. </div></p><p></div></p></div><script src="/static/js/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create', 'UA-93746003-1', 'auto');ga('send', 'pageview');</script></body></html>