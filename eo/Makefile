.PHONY: all clean

DOSIEROJ=$(filter-out fkd/pagxopiedo.md fkd/index.md, $(wildcard fkd/*.md))
KONSTRUILO=emem

OG_TITLE="$$(head -1 $<)"
OG_TYPE="article"
OG_IMAGE="https://ebzzry.io/static/ico/android-chrome-512x512.png"
ANALITIKOJ="93746003-1"

all:
	parallel --will-cite "$(MAKE) {/.}.html" ::: $(DOSIEROJ)
	$(KONSTRUILO) \
          -D "Retejo pri komputiko, homaj inklinoj, kaj hazardaj umoj." \
          -K "ebzzry, rommel, martinez, rommel martinez, pedanta primato" \
          --og-title "Pensoj de Pedanta Primato" \
          --og-type $(OG_TYPE) \
          --og-url "https://ebzzry.io/eo/" \
          --og-image $(OG_IMAGE) \
          --analytics $(ANALITIKOJ) \
          --lang "eo" \
          -RFiamuo index.html \
          fkd/index.md fkd/pagxopiedo.md

%.html: fkd/%.md
	if [[ ! -d "$$(basename $< .md)" ]]; then mkdir "$$(basename $< .md)"; fi
	$(KONSTRUILO) \
          -D $(OG_TITLE) \
          -K "$$(cat $<.dat)" \
          --og-title $(OG_TITLE) \
          --og-type $(OG_TYPE) \
          --og-url "https://ebzzry.io/eo/$$(basename $< .md)/" \
          --og-image $(OG_IMAGE) \
          --analytics $(ANALITIKOJ) \
          --lang "eo" \
          -RFiamuo "$$(basename $< .md)/index.html" \
          $< fkd/pagxopiedo.md

clean:
	rm -vf *.html
	find . -maxdepth 1 -type d ! -path . ! -iname fkd -exec rm -rf {} \;
