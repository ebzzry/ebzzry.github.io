<!DOCTYPE html>
<html lang="eo"><head><title>Skriptado en Komunlispo</title><meta charset="utf-8" /><meta content="width=device-width,initial-scale=1.0,user-scalable=yes" name="viewport" /><meta content="noodp,noydir" name="robots" /><link rel='apple-touch-icon' sizes='180x180' href='/images/ico/apple-touch-icon.png'><link rel='icon' type='image/png' sizes='32x32' href='/images/ico/favicon-32x32.png'><link rel='icon' type='image/png' sizes='16x16' href='/images/ico/favicon-16x16.png'><link rel='manifest' href='/images/ico/site.webmanifest'><link rel='mask-icon' href='/images/ico/safari-pinned-tab.svg' color='#5bbad5'><link rel='shortcut icon' href='/images/ico/favicon.ico'> <meta name='msapplication-TileColor' content='#da532c'> <meta name='msapplication-config' content='/images/ico/browserconfig.xml'> <meta name='theme-color' content='#ffffff'><meta content="Skriptado en Komunlispo" name="description" /><meta content="lispo, komuna lispo, komunlispo, skriptado, linukso" name="keywords" /><meta content="Skriptado en Komunlispo" property="og:title" /><meta content="article" property="og:type" /><meta content="https://ebzzry.io/eo/lispon-skripti/" property="og:url" /><meta content="https://ebzzry.io/images/ico/android-chrome-512x512.png" property="og:image" /><style media="all" type="text/css">html {    color: #333;    font-size: 1em;    font-family: Georgia, Cambria, Palatino, "Palatino Linotype", "Times New Roman", Times, serif;    line-height: 1.45;    text-align: left:    width: 100%;    max-width: 40em;    margin: 0 auto 0 auto;    padding: 0;}body {    border-top: hidden;    border-bottom: hidden;    padding: 0 1.5em 1em 1.5em;    margin: 0;}#content {    -webkit-column-count: 1;    -moz-column-count: 1;    column-count: 1;}code {    font-size: 0.9em;    font-family: "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Lucida Console", "Courier New", Courier, monospace;    color: black;    display: inline-block;    font-weight: bold;}pre code {    font-size: 1em;    font-family: monospace;    line-height: 1.3em;    overflow: auto;    font-weight: normal;}kbd {    font-size: 1.1em;    padding: 0.1em 0.6em;    border: 1px solid #ccc;    font-family: monospace;    background-color: #f7f7f7;    color: #333;    -moz-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    -webkit-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    -moz-border-radius: 3px;    -webkit-border-radius: 3px;    border-radius: 3px;    display: inline-block;    margin: 0 0.1em;    text-shadow: 0 1px 0 #fff;    white-space: nowrap;}h1, h2, h3, h4, h5, h6 {    font-family: Calibri, "Gill Sans", "Gill Sans MT", "Myriad Pro", Myriad, "DejaVu Sans", Tahoma, Geneva, Helvetica, Arial, sans-serif;    margin-bottom: 0;}h1 {    font-size: 2.5em;    text-align: center;    border-bottom: 6px solid black;}h2 {    font-size: 2.0em;    text-align: left;    border-bottom: 2px solid black;}h3 {    font-size: 1.6em;    text-align: left;    border-bottom: 1px solid lightgrey;}h4 {    font-size: 1.5em;    text-align: left;}h5 {    font-size: 1.3em;    text-align: left;}ul, ol {    padding-left: 2em;}ul li {    list-style-type: square;}ul li li {    list-style-type: disc;}ul li li li {    list-style-type: circle;}ol li {    list-style-type: decimal;}p, para, b, strong, i, em, emph {    font-size: 1em;}blockquote {    font-size: 1.2em;    font-style: italic;    margin-left: 2em;}b, strong {    font-weight: bold;}i, em, emph {    font-style: italic;}table {    margin: 0.5em;    border-spacing: 0;    border-collapse: collapse;}th, td {    border: 1px solid lightgray;    padding-top: 0;    padding-bottom: 0;    padding-left: 0.45em;    padding-right: 0.45em;}.text-right {    text-align: right;}.text-small {    font-size: small;}.text-x-small {    font-size: x-small;}.banner {    display: block;    width: 100%;    margin-left: auto;    margin-right: auto;}.footer {    text-align: right;    float: right;    max-width: 18em;}.cc {    border-width: 0}.center {    text-align: center;}</style><style media="all" type="text/css">/* Ewan Themes -- based 99.99% from Tomorrow Night Theme *//* http://jmblog.github.com/color-themes-for-google-code-highlightjs *//* Original theme - https://github.com/chriskempson/tomorrow-theme *//* http://jmblog.github.com/color-themes-for-google-code-highlightjs *//* Tomorrow Comment */.hljs-comment {  color: #969896;}/* Tomorrow Red */.hljs-variable,.hljs-attribute,.hljs-tag,.hljs-regexp,.ruby .hljs-constant,.xml .hljs-tag .hljs-title,.xml .hljs-pi,.xml .hljs-doctype,.html .hljs-doctype,.css .hljs-id,.css .hljs-class,.css .hljs-pseudo {  color: #cc6666;}/* Tomorrow Orange */.hljs-number,.hljs-preprocessor,.hljs-pragma,.hljs-built_in,.hljs-literal,.hljs-params,.hljs-constant {  color: #de935f;}/* Tomorrow Yellow */.ruby .hljs-class .hljs-title,.css .hljs-rule .hljs-attribute {  color: #f0c674;}/* Tomorrow Green */.hljs-string,.hljs-value,.hljs-inheritance,.hljs-header,.hljs-name,.ruby .hljs-symbol,.xml .hljs-cdata {  color: #b5bd68;}/* Tomorrow Aqua */.hljs-title,.css .hljs-hexcolor {  color: #8abeb7;}/* Tomorrow Blue */.hljs-function,.python .hljs-decorator,.python .hljs-title,.ruby .hljs-function .hljs-title,.ruby .hljs-title .hljs-keyword,.perl .hljs-sub,.javascript .hljs-title,.coffeescript .hljs-title {  color: #81a2be;}/* Tomorrow Purple */.hljs-keyword,.javascript .hljs-function {  color: #b294bb;}.hljs {  display: block;  overflow-x: auto;  background: #1d1f21;  color: #c5c8c6;  padding: 0.5em;  -webkit-text-size-adjust: none;}.coffeescript .javascript,.javascript .xml,.tex .hljs-formula,.xml .javascript,.xml .vbscript,.xml .css,.xml .hljs-cdata {  opacity: 0.5;}pre code {    font-size: 1.1em;    font-family: monospace;    line-height: 1.3em;    overflow: auto;}</style></head><body><div id="content"><h1>Skriptado en Komunlispo</h1><p><div class="center">Esperanto · <a href='/en/script-lisp/'>English</a></div> <div class="center">la 24-an de septembro 2018</div> <div class="center">Laste ĝisdatigita: la 21-an de februaro 2019</div></p><blockquote><p>La lumo kiu fajras duoble brila, fajras duone longa.<br> ―D-ro. Eldon TYRELL, Blade Runner (1982) </p></blockquote><p><img src="/bil/lisposimbolo.png" style="display: block; width: 100%; margin-left: auto; margin-right: auto;" alt="common-lisp.net emblemo" title="common-lisp.net emblemo"/></p><p>Plenaj tutaj sistemoj kaj bibliotekoj estas ĉiam komfortaj areoj por komunlispaj uzantoj. Bedaŭrinde, de longe, ne ekzistis definitiva solvo en komunlispon uzi kiel skriptada lingvo. Skriptada lingvo, en ĉi tiu kunteksto, signifas pri iu, kiu similas anime al komandliniaj ŝeloj—tio estas, iu kiu estas uzita por sistemkomandojn mastrumi kaj regi sur la apa nivelo. La signifo ankaŭ etendas al la aŭtomacioj de la plenumado de taskoj kiuj aliamaniere faritaj unu post alia. En ĉi tiu artikolo, mallongan enkondukon pri kiel komunlispon uzi en la skriptada areo mi priparolos.</p><h2><a name="et"></a>Enhavotabelo</h2><ul><li><a href='#superrigardo'>Superrigardo</a></li><li><a href='#antauxkondicxoj'>Antaŭkondiĉoj</a></li><li><a href='#bazaj'>Bazaj</a><ul><li><a href='#dosierindikoj'>Dosierindikoj</a></li><li><a href='#difinoj'>Difinoj</a></li><li><a href='#kunmetado'>Kunmetado</a></li></ul></li><li><a href='#pli'>Pli</a></li><li><a href='#avertoj'>Avertoj</a></li><li><a href='#finrimarkoj'>Finrimarkoj</a></li></ul><h2><a name="superrigardo"></a>Superrigardo</h2><p>Unu el la plej oftaj demandoj kiun mi ricevas kiam mi diras, ke skriptadon mi volas fari per komunlispo, estas, kiel tion mi eĉ volas fari kaj tio maleblas. La respondo simplas: pli da potenco kaj esprimpleneco mi volas havi. Maturan kaj nelimigitan lingvon mi volas havi. Lingvon kiu miajn ideojn povas esprimi en la malplej kiomo de froto mi volas havi.</p><p>Skripto estas nur tiel potenca kiel la lingvo kaj iloj povus permesi. Baŝo kaj siaj amikoj, ekzemple, estas bonegaj por ideojn esprimi, tiel longe kiel komandojn oni tajpas sur la komandlinio mem. La konduton ene skripto ĝi imitas. Funkciojn oni povas difini por procedurojn fari, sed ili nur estas tiel. Funkcioj en Baŝo ne estas ie proksimaj al la funkcioj en lingvoj kiel komunlispo. Kiel interaga uzantŝelo, ĝi funkcias bone; escepte tio, ne.</p><p>Ekzistas aliaj skriptadaj solvoj en aliaj lingvoj. Haskelo, Pitono, Skimo, kaj Rubeno, kelke da ili nomante, ĝin havas. Tamen estas bona eblo de komunlispo, kiu estas malfacila por realigi aŭ ne ekzistas en aliaj aliroj: pro la skriptoj mem estas validaj komunlispaj programoj, la programojn mi povas ŝarĝi en la REPL kaj afablajn aferojn mi povas fari kun tio. Neniu venas proksima al la flekso, kiun komunlispo provizas interagante kun realtempaj kurantaj programoj.</p><p>En ĉi tiu mallonga gvidilo, alian belan aĵon pri komunlispa skriptado mi ankaŭ tuŝetas: multvokaj duumdosieroj. Multvoka duumdosiero estas sola plenumebla dosiero kiu povas esti elreferencita per pluraj nomoj. Ĉiu nomo kongruas al specifa proceduro ene tiu sola duumdosiero. La beleco de ĉi tiu aliro, estas, ke anstataŭ multajn malsamajn programojn mastrumi, nur unu dosieron oni mastrumas, kaj la ĝustan proceduron ĝi disdonos kiu uzanto deziras. Ĉi tio similas al kiun Busybox faras. Komunlispe ĉi tio estas traktita de <a href='https://github.com/fare/cl-launch'>cl-launch</a>.</p><h2><a name="antkauxkondicxoj"></a>Antaŭkondiĉoj</h2><p>Skriptado en komunlispo funkcias super la lingvo, tio estas, en la formo de bibliotekoj kiuj la abstraktadojn disponigas por interagi kun la sistemo kaj la medio. <a href='https://gitlab.common-lisp.net/asdf/asdf/tree/master/uiop'>Utilities for Implementation- and OS- Portability (UIOP)</a> estas aro de abstraktadoj kiuj nin permesas por porteblan lispan kodon skribi. UIOP estas enkonstruita en ASDF3—kiu estas parto de la plejparto de komunlispaj realigoj—do ne ekzistas bezono por ĝin permane instali. Onin <a href='https://github.com/fare/inferior-shell'>inferior-shell</a> helpas por la procezojn mastrumi. Onin <a href='https://github.com/fare/cl-scripting'>cl-scripting</a> helpas por pli da rego.</p><p>La programo <code>cl-launch</code> devas esti instalita sur la sistemo. Ĝi estos respondeca por la kreado de la multvoka duumdosiero mem. Por je <code>cl-launch</code> instali:</p><p>Per APT:</p><pre><code>$ sudo apt-get install -y cl-launch</code></pre><p>Per Nixpkgs:</p><pre><code>$ nix-env -i cl-launch</code></pre><h2><a name="bazaj"></a>Bazaj</h2><h3><a name="dosierindikoj"></a>Dosierindikoj</h3><p>Komencante, novan projektan dosierujon ni kreu. La projekton ni kunmetu en <code>$HOME/common-lisp</code>.</p><pre><code>$ mkdir -p &#126;/common-lisp/my-scripts</code></pre><p>Ĉi tiu dosiero estas unu el la laŭnormaj dosierindikoj kiun ASDF rampigos por <code>.asd</code>-dosieroj. Estas inde por noti, ke ne gravas se <code>$HOME/common-lisp</code> estas kutima dosierujo aŭ simbolligilo al iu.</p><h3><a name="difinoj"></a>Difinoj</h3><p>Tiam la dosieron <code>my-scripts.asd</code> ni kreu en tiu dosierujo. Por komenci, la jenan ĝi havos:</p><pre><code class="lisp">#-asdf3.1 &#40;error &quot;ASDF 3.1 or bust!&quot;&#41;

&#40;defsystem &quot;my-scripts&quot;
  :version &quot;0.0.1&quot;
  :description &quot;CL scripts&quot;
  :license &quot;MIT&quot;
  :author &quot;Muno VAKELO&quot;
  :class :package-inferred-system
  :depends-on &#40;&#40;:version &quot;cl-scripting&quot; &quot;0.1&quot;&#41;
               &#40;:version &quot;inferior-shell&quot; &quot;2.0.3.3&quot;&#41;
               &#40;:version &quot;fare-utils&quot; &quot;1.0.0.5&quot;&#41;
               &quot;my-scripts/main&quot;&#41;&#41;
</code></pre><p>Kelke da funkcioj kiunj ni bezonas, estas en ASDF 3.1, pro tio la tutan sistemon ni devas kondiĉigi. La dependecojn sur <code>cl-scripting</code> ni deklaras, kiu kelkajn helpilojn provizas; kaj sur <code>inferior-shell</code>, kiu la aĵojn kiujn ni bezonas por la ŝelajn procezojn mastrumi provizas.</p><p>Sekve, la dosieron <code>main.lisp</code> ni kreu en la sama dosierujo. La jenan ĝi havos:</p><pre><code class="lisp">&#40;uiop:define-package :my-scripts/main
    &#40;:use #:cl
          #:uiop
          #:cl-scripting
          #:inferior-shell
          #:fare-utils
          #:cl-launch/dispatch&#41;
  &#40;:export #:getuid
           #:symlink
           #:help
           #:main&#41;&#41;

&#40;in-package #:my-scripts/main&#41;

&#40;exporting-definitions
  &#40;defun getuid &#40;&#41;
    #+sbcl &#40;sb-posix:getuid&#41;
    #+cmu &#40;unix:unix-getuid&#41;
    #+clisp &#40;posix:uid&#41;
    #+ecl &#40;ext:getuid&#41;
    #+ccl &#40;ccl::getuid&#41;
    #+allegro &#40;excl.osi:getuid&#41;
    #-&#40;or sbcl cmu clisp ecl ccl allegro&#41; &#40;error &quot;no getuid&quot;&#41;&#41;

 &#40;defun symlink &#40;src&#41;
   &#40;let &#40;&#40;binarch &#40;resolve-absolute-location `&#40;,&#40;subpathname &#40;user-homedir-pathname&#41; &quot;bin/&quot;&#41;&#41; :ensure-directory t&#41;&#41;&#41;
     &#40;with-current-directory &#40;binarch&#41;
       &#40;dolist &#40;i &#40;cl-launch/dispatch:all-entry-names&#41;&#41;
         &#40;run `&#40;ln -sf ,src ,i&#41;&#41;&#41;&#41;&#41;
   &#40;success&#41;&#41;

 &#40;defun help &#40;&#41;
   &#40;format! t &quot;&#126;A commands: &#126;{&#126;A&#126;&#94; &#126;}&#126;%&quot; &#40;get-name&#41; &#40;all-entry-names&#41;&#41;
   &#40;success&#41;&#41;

 &#40;defun main &#40;&amp;rest args&#41;
   &#40;format t &quot;main&#126;%&quot;&#41;&#41;&#41;

&#40;register-commands :my-scripts/main&#41;
</code></pre><p>Ni komencu per je <code>UIOP:DEFINE-PACKAGE</code> uzi. Male al <code>DEFPACKAGE</code>, la necesan medion kiu estas amika al UIOP ĉi tio kreas. En la klaŭzo <code>:USE</code>, la helpilojn de aliaj bibliotekoj ni uzos. En la korpo de ĉi tiu dosiero, je <code>EXPORTING-DEFINITIONS</code> oni povas vidi. La limojn de tiuj, kiuj iĝos duumdosieroj aŭ ne, ĉi tiu markilo efektive markas. Ĝi estos uzita de <code>REGISTER-COMMANDS</code> poste.</p><p>Ĉi tie, kelkajn funkciojn ni difinas: <code>SYMLINK</code> respondecas pri la kreado de la simbolligiloj por la multvoka duumdosiero; kelke da bazuza informo <code>HELP</code> montras; kaj <code>MAIN</code> estas la enirejo de nia skripto. La duumdosiero troveblos en <code>$HOME/bin/</code>. Por la procedon pri la kunmetado de la skripto kaj simbolligiloj plifaciligi, la kunmetadajn instrukciojn ni metos en Makefile. La dosieron <code>Makefile</code> en la aktuala dosierujo kreu, tiam la jenan metu:</p><pre><code class="Makefile">NAME=my-scripts
BINARY=$&#40;HOME&#41;/bin/$&#40;NAME&#41;
SCRIPT=$&#40;PWD&#41;/$&#40;NAME&#41;
CL=cl-launch

.PHONY: all $&#40;NAME&#41; clean

all: $&#40;NAME&#41;

$&#40;NAME&#41;:
    @$&#40;CL&#41; --output $&#40;NAME&#41; --dump ! --lisp sbcl --quicklisp --system $&#40;NAME&#41; --dispatch-system $&#40;NAME&#41;/main

install: $&#40;NAME&#41;
    @ln -sf $&#40;SCRIPT&#41; $&#40;BINARY&#41;
    @$&#40;SCRIPT&#41; symlink $&#40;NAME&#41;

clean:
    @rm -f $&#40;NAME&#41;
</code></pre><p>En la celo <code>$&#40;NAME&#41;</code>, je <code>cl-launch</code> ni voku kun la opcioj por la skripton kunmeti. En la celo <code>install</code>, la skripton ni alvoku kun la opcioj <code>symlink $&#40;NAME&#41;</code>, por la simbolligilojn de la multvoka duumdosiero krei. Pro nur tri funkciojn ni difinis ene la korpo de <code>EXPORTING-DEFINITIONS</code>, nur tri simbolligilojn al <code>my-scripts</code> ĝi kreos. La eligan dosieron la opcio <code>‑‑output $&#40;NAME&#41;</code> precizigas. La <code>‑‑dump !</code> signifas, ke bildon ĝi kreos, por pli rapidan startigon ŝalti. La opcio <code>‑‑lisp sbcl</code> signifas, ke je SBCL ni volas uzi, por ĉi tiu skripto. La opcio <code>‑‑quicklisp</code> signifas, ke je <a href='https://www.quicklisp.org'>Quicklisp</a> ni ŝarĝas kun la bildo. La sistemon, kiun ni kreas la opcio <code>‑‑system $&#40;NAME&#41;</code> ŝarĝas. La enirejo de nia programo la opcio <code>‑‑dispatch-system $&#40;NAME&#41;/main</code> precizigas.</p><h3><a name="kunmetado"></a>Kunmetado</h3><p>Ni nun pretas por la skripton kaj la simbolligilojn krei. Por tion fari, plenumu:</p><pre><code>$ make install</code></pre><p>La multvokan duumdosieron—<code>./my-scripts</code>—ĉi tiu komando kunmetas kun la respondaj simbolligiloj. La dosieruja arbo de <code>&#126;/bin</code> devas aspekti jene:</p><pre><code class="bash">$ tree &#126;/bin
/home/vakelo/bin
├── getuid -&gt; my-scripts
├── help -&gt; my-scripts
├── my-scripts -&gt; /home/vakelo/common-lisp/my-scripts/my-scripts
└── symlink -&gt; my-scripts

0 directories, 5 files
</code></pre><p>Por kontroli, ke ĝi efektive funkcias, plenumu:</p><pre><code>$ getuid</code></pre><p>Sa la uzantnumeron ĝi montras, tiam ni povas daŭrigi.</p><h2><a name="pli"></a>Pli</h2><p>Ni supozu, ke la baterian staton de la tekkomputilo oni volas scii de la komandlinio. Tion ni povas difini per kelkaj funkcioj. Je <code>my-scripts.asd</code> ni modifu per la aldonajn deklarojn enhavi:</p><pre><code class="lisp">#-asdf3.1 &#40;error &quot;ASDF 3.1 or bust!&quot;&#41;

&#40;defsystem &quot;my-scripts&quot;
  :version &quot;0.0.1&quot;
  :description &quot;CL scripts&quot;
  :license &quot;MIT&quot;
  :author &quot;Muno VAKELO&quot;
  :class :package-inferred-system
  :depends-on &#40;&#40;:version &quot;cl-scripting&quot; &quot;0.1&quot;&#41;
               &#40;:version &quot;inferior-shell&quot; &quot;2.0.3.3&quot;&#41;
               &#40;:version &quot;fare-utils&quot; &quot;1.0.0.5&quot;&#41;
               &quot;my-scripts/main&quot;
               &quot;my-scripts/general&quot;&#41;&#41;
</code></pre><p>Tiam, la dosieron <code>general.lisp</code> ni plenigu per la jena enhavo:</p><pre><code class="lisp">&#40;uiop:define-package #:scripts/general
    &#40;:use #:cl
          #:fare-utils
          #:uiop
          #:cl-scripting
          #:inferior-shell
          #:cl-launch/dispatch
          #:optima
          #:optima.ppcre
          #:local-time&#41;
  &#40;:export #:battery
           #:screenshot&#41;&#41;

&#40;in-package #:scripts/general&#41;

&#40;defvar &#42;screenshots-dir&#42;
  &#40;subpathname &#40;user-homedir-pathname&#41; &quot;Desktop/&quot;&#41;&#41;

&#40;defun battery-status &#40;&#41;
  &#40;let &#40;&#40;base-dir &quot;/sys/class/power&#95;supply/&#42;&quot;&#41;
        &#40;exclude-string &quot;/AC/&quot;&#41;&#41;
    &#40;with-output &#40;s nil&#41;
      &#40;loop :for dir :in &#40;remove-if #'&#40;lambda &#40;path&#41;
                                        &#40;search exclude-string &#40;native-namestring path&#41;&#41;&#41;
                                    &#40;directory&#42; base-dir&#41;&#41;
            :for battery = &#40;first &#40;last &#40;pathname-directory dir&#41;&#41;&#41;
            :for capacity = &#40;read-file-line &#40;subpathname dir &quot;capacity&quot;&#41;&#41;
            :for status = &#40;read-file-line &#40;subpathname dir &quot;status&quot;&#41;&#41;
            :do &#40;format s &quot;&#126;A: &#126;A% &#40;&#126;A&#41;&#126;%&quot; battery capacity status&#41;&#41;&#41;&#41;&#41;

&#40;exporting-definitions
 &#40;defun battery &#40;&#41;
   &#40;format t &quot;&#126;A&quot; &#40;battery-status&#41;&#41;
   &#40;values&#41;&#41;

 &#40;defun screenshot &#40;mode&#41;
   &#40;let&#42; &#40;&#40;dir &#42;screenshots-dir&#42;&#41;
          &#40;file &#40;format nil &quot;&#126;A.png&quot; &#40;format-timestring nil &#40;now&#41;&#41;&#41;&#41;
          &#40;dest &#40;format nil &quot;mv $f &#126;A&quot; dir&#41;&#41;
          &#40;image &#40;format nil &quot;&#126;A/&#126;A&quot; dir file&#41;&#41;&#41;
     &#40;flet &#40;&#40;scrot &#40;file dest &amp;rest args&#41;
              &#40;run/i `&#40;scrot ,@args ,file -e ,dest&#41;&#41;&#41;&#41;
       &#40;match mode
              &#40;&#40;ppcre &quot;&#40;full|f&#41;&quot;&#41; &#40;scrot file dest&#41;&#41;
              &#40;&#40;ppcre &quot;&#40;region|r&#41;&quot;&#41; &#40;scrot file dest '-s&#41;&#41;
              &#40;&#95; &#40;err &#40;format nil &quot;invalid mode &#126;A&#126;%&quot; mode&#41;&#41;&#41;&#41;
       &#40;run `&#40;&quot;xclip&quot; &quot;-selection&quot; &quot;clipboard&quot; &quot;-t&quot; &quot;image/png&quot; ,image&#41;&#41;
       &#40;success&#41;&#41;&#41;&#41;&#41;

&#40;register-commands :scripts/general&#41;
</code></pre><p>En la difino de <code>BATTERY</code>, la liveraĵon de <code>&#40;BATTERY-STATUS&#41;</code> ĝi eligas en home amika maniero, tio estas, sen la duoblaj citiloj. Tiam nenian valoron la funkcio <code>BATTERY</code> do liveras. Ĉi tion ni devas fari tial, ke nur la eligon al la alvoko de <code>BATTERY-STATUS</code> ni bezonas.</p><p>Aliflanke, enrankopion per <em>scrot</em> la funkcio <code>SCREENSHOT</code> tenas tiam la absolutdosierindikon de la bildo ĝi disponebligas el la tondeja zono per <em>xclip</em>. La bibliotekojn <code>local-time</code> por la data signovico kaj biblioteko; kaj <code>optima</code>, por la ripetiĝa kongruado. Por la komandon <code>screenshot</code> ebligi, la duumdosierojn dependecojn instalu. La jenajn komandojn plenumu sur APT- kaj Nix-sistemoj, respektive:</p><pre><code>$ sudo apt-get install -y scrot xclip</code></pre><pre><code>$ nix-env -i scrot xclip</code></pre><p>Uzantapojn lanĉi kaj mastrumi facilas. Ni komencu per dependecon aldoni en <code>my-scripts.asd</code>:</p><pre><code class="lisp">#-asdf3.1 &#40;error &quot;ASDF 3.1 or bust!&quot;&#41;

&#40;defsystem &quot;my-scripts&quot;
  :version &quot;0.0.1&quot;
  :description &quot;CL scripts&quot;
  :license &quot;MIT&quot;
  :author &quot;Lolu VAKELO&quot;
  :class :package-inferred-system
  :depends-on &#40;&#40;:version &quot;cl-scripting&quot; &quot;0.1&quot;&#41;
               &#40;:version &quot;inferior-shell&quot; &quot;2.0.3.3&quot;&#41;
               &#40;:version &quot;fare-utils&quot; &quot;1.0.0.5&quot;&#41;
               &quot;my-scripts/main&quot;
               &quot;my-scripts/general&quot;
               &quot;my-scripts/apps&quot;&#41;&#41;
</code></pre><p>Tiam je <code>apps.lisp</code> ni plenigu:</p><pre><code class="lisp">&#40;uiop:define-package #:scripts/apps
    &#40;:use #:cl
          #:fare-utils
          #:uiop
          #:inferior-shell
          #:cl-scripting
          #:cl-launch/dispatch&#41;
  &#40;:export #:chrome
           #:kill-chrome
           #:stop-chrome
           #:continue-chrome&#41;&#41;

&#40;in-package #:scripts/apps&#41;

&#40;exporting-definitions
 &#40;defun chrome &#40;&amp;rest args&#41;
   &#40;run/i `&#40;google-chrome-beta ,@args&#41;&#41;&#41;

 &#40;defun kill-chrome &#40;&amp;rest args&#41;
   &#40;run `&#40;killall ,@args chromium-browser chromium google-chrome chrome&#41;
        :output :interactive :input :interactive :error-output nil :on-error nil&#41;
   &#40;success&#41;&#41;

 &#40;defun stop-chrome &#40;&#41;
   &#40;kill-chrome &quot;-STOP&quot;&#41;&#41;

 &#40;defun continue-chrome &#40;&#41;
   &#40;kill-chrome &quot;-CONT&quot;&#41;&#41;&#41;

&#40;register-commands :scripts/apps&#41;
</code></pre><p>Tiam je <em>my-scripts</em> ni rekunmetu:</p><pre><code class="bash">$ make install
my-scripts available commands: battery chrome continue-chrome getuid help kill-chrome main screenshot stop-chrome symlink
</code></pre><p>Hura!</p><h2><a name="avertoj"></a>Avertoj</h2><p>Gravan aferon por teni en la kalkulo, estas, en la difinoj, komunlispajn ŝlosilvortojn oni ne povas uzi kiel la nomo de komando. Do ene <code>EXPORTING-DEFINITIONS</code> la jenan oni ne povas havi:</p><pre><code class="lisp">&#40;exporting-definitions
  &#40;defun t &#40;&amp;rest args&#41;
    &#40;run/i `&#40;urxvt ,@args&#41;`&#41;&#41;&#41;
</code></pre><p>Se tion oni faras kaj la dosieron oni provas kompili, la komunlispa realigo plendos pri nomo kiu estas jam uzata.</p><h2><a name="finrimarkoj"></a>Finrimarkoj</h2><p>Onidire ke komunlispo jam velkiĝis al obskuro; ke ĝin oni ne plu uzas; ke ĝi ne plu utilas. Ne, tio ne pravas. Nur ĉar iu ne plu estas diskutita en plimulta novaĵo, ne signifas, ke ĝi mortas aŭ ĝi ne plu plaĉas al homo. Komunlispo estas normhava lingvo, kaj garantion programo kiu konformiĝas al la normo havas—ĝis tia grado ke—ĝi ankoraŭ povas kuri en la estontecon. Por lingvan normon krei estas monumenta tasko—ĝi postulas, ke malsamaj, eble konfliktaj anaroj devas akordi al unu la alia. Ekzistas multaj diversaj realigoj de komunlispo, kaj la celojn ĉiu realigo strebas atingi, kiuj ne necesas kongruaj al la aliaj realigoj. Tio bonas tial, ke spacon ĝi kreas por realigistoj kaj desegnistoj, pri kiel labori sur la bazaj specifoj. Tiel longe kiel ili akordas al la normo, aferoj verdas.</p><p><a href='https://github.com/ebzzry/baf'>baf</a>, Nixpkgs- kaj NixOS-helpilo, estas funkcia ekzemplo de komunlispa skriptado. <a href='https://github.com/zhaqenl/pelo/'>pelo</a>, ping-kovrilo, estas alia ekzemplo, kiu ĉi tiun facilon uzas. Kelkajn personajn helpilajn <a href='https://github.com/ebzzry/scripts/'>skriptojn</a> kiujn mi kroĉis al mia <a href='https://github.com/ebzzry/dotfiles/tree/master/stumpwm'>StumpWM-agordo</a> mi skribis. La kodo kiu estis uzita por ĉi tiu artikolo troveblas <a href='https://github.com/ebzzry/my-scripts'>ĉi tie</a>.</p><p>La priresponda homo por komunlispon igi ebla kaj akceptebla estas <a href='http://fare.tunes.org'>François-René RIDEAU</a>. Estis <a href='http://fare.livejournal.com/184127.html'>ĉi tiu blogo</a> kiu min inspiris por la vivpovecon de komunlispo kiel skriptada lingvo vidi. Oferdonjn oni povas doni al li per <a href='https://paypal.me/fahree'>PayPal</a> aŭ <a href='bitcoin:1fareF6wCNYYiLPGmyQjrd3AQdHBb1CJ6'>Bitcoin</a>.</p><p>La rubandbildo kiu uziĝas supre estas de <a href='https://common-lisp.net/'>common-lisp.net</a>.</p><hr/><div class="footer"><p><div class="text-small"> <a href='/eo/'>Hejmo</a> · <a href='/eo/pri/'>Pri</a> · <a href='/eo/citajxoj/'>Citaĵoj</a> · <a href='/eo/pripensoj/'>Pripensoj</a> · <a href='https://github.com/ebzzry/ebzzry.github.io'>Fonto</a> </div> <div class="text-x-small"> Kreite per <a href='https://github.com/ebzzry/emem'>emem</a> </div></p><p><div class="text-x-small"> <a rel="license" href="https://creativecommons.org/publicdomain/zero/1.0/deed.eo"><img alt="CC0 1.0 Universala (CC0 1.0) Publikaĵiga Dediĉo" class="cc" src="/bil/cc0-88x31.png" /></a><br> Ĉi tiu verko estas <a rel="license" href="https://creativecommons.org/publicdomain/zero/1.0/deed.eo">publika havaĵo.</a><br> </div></p><p></div></p></div><script src="/static/js/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create', 'UA-93746003-1', 'auto');ga('send', 'pageview');</script></body></html>