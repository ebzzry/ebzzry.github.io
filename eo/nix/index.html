<!DOCTYPE html>
<html lang="eo"><head><title>Milda Enkonduko al la Nix-Familio</title><meta charset="utf-8" /><meta content="width=device-width,initial-scale=1.0,user-scalable=yes" name="viewport" /><meta content="noodp,noydir" name="robots" /><meta content="Milda Enkonduko al la Nix-Familio" name="description" /><meta content="nix, nixos, nixpkgs, nix-o, nixos-o, nixpkgs-o, enkonduko, gvidilo, linukso, makinto��o" name="keywords" /><meta content="Milda Enkonduko al la Nix-Familio" property="og:title" /><meta content="article" property="og:type" /><meta content="https://ebzzry.io/eo/nix/" property="og:url" /><meta content="https://ebzzry.io/static/ico/android-chrome-512x512.png" property="og:image" /><link href="/static/ico/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180" /><link href="/static/ico/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" /><link href="/static/ico/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" /><link href="/static/ico/manifest.json" rel="manifest" /><link color="#5bbad5" href="/static/ico/safari-pinned-tab.svg" rel="mask-icon" /><meta content="#ffffff" name="theme-color" /><style media="all" type="text/css">html {    color: #333;    font-size: 1em;    font-family: Georgia, Cambria, Palatino, "Palatino Linotype", "Times New Roman", Times, serif;    line-height: 1.45;    text-align: left:    width: 100%;    max-width: 40em;    margin: 0 auto 0 auto;    padding: 0;}body {    border-top: hidden;    border-bottom: hidden;    padding: 0 1.5em 1em 1.5em;    margin: 0;}#content {    -webkit-column-count: 1;    -moz-column-count: 1;    column-count: 1;}code {    font-size: 0.9em;    font-family: "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Lucida Console", "Courier New", Courier, monospace;    color: black;    display: inline-block;    font-weight: bold;}pre code {    font-size: 1em;    font-family: monospace;    line-height: 1.3em;    overflow: auto;    font-weight: normal;}kbd {    font-size: 1.1em;    padding: 0.1em 0.6em;    border: 1px solid #ccc;    font-family: monospace;    background-color: #f7f7f7;    color: #333;    -moz-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    -webkit-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    -moz-border-radius: 3px;    -webkit-border-radius: 3px;    border-radius: 3px;    display: inline-block;    margin: 0 0.1em;    text-shadow: 0 1px 0 #fff;    white-space: nowrap;}h1, h2, h3, h4, h5, h6 {    font-family: Calibri, "Gill Sans", "Gill Sans MT", "Myriad Pro", Myriad, "DejaVu Sans", Tahoma, Geneva, Helvetica, Arial, sans-serif;    margin-bottom: 0;}h1 {    font-size: 2.5em;    text-align: center;    border-bottom: 6px solid black;}h2 {    font-size: 2.0em;    text-align: left;    border-bottom: 2px solid black;}h3 {    font-size: 1.6em;    text-align: left;    border-bottom: 1px solid lightgrey;}h4 {    font-size: 1.5em;    text-align: left;}h5 {    font-size: 1.3em;    text-align: left;}ul, ol {    padding-left: 2em;}ul li {    list-style-type: square;}ul li li {    list-style-type: disc;}ul li li li {    list-style-type: circle;}ol li {    list-style-type: decimal;}p, para, b, strong, i, em, emph {    font-size: 1em;}blockquote {    font-size: 1.2em;    font-style: italic;    margin-left: 2em;}b, strong {    font-weight: bold;}i, em, emph {    font-style: italic;}table {    margin: 0.5em;    border-spacing: 0;    border-collapse: collapse;}th, td {    border: 1px solid lightgray;    padding-top: 0;    padding-bottom: 0;    padding-left: 0.45em;    padding-right: 0.45em;}.text-right {    text-align: right;}.text-small {    font-size: small;}.text-x-small {    font-size: x-small;}.banner {    display: block;    width: 100%;    margin-left: auto;    margin-right: auto;}.footer {    text-align: right;    float: right;    max-width: 18em;}.cc {    border-width: 0}.center {    text-align: center;}</style><style media="all" type="text/css">/* Ewan Themes -- based 99.99% from Tomorrow Night Theme *//* http://jmblog.github.com/color-themes-for-google-code-highlightjs *//* Original theme - https://github.com/chriskempson/tomorrow-theme *//* http://jmblog.github.com/color-themes-for-google-code-highlightjs *//* Tomorrow Comment */.hljs-comment {  color: #969896;}/* Tomorrow Red */.hljs-variable,.hljs-attribute,.hljs-tag,.hljs-regexp,.ruby .hljs-constant,.xml .hljs-tag .hljs-title,.xml .hljs-pi,.xml .hljs-doctype,.html .hljs-doctype,.css .hljs-id,.css .hljs-class,.css .hljs-pseudo {  color: #cc6666;}/* Tomorrow Orange */.hljs-number,.hljs-preprocessor,.hljs-pragma,.hljs-built_in,.hljs-literal,.hljs-params,.hljs-constant {  color: #de935f;}/* Tomorrow Yellow */.ruby .hljs-class .hljs-title,.css .hljs-rule .hljs-attribute {  color: #f0c674;}/* Tomorrow Green */.hljs-string,.hljs-value,.hljs-inheritance,.hljs-header,.hljs-name,.ruby .hljs-symbol,.xml .hljs-cdata {  color: #b5bd68;}/* Tomorrow Aqua */.hljs-title,.css .hljs-hexcolor {  color: #8abeb7;}/* Tomorrow Blue */.hljs-function,.python .hljs-decorator,.python .hljs-title,.ruby .hljs-function .hljs-title,.ruby .hljs-title .hljs-keyword,.perl .hljs-sub,.javascript .hljs-title,.coffeescript .hljs-title {  color: #81a2be;}/* Tomorrow Purple */.hljs-keyword,.javascript .hljs-function {  color: #b294bb;}.hljs {  display: block;  overflow-x: auto;  background: #1d1f21;  color: #c5c8c6;  padding: 0.5em;  -webkit-text-size-adjust: none;}.coffeescript .javascript,.javascript .xml,.tex .hljs-formula,.xml .javascript,.xml .vbscript,.xml .css,.xml .hljs-cdata {  opacity: 0.5;}pre code {    font-size: 1.1em;    font-family: monospace;    line-height: 1.3em;    overflow: auto;}</style></head><body><div id="content"><h1>Milda Enkonduko al la Nix-Familio</h1><p><div class="center"><a href='#'>Esperante</a> · <a href='/en/nix'>English</a></div> <div class="center">la 5-an de aŭgusto 2018</div> <div class="center">Laste ĝisdatigita: la 17-an de septembro 2018</div></p><blockquote><p>Ne maltrankviliĝu pri tio, kion la aliaj faros. La plej bona maniero por la estontecon antaŭdiri estas per tion eltrovi.<br> ―Alan KAY </p></blockquote><p>Venas rare ideoj kiuj la manieron por komputado ŝanĝas. Multe da teĥnologio kiujn ni uzas nune nur estas ripetoj de la malnovaj—niveloj sur niveloj de kosmetikoj kiuj la malnovajn konceptojn ĉirkaŭkovras. Tutaj produktaj sistemoj estas bazitaj sur ĉi tiu manko de kreemo kaj lerteco. Malnovaj problemoj ne solvitas. Pentrante per novaj kolortonoj, la problemojn ĉi tiuj tielnomataj elpensemaj solvoj nure ĉirkaŭigas anstataŭe, pretendante ke almenaŭ, ĝin ili plikolorplenigis. Progreson ĉi tiu mensostato difektas en nekalkuleblaj manieroj. La falsan impreson, ke la solvoj fakte estas faritaj ĉi tio donas. Falsan senson de plibonigoj ĉi tio kreas.</p><p>Antaŭ multaj jaroj siajn semajn <a href='https://nixos.org/~eelco/pubs/'>paperojn</a> <a href='https://nixos.org/~eelco/'>Eelco Dolstra</a> skribis, kiu la radikalajn manierojn por programaron disponigi priskribis. La kernojn de <a href='https://nixos.org/nix/'>Nix</a>, pure funkcia paka mastrumila lingvo kiu la malsanon solvis kiu la komputikon plagis delonge plagis—kompatinda paka mastrumado. En ĉi tiu artikolo mi parolos pri la Nix-familio, kaj kiel ilin uzi por la avantaĝo.</p><p>La dolarsigno ($) uzitos por la ŝelan inviton de normala uzanto indiki, dum la kradsigno (#) uzitos por la ŝelan inviton de la ĉefuzanto indiki. Estas fojoj kiam la <a href='https://en.wikipedia.org/wiki/User_identifier#Effective_user_ID'>EUID</a> de komando estos nulo (0) pro la uzado de <em>sudo</em>.</p><h2>Enhavotabelo</h2><ul><li><a href='#nixos'>NixOS</a><ul><li><a href='#nixosinstalo'>Instalo</a><ul><li><a href='#nixossxalti'>La maŝinon ŝalti</a></li><li><a href='#nixosreto'>La reton agordi</a></li><li><a href='#nixosdiskoj'>La diskojn pretigi</a></li><li><a href='#nixosinstali'>Instali al disko</a></li></ul></li><li><a href='#nixosagordajxo'>Agordaĵo</a></li></ul></li><li><a href='#nix'>Nix</a><ul><li><a href='#nixsignovicoj'>Signovicoj</a></li><li><a href='#nixnombroj'>Nombroj</a></li><li><a href='#nixbuleaj'>Buleaj</a></li><li><a href='#nixlistoj'>Listoj</a></li><li><a href='#nixaroj'>Aroj</a></li><li><a href='#nixdosierindikoj'>Dosierindikoj</a></li><li><a href='#nixfunkcioj'>Funkcioj</a></li><li><a href='#nixlet'>Let</a></li><li><a href='#nixwith'>With</a></li><li><a href='#nixkondicxesprimoj'>Kondiĉesprimoj</a></li><li><a href='#nixenportoj'>Enportoj</a></li></ul></li><li><a href='#nixpkgs'>Nixpkgs</a><ul><li><a href='#nixpkgsinstalo'>Instalo</a></li><li><a href='#nixpkguzado'>Uzado</a><ul><li><a href='#nixpkgsgit'>Gito</a></li><li><a href='#nixpkgskanaloj'>Kanaloj</a></li><li><a href='#nixpkgsaliaj'>Aliaj komandoj</a></li></ul></li><li><a href='#nixpkgsagordajxo'>Agordaĵo</a></li><li><a href='#nixpkgskontribuado'>Kontribuado</a><ul><li><a href='#nixpkgsgxistadigi'>Ekzistantan pakon ĝisdatigi</a></li><li><a href='#nixpkgssendi'>Novan pakon sendi</a></li></ul></li><li><a href='#nixpkgsnotoj'>Notoj</a></li></ul></li><li><a href='#medioj'>Medioj</a><ul><li><a href='#sistemmedio'>Sistemmedio</a></li><li><a href='#uzantmedio'>Uzantmedio</a></li><li><a href='#disvolvmedio'>Disvolvmedio</a></li></ul></li><li><a href='#finrimarkoj'>Finrimarkoj</a></li><li><a href='#bonifiko'>Bonifiko</a></li></ul><h2><a name="nixos"></a>NixOS</h2><p>Kiom da fojo difektan sistemon oni havadis pro programaron oni ĝistadigis kiun aliaj komponantoj dependis? Kiom da malfrunoktaj restoj oni pasis por apon oni bezonis funkciigi pro ĝin la nova pako kiun oni instalis rompigis? Kiom da fojo, pro ĉagrenego, oni rezignis en la riparado de la sistemo kaj simple decidis por la sistemon reinstali el nulo. Datumdosierojn restaŭri facilas; sistemagordon de la lasta funkcia stato restaŭri, bedaŭrinde, estas unudirekta bileto al infero.</p><p><a href='https://nixos.org'>NixOS</a> estas linuksa distributo kiu ĉi tiajn problemojn solvas per la determinismon de <a href='https://nixos.org/nix'>Nix</a> ekspluati kaj per unu deklara agorda dosiero uzi kiu ĉiom da agordaĵoj kaj alĝustigiloj tenas en unu loko—<code>/etc/nixos/configuration.nix</code>. Informon pri la dosiersistemo, uzantoj, servoj, retagordo, enigaparatoj, kernaj parametroj, kaj pli ĉi tiu dosiero enhavas. Signifas, ke je <code>configuration.nix</code> de iu oni povas preni kaj sian ekzaktan sistemagordon havu! En NixOS oni ne plu bezonas ludadi pri la tutsistemo por la agordo kiun oni deziras. Porokazajn solvojn oni ne plu uzas por deziratan agordan staton precizigi. Aldonan programaron oni ne plu bezonas instali por sistemagordon mastrumi.</p><p>NixOs ne konformiĝas al <a href='https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard'>FHS</a>, aldonan cerban damaĝon efektive malebligas. Spacon por multe da fleksebleco kaj eltrovemo donas. Je <code>/usr/</code> kaj <code>/opt/</code> ĝi ne havas. Tamen, je <code>/bin/</code> kaj <code>/usr/bin/</code> ĝi havas, kiu nur je <code>sh</code> kaj <code>env</code> havas respektive—ambaŭ fakte estas simbolligiloj al la realaj programoj kiu loĝas ie en <code>/nix/store/</code>. La supra loko por sistemprogramoj—la tiuj, kiuj estas instalitaj specife de la sistemestro—estas lokitaj en <code>/run/current-system/sw/bin/</code> kaj <code>/run/current-system/sw/sbin/</code>. Uzantinstalitaj programoj, aliflanke, troveblas en siaj respektivaj <code>&#126;/.nix-profile/bin/</code>-lokoj. Ĉi tiuj lokoj ne povas ŝanĝiĝi per kutimaj manieroj; dediĉitaj programoj devas esti uzataj por skribi al ĉi tiuj arboj.</p><h3><a name="nixosinstalo"></a>Instalo</h3><p>Simplas instalo de NixOS. Por “nudmetalaj” sistemoj, instalilon de <a href='https://nixos.org/nixos/download.html'>nixos.org/nixos/download.html</a> elŝutu. Virtualmaŝinaj diskbildoj ankaŭ haveblas de tiu paĝo. En mia lasta instalo, mi instalis per la jena agordo:</p><ul><li><a href='https://en.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface'>UEFI</a></li><li>USB-praŝarĝo</li><li>Vifia konekto</li><li><a href='https://en.wikipedia.org/wiki/GUID_Partition_Table'>GUID-subdiska tabelo (GPT)</a></li><li><a href='https://en.wikipedia.org/wiki/Linux_Unified_Key_Setup'>LUKS</a> super <a href='https://en.wikipedia.org/wiki/Logical_volume_management'>LVM</a></li></ul><h4><a name="nixossxalti"></a>La maŝinon ŝalti</h4><p>Praŝarĝu per la USB-poŝmemorilo en UEFI-reĝimo. Sur la ensaluta invito, ensalutu kiel <code>root</code>.</p><h4><a name="nixosreto"></a>La reton agordi</h4><p>Haveblajn retojn skanu</p><pre><code># nmcli d wifi list</code></pre><p>Tiam, konektu al la preferata enkursigilo</p><pre><code># nmcli d wifi con PLDT name hejmo password sekreto</code></pre><h4><a name="nixosdiskoj"></a>La diskojn pretigi</h4><p>La subdiskojn kreu</p><pre><code># gdisk /dev/sda
sda1: EF00 &#40;EFI system&#41;, 512 MiB
sda2: 8E00 &#40;Linux LVM&#41;, ceteraj</code></pre><p>Je <code>/dev/sda1</code> strukturu</p><pre><code># mkfs.vfat -F32 /dev/sda1</code></pre><p>La fizikan volumon kreu</p><pre><code># pvcreate /dev/sda2</code></pre><p>La voluman grupon kreu</p><pre><code># vgcreate vg /dev/sda2</code></pre><p>La logikajn volumojn kreu</p><pre><code># lvcreate -L 20G -n swap vg
# lvcreate -l 100%FREE -n root vg</code></pre><p>La radikon ĉifru</p><pre><code># cryptsetup luksFormat /dev/vg/root
# cryptsetup luksOpen /dev/vg/root root</code></pre><p>La radikon strukturu</p><pre><code># mkfs.ext4 -j -L root /dev/mapper/root</code></pre><p>La permutodosieron strukturu</p><pre><code># mkswap -L swap /dev/vg/swap</code></pre><p>La dosiersistemojn surmetu</p><pre><code># mount /dev/mapper/root /mnt
# mkdir /mnt/boot
# mount /dev/sda1 /mnt/boot</code></pre><p>La permutodosieron ŝaltu</p><pre><code># swapon /dev/vg/swap</code></pre><h4><a name="nixosinstali"></a>Instali al disko</h4><p>La bazagorddosieron kreu</p><pre><code># nixos-generate-config --root /mnt</code></pre><p>La agorddosieron redaktu</p><pre><code># nano /mnt/etc/nixos/configuration.nix</code></pre><p>Por la procedon plifaciligi, malpligrandigitan version de <a href='https://github.com/ebzzry/dotfiles/blob/master/nixos/configuration.nix'>mia agorddosiero</a> oni povas uzi, kaj sekve. La valorojn anstataŭigu laŭ oni preferas. Ĉiom da agordaj alĝustigiloj haveblas <a href='https://nixos.org/nixos/options.html'>ĉi tie</a>.</p><pre><code class="nix">{ config, lib, pkgs, ... }:

{
  imports = &#91;
      ./hardware-configuration.nix
  &#93;;

  boot = {
    loader = {
      systemd-boot.enable = true;
      efi.canTouchEfiVariables = true;
    };

    initrd.availableKernelModules = &#91;
      &quot;xhci&#95;pci&quot;
      &quot;ehci&#95;pci&quot;
      &quot;ahci&quot;
      &quot;usb&#95;storage&quot;
      &quot;sd&#95;mod&quot;
      &quot;rtsx&#95;pci&#95;sdmmc&quot;
    &#93;;

    initrd.luks.devices = &#91;
      {
        device = &quot;/dev/vg/root&quot;;
        name = &quot;root&quot;;
        preLVM = false;
      }
    &#93;;

    cleanTmpDir = true;
  };

  fileSystems = &#91;
    {
      device = &quot;/dev/disk/by-uuid/6106-6BF8&quot;;
      fsType = &quot;vfat&quot;;
      mountPoint = &quot;/boot&quot;;
    }

    {
      device = &quot;/dev/mapper/root&quot;;
      fsType = &quot;ext4&quot;;
      mountPoint = &quot;/&quot;;
    }
  &#93;;

  swapDevices = &#91;
    {
      device = &quot;/dev/vg/swap&quot;;
    }
  &#93;;

  networking = {
    hostName = &quot;mehfoo&quot;;
    hostId = &quot;7B1548AE&quot;;
    enableIPv6 = true;
    networkmanager.enable = true;
  };

  environment = {
    systemPackages = with pkgs; &#91; zsh &#93;;
  };

  time.timeZone = &quot;Asia/Manila&quot;;

  security.sudo = {
    enable = true;
    configFile = ''
      Defaults env&#95;reset
      root ALL = &#40;ALL:ALL&#41; ALL
      %wheel ALL = &#40;ALL&#41; SETENV: NOPASSWD: ALL
    '';
  };

  services = {
    xserver = {
      autorun = true;
      defaultDepth = 24;
      enable = true;
      displayManager.kdm.enable = true;
      desktopManager.kde5.enable = true;
      videoDrivers = &#91; &quot;intel&quot; &#93;;
    };
  };

  users = {
    extraUsers.ogag = {
      isNormalUser = true;
      uid = 1000;
      extraGroups = &#91; &quot;wheel&quot; &quot;networkmanager&quot; &quot;docker&quot; &#93;;
    };
    defaultUserShell = &quot;/run/current-system/sw/bin/zsh&quot;;
  };
}
</code></pre><p>Se la <code>nixos-generate-config</code> paŝon ĉi-supre oni preterpasis, la antaŭproduktan dosieron kreu mane:</p><pre><code># mkdir -p /mnt/etc/nixos</code></pre><p>La ĉi-supran dosieron oni povas konservi per:</p><pre><code># curl -sSLo /mnt/etc/nixos/configuration.nix https://goo.gl/ZTQcGs</code></pre><p>Pli longa versio haveblas per:</p><pre><code># curl -sSLo /mnt/etc/nixos/configuration.nix https://goo.gl/K4P7l5</code></pre><p>La UUID-identigilon de la disko anstataŭigu per la tiu, kiun oni havas. La komandon <code>blkid</code> uzu por la UUID-identigilojn akiru. Por la valoro de <code>networking.hostID</code> la jenan komandon uzu:</p><pre><code># cksum /etc/machine-id | while read c rest; do printf &quot;%x&quot; $c; done</code></pre><p>La jenan la ĉi-supra agordo precizigas, inter aliaj aferoj:</p><ul><li>Uzanton <code>ogag</code> kreas kun tuta sudo-aliro.</li><li>Je KDE5 uzas kiel la fenestrilo.</li><li>Sekurŝelon ŝaltas.</li><li>La LUKS-parametrojn precizigas.</li></ul><p>Je NixOS instalu al la disko:</p><pre><code># nixos-install</code></pre><p>Je <code>/etc/nixos/configuration.nix</code> ĉi tiu komando analizas, asekurante, ke ne estas eraroj. Ĉiom da necesaj pakoj por kongrui al la specifo ĉi tiu komando elŝutos.</p><p>Post kiam la instalo finiĝis, la sistemon repraŝarĝu.</p><pre><code># reboot</code></pre><hr/><div class="footer"><p><div class="text-small"> <a href='/eo'>Hejmo</a> · <a href='/eo/pri'>Pri</a> · <a href='/eo/citajxoj'>Citaĵoj</a> · <a href='/eo/pripensoj'>Pripensoj</a> · <a href='https://github.com/ebzzry/ebzzry.github.io'>Fonto</a> </div> <div class="text-x-small"> Kreitis per <a href='https://github.com/ebzzry/emem'>emem</a> </div></p><p><div class="text-x-small"> <a rel="license" href="https://creativecommons.org/publicdomain/zero/1.0/deed.eo"><img alt="CC0 1.0 Universala (CC0 1.0) Publikaĵiga Dediĉo" class="cc" src="/bil/cc0-88x31.png" /></a><br> Ĉi tiu verko estas <a rel="license" href="https://creativecommons.org/publicdomain/zero/1.0/deed.eo">publika havaĵo.</a><br> </div></p><p></div></p></div><script src="/static/js/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create', 'UA-93746003-1', 'auto');ga('send', 'pageview');</script></body></html>