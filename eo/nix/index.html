<!DOCTYPE html>
<html lang="eo"><head><title>Milda Enkonduko al la Nix-Familio</title><meta charset="utf-8" /><meta content="width=device-width,initial-scale=1.0,user-scalable=yes" name="viewport" /><meta content="noodp,noydir" name="robots" /><link rel='apple-touch-icon' sizes='180x180' href='/images/ico/apple-touch-icon.png'><link rel='icon' type='image/png' sizes='32x32' href='/images/ico/favicon-32x32.png'><link rel='icon' type='image/png' sizes='16x16' href='/images/ico/favicon-16x16.png'><link rel='manifest' href='/images/ico/site.webmanifest'><link rel='mask-icon' href='/images/ico/safari-pinned-tab.svg' color='#5bbad5'><link rel='shortcut icon' href='/images/ico/favicon.ico'> <meta name='msapplication-TileColor' content='#da532c'> <meta name='msapplication-config' content='/images/ico/browserconfig.xml'> <meta name='theme-color' content='#ffffff'><meta content="Milda Enkonduko al la Nix-Familio" name="description" /><meta content="nix, nixos, nixpkgs, enkonduko, gvidilo, linukso, makinto��o, makintosxo, unikso, nix-surmetoj, surmetoj" name="keywords" /><meta content="Milda Enkonduko al la Nix-Familio" property="og:title" /><meta content="article" property="og:type" /><meta content="https://ebzzry.io/eo/nix/" property="og:url" /><meta content="https://ebzzry.io/images/ico/android-chrome-512x512.png" property="og:image" /><style media="all" type="text/css">html {    color: #333;    font-size: 1em;    font-family: Georgia, Cambria, Palatino, "Palatino Linotype", "Times New Roman", Times, serif;    line-height: 1.45;    text-align: left:    width: 100%;    max-width: 40em;    margin: 0 auto 0 auto;    padding: 0;}body {    border-top: hidden;    border-bottom: hidden;    padding: 0 1.5em 1em 1.5em;    margin: 0;}#content {    -webkit-column-count: 1;    -moz-column-count: 1;    column-count: 1;}code {    font-size: 0.9em;    font-family: "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Lucida Console", "Courier New", Courier, monospace;    color: black;    display: inline-block;    font-weight: bold;}pre code {    font-size: 1em;    font-family: monospace;    line-height: 1.3em;    overflow: auto;    font-weight: normal;}kbd {    font-size: 1.1em;    padding: 0.1em 0.6em;    border: 1px solid #ccc;    font-family: monospace;    background-color: #f7f7f7;    color: #333;    -moz-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    -webkit-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    -moz-border-radius: 3px;    -webkit-border-radius: 3px;    border-radius: 3px;    display: inline-block;    margin: 0 0.1em;    text-shadow: 0 1px 0 #fff;    white-space: nowrap;}h1, h2, h3, h4, h5, h6 {    font-family: Calibri, "Gill Sans", "Gill Sans MT", "Myriad Pro", Myriad, "DejaVu Sans", Tahoma, Geneva, Helvetica, Arial, sans-serif;    margin-bottom: 0;}h1 {    font-size: 2.5em;    text-align: center;    border-bottom: 6px solid black;}h2 {    font-size: 2.0em;    text-align: left;    border-bottom: 2px solid black;}h3 {    font-size: 1.6em;    text-align: left;    border-bottom: 1px solid lightgrey;}h4 {    font-size: 1.5em;    text-align: left;}h5 {    font-size: 1.3em;    text-align: left;}ul, ol {    padding-left: 2em;}ul li {    list-style-type: square;}ul li li {    list-style-type: disc;}ul li li li {    list-style-type: circle;}ol li {    list-style-type: decimal;}p, para, b, strong, i, em, emph {    font-size: 1em;}blockquote {    font-size: 1.2em;    font-style: italic;    margin-left: 2em;}b, strong {    font-weight: bold;}i, em, emph {    font-style: italic;}table {    margin: 0.5em;    border-spacing: 0;    border-collapse: collapse;}th, td {    border: 1px solid lightgray;    padding-top: 0;    padding-bottom: 0;    padding-left: 0.45em;    padding-right: 0.45em;}.text-right {    text-align: right;}.text-small {    font-size: small;}.text-x-small {    font-size: x-small;}.banner {    display: block;    width: 100%;    margin-left: auto;    margin-right: auto;}.footer {    text-align: right;    float: right;    max-width: 18em;}.cc {    border-width: 0}.center {    text-align: center;}</style><style media="all" type="text/css">/* Ewan Themes -- based 99.99% from Tomorrow Night Theme *//* http://jmblog.github.com/color-themes-for-google-code-highlightjs *//* Original theme - https://github.com/chriskempson/tomorrow-theme *//* http://jmblog.github.com/color-themes-for-google-code-highlightjs *//* Tomorrow Comment */.hljs-comment {  color: #969896;}/* Tomorrow Red */.hljs-variable,.hljs-attribute,.hljs-tag,.hljs-regexp,.ruby .hljs-constant,.xml .hljs-tag .hljs-title,.xml .hljs-pi,.xml .hljs-doctype,.html .hljs-doctype,.css .hljs-id,.css .hljs-class,.css .hljs-pseudo {  color: #cc6666;}/* Tomorrow Orange */.hljs-number,.hljs-preprocessor,.hljs-pragma,.hljs-built_in,.hljs-literal,.hljs-params,.hljs-constant {  color: #de935f;}/* Tomorrow Yellow */.ruby .hljs-class .hljs-title,.css .hljs-rule .hljs-attribute {  color: #f0c674;}/* Tomorrow Green */.hljs-string,.hljs-value,.hljs-inheritance,.hljs-header,.hljs-name,.ruby .hljs-symbol,.xml .hljs-cdata {  color: #b5bd68;}/* Tomorrow Aqua */.hljs-title,.css .hljs-hexcolor {  color: #8abeb7;}/* Tomorrow Blue */.hljs-function,.python .hljs-decorator,.python .hljs-title,.ruby .hljs-function .hljs-title,.ruby .hljs-title .hljs-keyword,.perl .hljs-sub,.javascript .hljs-title,.coffeescript .hljs-title {  color: #81a2be;}/* Tomorrow Purple */.hljs-keyword,.javascript .hljs-function {  color: #b294bb;}.hljs {  display: block;  overflow-x: auto;  background: #1d1f21;  color: #c5c8c6;  padding: 0.5em;  -webkit-text-size-adjust: none;}.coffeescript .javascript,.javascript .xml,.tex .hljs-formula,.xml .javascript,.xml .vbscript,.xml .css,.xml .hljs-cdata {  opacity: 0.5;}pre code {    font-size: 1.1em;    font-family: monospace;    line-height: 1.3em;    overflow: auto;}</style></head><body><div id="content"><h1>Milda Enkonduko al la Nix-Familio</h1><p><div class="center">Esperanto ▪ <a href='/en/nix/'>English</a></div> <div class="center">la 5-an de aŭgusto 2018</div> <div class="center">Laste ĝisdatigita: la 8-an de marto 2019</div></p><blockquote><p>Ne maltrankviliĝu pri tio, kion la aliaj faros. La plej bona maniero por la estontecon antaŭdiri estas per tion eltrovi.<br> ―Alan KAY </p></blockquote><p><img src="/bil/wallhaven-751942-1008x250.png" style="display: block; width: 100%; margin-left: auto; margin-right: auto;" alt="wallhaven-751942" title="wallhaven-751942"/></p><h2><a name="et"></a>Enhavotabelo</h2><ul><li><a href='#enkonduko'>Enkonduko</a></li><li><a href='#nixos'>NixOS</a><ul><li><a href='#nixosinstalo'>Instalo</a><ul><li><a href='#nixossxalti'>La maŝinon ŝalti</a></li><li><a href='#nixosreto'>La reton agordi</a></li><li><a href='#nixosdiskoj'>La diskojn pretigi</a></li><li><a href='#nixosinstali'>Instali al disko</a></li></ul></li><li><a href='#nixosagordajxo'>Agordaĵo</a></li></ul></li><li><a href='#nix'>Nix</a><ul><li><a href='#nixsignovicoj'>Signovicoj</a></li><li><a href='#nixnombroj'>Nombroj</a></li><li><a href='#nixbuleaj'>Buleaj</a></li><li><a href='#nixlistoj'>Listoj</a></li><li><a href='#nixaroj'>Aroj</a></li><li><a href='#nixdosierindikoj'>Dosierindikoj</a></li><li><a href='#nixfunkcioj'>Funkcioj</a></li><li><a href='#nixlet'>Let</a></li><li><a href='#nixwith'>With</a></li><li><a href='#nixkondicxesprimoj'>Kondiĉesprimoj</a></li><li><a href='#nixdosierenportoj'>Dosierenportoj</a></li></ul></li><li><a href='#nixpkgs'>Nixpkgs</a><ul><li><a href='#nixpkgsinstalo'>Instalo</a></li><li><a href='#nixpkgsuzado'>Uzado</a><ul><li><a href='#nixpkgsgito'>Gito</a></li><li><a href='#nixpkgskanaloj'>Kanaloj</a></li><li><a href='#nixpkgsaliaj'>Aliaj komandoj</a></li></ul></li><li><a href='#nixpkgsagordajxo'>Agordaĵo</a></li><li><a href='#nixpkgskontribui'>Kontribui</a><ul><li><a href='#nixpkgsgxisdatigi'>Ekzistantan pakon ĝisdatigi</a></li><li><a href='#nixpkgssendi'>Novan pakon sendi</a></li></ul></li><li><a href='#nixpkgsnotoj'>Notoj</a></li></ul></li><li><a href='#medioj'>Medioj</a><ul><li><a href='#sistemmedio'>Sistemmedio</a></li><li><a href='#uzantmedio'>Uzantmedio</a></li><li><a href='#disvolvmedio'>Disvolvmedio</a></li></ul></li><li><a href='#surmetoj'>Surmetoj</a><ul><li><a href='#surmetojtranspasoj'>Transpasoj</a></li><li><a href='#surmetojnovajpakoj'>Novaj pakoj</a></li></ul></li><li><a href='#finrimarkoj'>Finrimarkoj</a></li><li><a href='#bonifiko'>Bonifiko</a></li></ul><h2><a name="enkonduko"></a>Enkonduko</h2><p>Venas rare ideoj kiuj la manieron por komputado povas ŝanĝi. Multe da teĥnologio kiujn ni uzas nune nur estas ripetoj de la malnovaj—niveloj sur niveloj de kosmetikoj kiuj la malnovajn konceptojn ĉirkaŭkovras. Tutaj produktaj sistemoj estas bazitaj sur ĉi tiu manko de kreemo kaj lerteco. Malnovaj problemoj ne solvitas. Pentrante per novaj kolortonoj, la problemojn ĉi tiuj tielnomataj elpensemaj solvoj nure ĉirkaŭigas anstataŭe, pretendante ke almenaŭ, ĝin ili plikolorplenigis. Progreson ĉi tiu mensostato difektas en nekalkuleblaj manieroj. La falsan impreson, ke la solvoj fakte estas faritaj ĉi tio donas. Falsan senson de plibonigoj ĉi tio kreas.</p><p>Antaŭ multaj jaroj siajn semajn <a href='https://nixos.org/~eelco/pubs/'>paperojn</a> <a href='https://nixos.org/~eelco/'>Eelco DOLSTRA</a> skribis, en kiu, la radikalajn manierojn por programaron disponigi li priskribis. La kernojn de <a href='https://nixos.org/nix/'>Nix</a>, pure funkcia paka mastrumila lingvo kiu la malsanon solvis kiu la komputikon delonge plagis—kompatinda paka mastrumado—ĉi tiuj paperoj formis. En ĉi tiu artikolo mi parolos pri la Nix-familio, kaj kiel ĝin uzi por la avantaĝo.</p><p>La dolarsigno ($) uzitos por la ŝelan inviton de normuzanto indiki, dum la kradsigno (#) uzitos por la ŝelan inviton de la ĉefuzanto indiki. Estas fojoj kiam la <a href='https://en.wikipedia.org/wiki/User_identifier#Effective_user_ID'>EUID</a> de komando estos nulo (0) pro la uzado de <em>sudo</em>.</p><h2><a name="nixos"></a>NixOS</h2><p>Kiom da fojo, difektitan sistemon oni havadis pro programaron oni ĝistadigis kiun aliaj komponantoj dependis? Kiom da malfruaj noktoj oni pasis por apon oni bezonis funkciigi pro ĝin la nova pako kiun oni instalis rompigis? Kiom da fojo, pro ĉagrenego, oni rezignis en la riparado de la sistemo kaj simple decidis por la sistemon reinstali el nulo. Datumdosierojn restaŭri facilas; sistemagordon de la lasta funkcia stato restaŭri, bedaŭrinde, estas unudirekta bileto al infero.</p><p><a href='https://nixos.org'>NixOS</a> (niks▪oŭ▪es) estas linuksa distribuo kiu ĉi tiajn problemojn solvas per la determinismon de <a href='https://nixos.org/nix'>Nix</a> ekspluati kaj per unu deklaran agorddosieron uzi kiu ĉiom da agordaĵoj kaj alĝustigiloj tenas en unu loko—<code>/etc/nixos/configuration.nix</code>. Informon pri la dosiersistemo, uzantoj, servoj, retagordo, enigaparatoj, kernaj parametroj, kaj pli ĉi tiu dosiero enhavas. Signifas, ke je <i>configuration.nix</i> de iu oni povas preni kaj ĝian ekzaktan sistemagordon havu! En NixOS oni ne plu bezonas ludadi pri la tutsistemo por la agordo kiun oni deziras. Porokazajn solvojn oni ne plu uzas por deziratan agordan staton precizigi. Aldonan programaron oni ne plu bezonas instali por sistemagordon mastrumi.</p><p>NixOS ne konformiĝas al <a href='https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard'>FHS</a> aldonan cerban damaĝon efektive malebligi—spacon donanta por multe da flekso kaj eltrovemo. Je <code>/usr/</code> kaj <code>/opt/</code> ĝi ne havas. Tamen, je <code>/bin/</code> kaj <code>/usr/bin/</code> ĝi havas, kiu nur je <code>sh</code> kaj <code>env</code> havas respektive—ambaŭ fakte estas simbolligiloj al la realaj programoj kiuj loĝas ie en <code>/nix/store/</code>. La supra loko por sistemprogramoj—la tiuj, kiuj estas instalitaj specife de la sistemestro—estas lokitaj en <code>/run/current-system/sw/bin/</code> kaj <code>/run/current-system/sw/sbin/</code>. Uzantinstalitaj programoj, aliflanke, troveblas en siaj respektivaj <code>&#126;/.nix-profile/bin/</code>-lokoj. Ĉi tiuj lokoj ne povas ŝanĝiĝi per kutimaj manieroj; dediĉitaj programoj devas esti uzataj por skribi al ĉi tiuj arboj.</p><h3><a name="nixosinstalo"></a>Instalo</h3><p>Simplas instalo de NixOS. Por «nudmetalaj» sistemoj, instalilon de <a href='https://nixos.org/nixos/download.html'>nixos.org/nixos/download.html</a> elŝutu. Virtualmaŝinaj diskbildoj ankaŭ haveblas de tiu paĝo. En mia lasta instalo, mi instalis per la jena agordo:</p><ul><li><a href='https://en.wikipedia.org/wiki/Unified_Extensible_Firmware_Interface'>UEFI</a></li><li>USB-praŝarĝo</li><li>Vifia konekto</li><li><a href='https://en.wikipedia.org/wiki/GUID_Partition_Table'>GUID-subdiska tabelo (GPT)</a></li><li><a href='https://en.wikipedia.org/wiki/Linux_Unified_Key_Setup'>LUKS</a> super <a href='https://en.wikipedia.org/wiki/Logical_volume_management'>LVM</a></li></ul><h4><a name="nixossxalti"></a>La maŝinon ŝalti</h4><p>Praŝarĝu per la USB-poŝmemorilo en UEFI-reĝimo. Sur la ensaluta invito, ensalutu kiel <code>root</code>.</p><h4><a name="nixosreto"></a>La reton agordi</h4><p>Haveblajn retojn skanu:</p><pre><code># nmcli d wifi list</code></pre><p>Tiam, konektu al la preferata enkursigilo:</p><pre><code># nmcli d wifi con PLDT name hejmo password sekreto</code></pre><h4><a name="nixosdiskoj"></a>La diskojn pretigi</h4><p>La subdiskojn kreu:</p><pre><code># gdisk /dev/sda
sda1: EF00 &#40;EFI system&#41;, 512 MiB
sda2: 8E00 &#40;Linux LVM&#41;, ceteraj</code></pre><p>Je <code>/dev/sda1</code> strukturu:</p><pre><code># mkfs.vfat -F 32 /dev/sda1</code></pre><p>La fizikan volumon kreu:</p><pre><code># pvcreate /dev/sda2</code></pre><p>La voluman grupon kreu:</p><pre><code># vgcreate vg /dev/sda2</code></pre><p>La logikajn volumojn kreu:</p><pre><code># lvcreate -L 20G -n swap vg
# lvcreate -l 100%FREE -n root vg</code></pre><p>La radikon ĉifru:</p><pre><code># cryptsetup luksFormat /dev/vg/root
# cryptsetup luksOpen /dev/vg/root root</code></pre><p>La radikon strukturu:</p><pre><code># mkfs.ext4 -j -L root /dev/mapper/root</code></pre><p>La permutodosieron strukturu:</p><pre><code># mkswap -L swap /dev/vg/swap</code></pre><p>La dosiersistemojn surmetu:</p><pre><code># mount /dev/mapper/root /mnt
# mkdir /mnt/boot
# mount /dev/sda1 /mnt/boot</code></pre><p>La permutodosieron ŝaltu:</p><pre><code># swapon /dev/vg/swap</code></pre><h4><a name="nixosinstali"></a>Instali al disko</h4><p>La bazagorddosieron kreu:</p><pre><code># nixos-generate-config --root /mnt</code></pre><p>La agorddosieron redaktu:</p><pre><code># nano /mnt/etc/nixos/configuration.nix</code></pre><p>Por la procedon plifaciligi, malpligrandigitan version de <a href='https://github.com/ebzzry/dotfiles/blob/master/nixos/configuration.nix'>mia agorddosiero</a> oni povas uzi, kaj sekve. La valorojn anstataŭigu laŭ oni preferas. Ĉiom da agordaj alĝustigiloj haveblas <a href='https://nixos.org/nixos/options.html'>ĉi tie</a>.</p><pre><code class="nix">{ config, lib, pkgs, ... }:

{
  imports = &#91;
      ./hardware-configuration.nix
  &#93;;

  boot = {
    loader = {
      systemd-boot.enable = true;
      efi.canTouchEfiVariables = true;
    };

    initrd.availableKernelModules = &#91;
      &quot;xhci&#95;pci&quot;
      &quot;ehci&#95;pci&quot;
      &quot;ahci&quot;
      &quot;usb&#95;storage&quot;
      &quot;sd&#95;mod&quot;
      &quot;rtsx&#95;pci&#95;sdmmc&quot;
    &#93;;

    initrd.luks.devices = &#91;
      {
        device = &quot;/dev/vg/root&quot;;
        name = &quot;root&quot;;
        preLVM = false;
      }
    &#93;;

    cleanTmpDir = true;
  };

  fileSystems = &#91;
    {
      device = &quot;/dev/disk/by-uuid/6106-6BF8&quot;;
      fsType = &quot;vfat&quot;;
      mountPoint = &quot;/boot&quot;;
    }

    {
      device = &quot;/dev/mapper/root&quot;;
      fsType = &quot;ext4&quot;;
      mountPoint = &quot;/&quot;;
    }
  &#93;;

  swapDevices = &#91;
    {
      device = &quot;/dev/vg/swap&quot;;
    }
  &#93;;

  networking = {
    hostName = &quot;ombrelo&quot;;
    hostId = &quot;7B1548AE&quot;;
    enableIPv6 = true;
    networkmanager.enable = true;
  };

  environment = {
    systemPackages = with pkgs; &#91; zsh &#93;;
  };

  time.timeZone = &quot;Asia/Manila&quot;;

  security.sudo = {
    enable = true;
    configFile = ''
      Defaults env&#95;reset
      root ALL = &#40;ALL:ALL&#41; ALL
      %wheel ALL = &#40;ALL&#41; SETENV: NOPASSWD: ALL
    '';
  };

  services = {
    xserver = {
      autorun = true;
      defaultDepth = 24;
      enable = true;
      displayManager.kdm.enable = true;
      desktopManager.kde5.enable = true;
      videoDrivers = &#91; &quot;intel&quot; &#93;;
    };
  };

  users = {
    extraUsers.vakelo = {
      isNormalUser = true;
      uid = 1000;
      extraGroups = &#91; &quot;wheel&quot; &quot;networkmanager&quot; &quot;docker&quot; &#93;;
    };
    defaultUserShell = &quot;/run/current-system/sw/bin/zsh&quot;;
  };
}
</code></pre><p>Se la <code>nixos-generate-config</code> paŝon ĉi-supre oni preterpasis, la antaŭproduktan dosieron kreu permane:</p><pre><code># mkdir -p /mnt/etc/nixos</code></pre><p>La ĉi-supran dosieron oni povas konservi per:</p><pre><code># curl -sSLo /mnt/etc/nixos/configuration.nix https://goo.gl/ZTQcGs</code></pre><p>Pli longa versio haveblas per:</p><pre><code># curl -sSLo /mnt/etc/nixos/configuration.nix https://goo.gl/K4P7l5</code></pre><p>La UUID-identigilon de la disko anstataŭigu per la tiu, kiun oni havas. La komandon <code>blkid</code> uzu por la UUID-identigilojn akiru. Por la valoro de <code>networking.hostID</code> la jenan komandon uzu:</p><pre><code># cksum /etc/machine-id | while read c rest; do printf &quot;%x&quot; $c; done</code></pre><p>La jenan la ĉi-supra agordo precizigas, inter aliaj aferoj:</p><ul><li>Uzanton <code>vakelo</code> kreas kun tuta <i>sudo</i>-aliro.</li><li>Je KDE5 uzas kiel la fenestrilo.</li><li>La sekurŝelon ŝaltas.</li><li>La LUKS-parametrojn precizigas.</li></ul><p>Je NixOS instalu al la disko:</p><pre><code># nixos-install</code></pre><p>Je <code>/etc/nixos/configuration.nix</code> ĉi tiu komando analizas, asekurante, ke ne estas eraroj. Ĉiom da necesaj pakoj por kongrui al la specifo ĉi tiu komando elŝutos.</p><p>Post kiam la instalo finiĝis, la sistemon repraŝarĝu.</p><pre><code># reboot</code></pre><h3><a name="nixosagordajxo"></a>Agordaĵo</h3><p>Instalinte, la ekzistantan agordaĵon ĝisdatigi facilas. Ĉio kion oni devas fari estas la agorddosieron redakti tiam la sistemon rekunmetu:</p><pre><code># nano /etc/nixos/configuration.nix
# nixos-rebuild switch</code></pre><p>Se okazis eraro, onin la sistemo avizos pri tio, anstataŭ pluigi per malĝusta agordo. Post kiam la sistemo finfaris reŝarĝi, iru al la konzolo per <kbd>Ctrl+Alt+F1</kbd>, tiam ensalutu kiel <code>root</code>, tiam pasvorton por la uzanto kiun ni precizigis en <code>configuration.nix</code> agordu:</p><pre><code># passwd vakelo</code></pre><p>Eliru de la ŝelo, tiam iru al la grafika fasado per <kbd>Alt+F7</kbd>, tiam ensalutu kiel <code>vakelo</code>.</p><h2><a name="nix"></a>Nix</h2><p>La komponanto kiu la koron de NixOS kaj Nixpkgs fondas estas la <a href='https://nixos.org/nix'>Nix</a>-lingvo (niks). Ĝi estas deklarlingvo kreita por pakojn mastrumi.</p><p>Por ke la lingvon oni facile povu kompreni, je nix-repl ni instalu:</p><pre><code>$ nix-env -iA $&#40;nix-channel --list | awk '{print $1}'&#41;.nix-repl</code></pre><p>Sekve, ĝin ni plenumu. Oni salutiĝas per la versinombro, kaj la invito de nix-repl. Ĉi tiun artikolon skribante, la plej ĵusa stabila versinombro estas 1.11.8:</p><pre><code class="nix">$ nix-repl
Welcome to Nix version 1.11.8. Type :? for help.

nix-repl&gt;
</code></pre><p>Bazajn esprimojn ni elprovu.</p><h3><a name="nixsignovicoj"></a>Signovicoj</h3><p>Samkiel en aliaj lingvoj, signovicoj taksas al si mem:</p><pre><code class="nix">nix-repl&gt; &quot;hundo&quot;
&quot;hundo&quot;
</code></pre><p>Por signovicojn kunmeti, la operacisimbolon <code>+</code> uzu:</p><pre><code class="nix">nix-repl&gt; &quot;hundo&quot; + &quot;kato&quot;
&quot;hundokato&quot;
</code></pre><p>Alia maniero por signovicojn deklari, estas por du parojn de unuoblaj citiloj uzi. Ne konfuziĝu pri ĝi kontraŭ la duoblaj citiloj:</p><pre><code class="nix">nix-repl&gt; ''hundo kato''
&quot;hundo kato&quot;
</code></pre><p>La avantaĝo de je <code>''</code> uzi anstataŭ je <code>&quot;</code>, estas, la ĉeeston de <code>&quot;</code> ene ĝi ĝi permesas:</p><pre><code class="nix">nix-repl&gt; ''&quot;hundo&quot; &quot;kato&quot;''
&quot;\&quot;hundo\&quot; \&quot;kato\&quot;\&quot;
</code></pre><p>La valoro kiun ĝi revenas estos ĝuste citita. Ĉi tio utilas poste kiam pli komplikajn esprimojn ni muntos.</p><p>Por signovicojn elreferenci ene signovicoj, la formon <code>${name}</code> uzu:</p><pre><code class="nix">nix-repl&gt; x = &quot;hundo&quot;

nix-repl&gt; y = &quot;kato&quot;

nix-repl&gt; &quot;${x} ${y}&quot;
&quot;hundo kato&quot;

nix-repl&gt; ''${x} ${y}''
&quot;hundo kato&quot;
</code></pre><h3><a name="nixnombroj"></a>Nombroj</h3><p>Bazaj aritmetikaj operacioj en Nix estas inkluzivitaj kun malgranda surprizo:</p><pre><code class="nix">nix-repl&gt; 6+2
8

nix-repl&gt; 6-2
4

nix-repl&gt; 6&#42;2
12

nix-repl&gt; 6/2
/home/vakelo/6/2
</code></pre><p>Ups! Tio ne estis, kion ni anticipis. Pro Nix estas desegnitaj kun dosieroj kaj dosierujoj en la kalkulo, specialan kazon ĝi kreis, ke kiam suprenstreko (/) signo estas ĉirkaŭitaj per nespacetaj signoj, ĝin ĝi interpretas kiel dosierujindiko, rezultonte al absolutdosierindiko. Por dividon fari efektive, almenaŭ unu spaceton antaŭ kaj post la <code>/</code> signo aldonu:</p><pre><code class="nix">nix-repl&gt; 6 / 2
3
</code></pre><p>Parenteze, ne estas glitpunktaj en Nix. Do, se ĝin oni provas fari, oni akiras:</p><pre><code class="nix">nix-repl&gt; 1.0
error: syntax error, unexpected INT, expecting ID or OR&#95;KW or DOLLAR&#95;CURLY or '&quot;', at &#40;string&#41;:1:3
'&quot;'
</code></pre><p>La operacion de <code>/</code> la funkcio <code>builtins.div</code> faras esence:</p><pre><code class="nix">nix-repl&gt; builtins.div 6 3
2
</code></pre><p>La kontrasto tamen, estas, ke <code>builtins.div</code> povas esti aplikita parte:</p><pre><code class="nix">nix-repl&gt; &#40;builtins.div 6&#41;
«primop-app»
</code></pre><p>Fermon de parte aplikita funkco ĉi tiu esprimo revenas. Alian valoron por ĝin tute apliki ni bezonas:</p><pre><code class="nix">nix-repl&gt; &#40;builtins.div 6&#41; 3
2
</code></pre><p>La valoron de tiu parta esprimo ni eĉ povas konservi:</p><pre><code class="nix">nix-repl&gt; d = builtins.div 6
</code></pre><p>La operacisimbolo <code>=</code> en Nix estas uzata por valorojn bindi. En ĉi tiu ekzemplo, ĝi estas uzita por partan aplikon difini. Por tiun funkcion uzi:</p><pre><code class="nix">nix-repl&gt; d 3
2
</code></pre><h3><a name="nixbuleaj"></a>Buleaj</h3><p>Vereco kaj malvereco estas reprezentitaj de <code>true</code> kaj <code>false</code>:</p><pre><code class="nix">nix-repl&gt; 1 &lt; 2
true

nix-repl&gt; 1 &gt; 2
false

nix-repl&gt; 1 == 1
true

nix-repl&gt; &quot;hundo&quot; == &quot;hundo&quot;
true

nix-repl&gt; &quot;hundo&quot; &gt; &quot;kato&quot;
false

nix-repl&gt; false || true
true

nix-repl&gt; false &amp;&amp; true
false
</code></pre><h3><a name="nixlistoj"></a>Listoj</h3><p>Listoj estas heterogenaj tipoj por seriaj valoroj enteni. Eroj estas apartigitaj per spacetoj:</p><pre><code class="nix">nix-repl&gt; &#91; 1 &quot;hundo&quot; true &#93;
&#91; 1 &quot;hundo&quot; true &#93;
</code></pre><p>Por listojn kunmeti:</p><pre><code class="nix">nix-repl&gt; &#91; 1 &quot;hundo&quot; true &#93; ++ &#91; false &#40;6 / 2&#41; &#93;
&#91; 1 &quot;hundo&quot; true false 3 &#93;
</code></pre><p>Por la kopon eltiri:</p><pre><code class="nix">nix-repl&gt; builtins.head &#40;&#91; 1 &quot;hundo&quot; true &#40;6 / 2&#41; &#93; ++ &#91; false &#40;6 / 2&#41; &#93;&#41;
1
</code></pre><p>Por la voston eltiri:</p><pre><code class="nix">nix-repl&gt; builtins.tail &#40;&#91; 1 &quot;hundo&quot; true &#40;6 / 2&#41; &#93; ++ &#91; false &#40;6 / 2&#41; &#93;&#41;
&#91; &quot;hundo&quot; true 3 false 3 &#93;
</code></pre><p>Listoj estas indeksitaj komence de <a href='https://www.cs.utexas.edu/users/EWD/transcriptions/EWD08xx/EWD831.html'>0 (angle)</a>. Por la 1-an eron akiri, la operatoron <code>builtins.elemAt</code> uzu:</p><pre><code class="nix">nix-repl&gt; builtins.elemAt &#91; 1 &quot;hundo&quot; true &#93; 1
&quot;hundo&quot;
</code></pre><h3><a name="nixaroj"></a>Aroj</h3><p>Grava datumstrukturo en Nix estas aroj. Ili estas paroj de ŝlosilvorto-valoro apartigitaj per punktokomoj:</p><pre><code class="nix">nix-repl&gt; { a = 0; b = &quot;kato&quot;; c = true; cx = &#40;6 / 2&#41;; }
{ a = 0; b = &quot;kato&quot;; c = true; cx = 3; }
</code></pre><p>Tio, kion arojn igas malsamaj kontraŭ listoj, estas, ke valorojn eltiri el ili estas faritaj per referencojn nomi. Por la valoron de <code>b</code> eltiri, la operacisimbolon <code>.</code> uzu:</p><pre><code class="nix">nix-repl&gt; { a = 0; b = &quot;kato&quot;; c = true; cx = &#40;6 / 2&#41;; }.b
&quot;kato&quot;
</code></pre><p>kiu estas ekvivalenta al:</p><pre><code class="nix">nix-repl&gt; { a = 0; b = &quot;kato&quot;; c = true; cx = &#40;6 / 2&#41;; }.&quot;b&quot;
&quot;kato&quot;
</code></pre><p>Por anon elreferenci el tiu sama aro, la ŝlosilvorton <code>rec</code> uzu:</p><pre><code class="nix">nix-repl&gt; rec { a = 0; b = &quot;kato&quot;; c = true; cx = &#40;6 / 2&#41;; d = b; }.d
&quot;kato&quot;
</code></pre><h3><a name="nixdosierindikoj"></a>Dosierindikoj</h3><p>En Nix ĉiom da dosierindikoj estas tradukitaj al absolutdosierindikoj. Se referencon al dosiero en la aktuala dosierujo oni faras:</p><pre><code class="nix">nix-repl&gt; ./hundo
/home/vakelo/hundo
</code></pre><p>Fariĝas absolutdosierindiko. Ĉi tio estas Bonaĵo™.</p><p>Simile, se referencon al relativdosierindiko oni faras ene absolutdosierindiko, ĝi ankoraŭ tradukiĝas al absolutdosierindiko.</p><pre><code class="nix">nix-repl&gt; /./hundo
/hundo
</code></pre><p>Notu, bedaŭrinde, ke dosierindikoj kiuj staras sole ne plaĉas al Nix:</p><pre><code class="nix">nix-repl&gt; /
error: syntax error, unexpected '/', at &#40;string&#41;:1:1

nix-repl&gt; ./
error: syntax error, unexpected '.', at &#40;string&#41;:1:1
</code></pre><h3><a name="nixfunkcioj"></a>Funkcioj</h3><p>Ĉu eĉ ekzistas plezuro se ne estos verbojn por uzi kun ĉi tiuj substantivoj? Similecojn al aliaj lingvoj funkcioj en Nix kunhavas, ĝiajn unikajn trajtojn havante.</p><p>Jen la bazformo de funkcio:</p><pre><code class="nix">nix-repl&gt; x: x
«lambda»
</code></pre><p>Sennoman funkcion kiu sian argumenton revenas ĉi tiu esprimo kreas—la <a href='https://en.wikipedia.org/wiki/Identity_function'>identa funkcio (angle)</a>. La dupunkto post la unua <code>x</code> montras, ke ĝi estas parametro al la funkcio, samkiel en <a href='/eo/lambdokalkulo/#funkcioj'>lambdokalkulo</a>. Aldone, la nomoj ne gravas pro <a href='https://eo.wikipedia.org/wiki/Lambda-kalkulo#%CE%B1-konverto'>alfa-ekvivalenteco</a>:</p><pre><code class="nix">nix-repl&gt; hundo-kato-muso: hundo-kato-muso
«lambda»
</code></pre><p>Ĉi tiuj funkcioj ne estas tre utilaj tial, ke ili ne estas kaptitaj por aplikado. Se ĝin oni volas uzi, ekzemple, kun la argumento <code>&quot;hundo&quot;</code>, ĝin ni bezonas ĉirkaŭkovri per rondkrampoj:</p><pre><code class="nix">nix-repl&gt; &#40;x: x&#41; &quot;hundo&quot;
&quot;hundo&quot;
</code></pre><p>Por pli da amuzo aldoni, tiun funkcion ni nomu:</p><pre><code class="nix">nix-repl&gt; idento = x: x
</code></pre><p>Bonege! Nun, ĝin ni apliku:</p><pre><code class="nix">nix-repl&gt; idento &quot;hundo&quot;
&quot;hundo&quot;
</code></pre><p>Funkcion kiu je <code>&quot; ve&quot;</code> postaldonas al sia enigo ni kreu, tiam ĝin ni apliku:</p><pre><code class="nix">nix-repl&gt; ve = s: s + &quot; ve&quot;

nix-repl&gt; ve &quot;mi&quot;
&quot;mi ve&quot;
</code></pre><p>Por funkcion krei kiu alian argumenton akceptas, la jenan formon ni uzu:</p><pre><code class="nix">nix-repl&gt; ve = s: t: s + &quot; ve &quot; + t

nix-repl&gt; ve &quot;mi&quot; &quot;vi&quot;
&quot;mi ve vi&quot;
</code></pre><p>La modelo, estas, ke por aldonan parametron aldoni, la formon <code>name: </code> uzu.</p><p>Aroj, kiam uzitaj kun funkcioj, pli da potencaj abstraktadoj ŝaltas. Aron kiel argumento al funkcio ni povas doni, kiu la datumon ene tiu aro do uzos:</p><pre><code class="nix">nix-repl&gt; anaso = { a, b }: x: a + &quot; &quot; + b + x
</code></pre><p>Du parametrojn ĉi tiu funkcio havas: <code>{ a, b }</code>—parametra specifo por aro kun du eroj, kaj <code>x</code>—kutima parametro. Tenu en la kalkulo, ke parametra specifo ne estas veraro, sed nur maniero por la argumentojn kongrui; komon ĝi uzas kiel apartigilo de valoro. Ene ĉi tiu funkcio la enigojn ni povas kombini per la operacisimbolon <code>+</code>. Por ĉi tiun funkcion uzi, ĝin ni uzu jene:</p><pre><code class="nix">nix-repl&gt; anaso { a = &quot;ve&quot;; b = &quot;mi&quot;; } &quot; anaso&quot;
&quot;ve mi anaso&quot;
</code></pre><p>Kiam aron funkcio deklaras kiel sia parametro, la ŝlosilvortojn oni devas precizigi kiam la funkciojn kiu ilin uzas invoki. Tiukaze, la nomoj de sa ŝlosilvortoj estas <code>a</code> kaj <code>b</code>:</p><p>La difino de <code>anaso</code> supre estas semantike simila al:</p><pre><code class="nix">nix-repl&gt; anaso = ve: x: ve.a + &quot; &quot; + ve.b + x
</code></pre><p>Kutiman, ne-aran parametron ni uzis ĉi tie por ke ĝi povu referenci al la aro kiel valoro. Ĉi tion rimarku:</p><pre><code class="nix">nix-repl&gt; ve = { a = &quot;hundo&quot;; b = &quot;kato&quot;; }

nix-repl&gt; ve.a
&quot;hundo&quot;
</code></pre><p>Ankaŭ eblas por la defaŭltajn valorojn precizigi. Kiam parametro kun defaŭlta valoro ne estas uzita, la defaŭlta valoro estos uzita. Simile, en Komunlispo:</p><pre><code class="lisp">&#42; &#40;defun birdo &#40;a &amp;optional &#40;b &quot;O.o&quot;&#41;&#41;
    &#40;concatenate 'string a b&#41;&#41;

&#42; &#40;birdo &quot;o.O &quot;&#41;

&quot;o.O O.o&quot;
&#42; &#40;birdo &quot;o.O &quot; &quot;&#94;&#95;&#94;&quot;&#41;

&quot;o.O &#94;&#95;&#94;&quot;
</code></pre><pre><code class="nix">nix-repl&gt; birdo = { a, b ? &quot;O.o&quot; }: a + b

nix-repl&gt; birdo { a = &quot;oro&quot;; }
&quot;oroO.o&quot;

nix-repl&gt; birdo { a = &quot;oro&quot;; b = &quot;argxento&quot;; }
&quot;oroargxento&quot;
</code></pre><p>Por pli da flekso aldoni, la uzon de pseŭdo-«rest» argumentoj Nix subtenas. La funkcion ĉi-supre ni modifu:</p><pre><code class="nix">nix-repl&gt; birdo = { a, b, ...}: a + b
</code></pre><p>Ĝin ni uzu:</p><pre><code class="nix">nix-repl&gt; birdo { a = &quot;ve&quot;; b = &quot;hundo&quot;; }
&quot;vehundo&quot;
</code></pre><p>Estas same. Do kiel tiun flekson ni povas uzi? Etikodon por la atribuaro ni kreos por ke ni povu referenci al la ‹ekstraj› valoroj:</p><pre><code class="nix">nix-repl&gt; birdo = atribuoj@{ a, b, ...}: a + b + atribuoj.c
</code></pre><p>Ĝin ni simple uzu kiel antaŭe, sed kun la uzado de la etikedo:</p><pre><code class="nix">nix-repl&gt; birdo { a = &quot;oro&quot;; b = &quot;argxento&quot;; c = &quot;bronzo&quot;; }
&quot;oroargxentobronzo&quot;
</code></pre><p>Mi diris ‹pseŭda› ĉar la valoro por <code>c</code> estis ankoraŭ postulita.</p><p>Defaŭltaj valoroj kaj variabla loknombro pova esti kunmetitaj:</p><pre><code class="nix">nix-repl&gt; birdo = atribuoj@{ a, b, c ? &quot;C&quot;, ... }: a + b + c + atribuoj.z

nix-repl&gt; birdo { a = &quot;A&quot;; b = &quot;B&quot;; z = &quot;Z&quot;; }
&quot;ABCZ&quot;

nix-repl&gt; birdo { a = &quot;A&quot;; b = &quot;B&quot;; c = &quot;X&quot;; z = &quot;Z&quot;; }
&quot;ABXZ&quot;

</code></pre><h3><a name="nixlet"></a>Let</h3><p>Onin la ŝlosilvorto <code>let</code> permesas por variablojn difini en lokamplekso. Ekzemple, por la identigilojn <code>x</code> kaj <code>y</code> igi videblaj nur en lokamplekso:</p><pre><code class="nix">nix-repl&gt; let x = &quot;hundo&quot;; y = &quot;kato&quot;; in x + anaso { a = &quot;ne&quot;; b = &quot;vere&quot;; } &quot;efektive&quot; + y
&quot;hundone vereefektivekato&quot;
</code></pre><p>La lastan <code>;</code> antaŭ la <code>in</code> ŝlosilvorto kiu iras kun <code>let</code> tenu en la kalkulo—la komencon de la korpo de <code>let</code> ĝi markas. La <code>let</code> konstruo kondutas simile al la <code>let</code> ŝlosilvorto troveblas en programlingvoj kiel Lispo kaj Haskelo.</p><h3><a name="nixwith"></a>With</h3><p>Onin la ŝlosilvorto <code>with</code> permesas por arvalorojn demeti en amplekso:</p><pre><code class="nix">nix-repl&gt; with { x = &quot;hundo&quot;; y = &quot;kato&quot;; }; anaso { a = y; b = x; } &quot; xyz&quot;
&quot;kato hundo xyz&quot;
</code></pre><p>Kio okazis ĉi tie, estas, ke la valoroj en tiu aro senvualiĝis por ilin disponebligi en la korpo de <code>with</code>.</p><h3><a name="nixkondicxesprimoj"></a>Kondiĉesprimoj</h3><p>Kondiĉesprimoj estas faritaj per la <code>if</code> ŝlosilvorto. Similan formon de plimultaj lingvoj ĝi havas:</p><pre><code class="nix">nix-repl&gt; if true then &quot;true&quot; else &quot;false&quot;
&quot;true&quot;
</code></pre><p>Ĝi povas esti nestiĝita:</p><pre><code class="nix">nix-repl&gt; if false then &quot;true&quot; else if false then &quot;true&quot; else if false then &quot;true&quot; else &quot;false&quot;
&quot;false&quot;
</code></pre><h3><a name="nixdosierenportoj"></a>Dosierenportoj</h3><p>La ideo de dosierojn enporti en Nix-esprimo estas subtile malsame al aliaj lingvoj. Enportoj en Nix intime rilatas al aroj. Supozante, ke la dosieron <code>ve.nix</code> ni havas, kiu la jenan enhavas:</p><pre><code class="nix">let
  ve = x: x + &quot;ve&quot;;
in {
  ve = ve;
}
</code></pre><p>La saman <code>ve</code> la let-esprimo bindas al funkcio kiu unu argumenton akceptas. En la korpo de <code>let</code>, aron ĝi revenas kiu unu membron kun la nomo <code>ve</code> havas—la tiu en la maldekstra parto de la <code>=</code>. La valoro de ĉi tiu ano estas la funkcio kiun ni ĵus difinis. La grava koncepto por memorigi, estas, ke atribuaron ĉi tiu let-esprimo revenas.</p><p>Ni reen iru al la <a href='https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop'>REPL (angle)</a> por ĉi tiun dosieron uzi:</p><pre><code class="nix">nix-repl&gt; import ./ve.nix
{ ve = «lambda»; }
</code></pre><p>La lambdo-terminon ni denove vidas. Sajnas, ke la <code>ve</code> nomo ĉi tie estas funkcio. Nun, kiel ĉi tiun valoron ni povas elreferenci? La operatoron <code>.</code> ni uzu!</p><pre><code class="nix">nix-repl&gt; &#40;import ./ve.nix&#41;.ve &quot;hundo&quot;
&quot;hundove&quot;
</code></pre><p>Rondkrampojn ni devis uzi tial, ke ne ekzistas tia dosiero <code>ve.nix.ve</code> en la aktuala dosierujo. Se ĝin ni trapasos, ĝi aperos jene:</p><pre><code class="nix">nix-repl&gt; { ve = «lambda»; }.ve &quot;hundo&quot;
</code></pre><p>fariĝos:</p><pre><code class="nix">nix-repl&gt; { ve = &#40;x: x + &quot;ve&quot;&#41;; }.ve &quot;hundo&quot;
&quot;hundove&quot;
</code></pre><p>La enkondukajn konceptojn de la Nix-lingvo ĉi tiu sekcio resumas. La ceteraj vilaj detaloj troveblas en la <a href='https://nixos.org/nix/manual/#ch-expression-language'>gvidilo</a>.</p><h2><a name="nixpkgs"></a>Nixpkgs</h2><p>Nixpkgs (niks▪pa▪kej▪ĝes) estas kolekto de pakoj organizitaj kaj mastrumitaj per uzantoj tutmonde. Pro la fontkodo estas en <a href='https://github.com/nixos/nixpkgs'>GitHub</a>, la avantaĝon de la potenca kunlaborada sistemo kiun tiu platformo ofertas ĝi eblas ekspluati. Ĉi tiun artikolon skribante, estas 42583 pakoj en la <a href='https://nixos.org/nixos/packages.html'>kolekto</a>. Larĝan tabelon de pakoj iras de produktivecaj apoj al teoremaj pruviloj.</p><p>Pakojn plejparto de popularaj operaciumoj traktas bone, ĝis ili ne plu. Tiel longe kiel oni movas en rektan linion, sole, oni sekuras. Aferoj ŝanĝiĝas, kiam aliaj homoj enkondukiĝas en la marŝo. Por ke la tutgrupo movu en unisono, ĉiuj devas esti konektita al unu la alia. Se ano decidas forvojaĝi, kaj sole marŝi, la tutgrupo kripliĝos. Tamen, se sin tiu ano decidas kloni por ke la forvojaĝado fariĝu sendependa, la originala marŝada grupo fariĝas nemodifita.</p><p>La kazon de distribuo celita kiel pluruzanta produkta disvolva medio ni traktu. Kiam fajrfokson versio 100 oni instalas, la ĉefa duuma dosiero iras al aŭ <code>/usr/bin/firefox</code> aŭ <code>/usr/local/bin/firefox</code>. Sekve, la apon el tiu dosierindiko ĉiom da uzantoj povas aliri; Johano, Mario, kaj Petro feliĉas. Bedaŭrinde, se ĝin Johano decidis aktualigi al versio 200, la sama apo kiun Mario kaj Petro uzas ankaŭ aktualiĝis! Tio ne estas bonaĵo se la malnovan version kiu funkcias al ili ili preferas! Onin Nix permesas por plurajn versiojn de programaro havi sen kolizioj al la aliaj versioj. Siajn preferatajn versiojn de fajrfokso Johano, Mario, kaj Petro povas havi sen konfliktoj kun la aliaj versioj. Kiel ĝin Nixpkgs faras? Ĝin ĝi faras per la komponantojn nomi per iliaj kalkulitaj kontrolsumoj kaj per komunan tutmondan lokon ne uzi.</p><p>Siajn proprajn versiojn de <code>&#126;/.nix-profile</code> ĉiom da uzantoj havas kaj kutimajn dosierojn ĉiom da enhavo de tiuj dosierujoj ne havas. Anstataŭ, ili estas simbolligiloj al la efektivaj dosieroj troveblas en <code>/nix/store/</code>. Ĉi tiu dosierujo, estas kie la programoj kaj siaj dependecoj estas efektive instalitaj. La nur maniero por skribi al tiu dosierujo estas per la dediĉitaj Nix-programoj. Ne estas maniero por tiun dosierujon rekte modifi per normaj manieroj. Do, kiam je Vim 8 la uzanto <code>johano</code> instalas, la programo fariĝas instalita kiel <code>/nix/store/w4cr4j13lqzry2b8830819vdz3sdypfa-vim-8.0.0329</code>. La signoj antaŭ la paknomo estas la kontrolsumo de ĉiom da enigoj kiuj estis uzitaj por la pakon konstrui. La dosiero <code>/home/johano/.nix-profile/bin/vim</code> tiam montras al simbolligo, en dosiero troveblas en <code>/nix/store/</code> kiu kondukas al la efektiva Vim-duumdosiero en <code>/nix/store/w4cr4j13lqzry2b8830819vdz3sdypfa-vim-8.0.0329/bin/vim</code>.</p><h3><a name="nixpkgsinstalo"></a>Instalo</h3><p>Se je NixOS oni uzas ĉi tiun sekcion preterpasu tial, ke Nixpkgs iras kun ĝi. Por je Nixpkgs instali sur linukso aŭ makintoŝo, plenumu:</p><pre><code>$ curl https://nixos.org/nix/install | bash</code></pre><p>Oni invitiĝos al la ensalutilojn por ĉefuzantan aliron eniri per <em>sudo</em> tial, ke la risurcojn ĝi instalos al <code>/nix/</code>. Post la instalo, oni petiĝas por linion de komando al la ŝela pravaloriza dosiero aldoni. Kiam novajn aperaĵojn de la ŝelo oni generas la komandoj specifaj al Nix fariĝos haveblaj.</p><h3><a name="nixpkgsuzado"></a>Uzado</h3><p>Estas du manieroj por pakojn instali per Nixpkgs; la gita kopio, kiu estas la plej ĵusa versio, ĝisdatigita ĝis la lasta minuto, aŭ per kanalojn uzi. La <a href='https://github.com/nixos/nixpkgs'>gitdeponejo</a> idealas por uzantoj kiuj la plej novajn versiojn de pako volas uzi, aŭ por uzantoj kiuj volas eltesti. <a href='https://nixos.org/channels/'>Kanaloj</a> aliflanke, estas esence kopioj de la gitdeponejo en antaŭ tempo.</p><h4><a name="nixpkgsgito"></a>Gito</h4><p>Okazas ofte ĝisdatigoj al la gitdeponejo—ĉi tiun artikolon legante, <a href='https://github.com/nixos/nixpkgs/pulls/'>novaj ŝanĝoj</a> estas faritaj al la ĉefarbo. Por la gitkopion uzi, la <a href='https://github.com/nixos/nixpkgs'>deponejon</a> klonu:</p><pre><code>$ git clone https://github.com/nixos/nixpkgs &#126;/nixpkgs</code></pre><p><code>nixpkgs/</code> dosierujo ĉi tiu komando kreas sub la hejmdosierujo. Se la uzanto estas <code>vakelo</code>, la klono de la deponejo troveblas ĉe <code>/home/vakelo/nixpkgs/</code> aŭ <code>/Users/vakelo/nixpkgs/</code>, se linukson aŭ makintoŝon oni uzas respektive.</p><p>Por pakon instali, ekzemple, <em>emem</em>—Markdown- al HTML-dosiero konvertilo—per la gitkopio, plenumu:</p><pre><code>$ nix-env -f &#126;/nixpkgs/default.nix -iA emem</code></pre><p>Je <em>emem</em> ĉi tiu komando elŝutas kun ĝiajn dependecojn, kaj la programon ĝi disponebligas al oni. Por certigi, ke emem estas efektive instalita, plenumu:</p><pre><code>$ emem --version</code></pre><p>Se la ŝelo ne vomiĝas kaj plendas, ke tio, kion oni volas trovi ne ekzistas, kaj versinombron oni vidas, do signifas ke je emem oni sukcese instalis.</p><p>Por la plej ĵusajn ŝanĝojn akiri el la gitdeponejo, plenumu:</p><pre><code>$ cd &#126;/nixpkgs &amp;&amp; git pull origin master</code></pre><h4><a name="nixpkgskanaloj"></a>Kanaloj</h4><p>Pakojn instali per kanaloj pli agrablas tial, ke la komandoj por pakojn instali estas pli oportunaj. La kompromiso, estas, ke la pakoj estas malaktualaj de iom da tagoj. Se oni bonas pri tio, tiam kanalojn uzi anstataŭ la gitkopion.</p><p>Kanaloj estas etikeditaj <code>stable</code>, <code>unstable</code>, aŭ per specifa versinombro, ekzemple, <code>17.03</code> aŭ <code>18.09</code>. Por ĉi tiu artikolo, je <code>unstable</code> ni uzu—ĝi nek estas tiel malaktuala kiel <code>stable</code> nek tiel ĵuŝa kiel la gitkopio. Por aboni al la <code>unstable</code>-kanalo, plenumu:</p><pre><code>$ nix-channel --add https://nixos.org/channels/nixpkgs-unstable nixpkgs</code></pre><p>La kanalon etikedita <code>nixpkgs-unstable</code> ĉi tio irprenas el nixos.org, tiam instolas al la uzantprofilo.</p><p>Por la listojn de kanaloj esplori, <a href='https://nixos.org/channels/'>ĉi tien</a> iru.</p><p>Per la ekzemplo ĉi-supre, je <em>emem</em> instali, la jenajn komandojn plenumu por NixOS kaj aliaj sistemoj, respektive:</p><pre><code>$ nix-env -iA nixos.emem</code></pre><pre><code>$ nix-env -iA nixpkgs.emem</code></pre><p>Por la kanalojn ĝisdatigi, plenumu:</p><pre><code>$ nix-channel --update</code></pre><p>Tempe, arboj en <code>/nix/store/</code> kreskiĝas kaj eble ekzistas dosierindikoj kiuj ne plu estas referencitaj per ajna pako. Por ĝin purigi, plenumu:</p><pre><code>$ nix-collect-garbage</code></pre><h4><a name="nixpkgsaliaj"></a>Aliaj komandoj</h4><p>Por pakon malinstali, plenumu:</p><pre><code>$ nix-env -e emem</code></pre><p>Por ĉiom da instalitaj pakoj listigi, plenumu:</p><pre><code>$ nix-env -q --installed</code></pre><p>Por ĉiom da haveblaj pakoj listigi, plenumu:</p><pre><code>$ nix-env -q --available</code></pre><h3><a name="nixpkgsagordajxo"></a>Agordaĵo</h3><p>La dosiero <code>&#126;/.nixpkgs/config.nix</code> estas Nix-esprimo, kiu estas legita per la Nix-komandoj. Ene, pakajn transpasojn oni povas precizigi—agordo kiu defaŭltajn agordojn uzurpas, kaj aliajn alĝustigilojn, inkluzive, sed ne limigataj al, retumilaj kromprogramoj, grafikfasadoaj agordoj, SSL, ktp.</p><p>Malpligrandigitan version de mia <code>config.nix</code> ni rigardu:</p><pre><code>{ pkgs }:

{
  packageOverrides = pkgs: {
    emacs = pkgs.emacs.override {
      withGTK2 = false;
      withGTK3 = false;
      withXwidgets = false;
    };
  };

  firefox = {
    jre = true;
    enableGoogleTalkPlugin = true;
  };

  allowUnfree = true;
}
</code></pre><p>Ĉi tio estas funkcio, kiu atribuon akceptas kiel parametro, tiam alian atributaron liveras kiel liveraĵo. Mia <i>config.nix</i> diras, ke je GTK mi ne volas havi por emakso. Por fajrfokso, mi precizigis, ke nur je JRE- kaj je Google Talk-kromprogramoj mi volas uzi. Laste, mi precizigas, ke programaroj kiuj malfermitkodajn permesilojn ne havas, aŭ programoj kiu la liberprogramaran modelon ne havas, mi volas esti kapabla por instali</p><h3><a name="nixpkgskontribui"></a>Kontribui</h3><p>La kunlaborada modelo de Nixpkgs restas sur gito kaj GitHub. Por pakon kontributi aŭ ekzistantan pakon ĝisdatigi, la <a href='https://github.com/nixos/nixpkgs/'>Nixpkgs</a>-deponejon forku al la propra GitHub-konto. Novajn ŝanĝojn kreu en nova branĉo, tiam tirpeton kreu.</p><h4><a name="nixpkgsgxisdatigi"></a>Ekzistantan pakon ĝisdatigi</h4><p>La deponejon forkinte, la propran version de la deponejon klonu:</p><pre><code>$ git clone git@github.com:vakelo/nixpkgs.git &#126;/nixpkgs</code></pre><p>Kopion de la forko ĉi tiu komando kreas en la radiko de la hejmdosierujo. Iru al tiu dosierujo, tiam la enhavojn ni esploru:</p><pre><code class="bash">$ cd &#126;/nixpkgs
$ tree -aFL 1
.
├── COPYING
├── default.nix
├── doc/
├── .editorconfig
├── .git/
├── .github/
├── .gitignore
├── lib/
├── maintainers/
├── .mention-bot
├── nixos/
├── pkgs/
├── README.md
├── .travis.yml
├── .version
└── .version-suffix

7 directories, 9 files
</code></pre><p>Sekve, pakon ni trovu kie ĝi loĝas, ekzemple, <em>GNU Hello</em>.</p><pre><code>$ grep hello pkgs/top-level/all-packages.nix
  hello = callPackage ../applications/misc/hello { };</code></pre><p>Diras, ke la pako <em>hello</em> troveblas sub <code>../applications/misc/hello</code>. Rilate al la dosiero <code>all-packages.nix</code>, la dosierindiko estas ĉe <code>pkgs/applications/misc/hello</code> aŭ <code>&#126;/nixpkgs/pkgs/applications/misc/hello</code>. Tien ni iru:</p><pre><code>$ cd pkgs/applications/misc/hello
$ ls
default.nix</code></pre><p>La dosieron <code>default.nix</code> malfermu:</p><pre><code class="nix">{ stdenv, fetchurl }:

stdenv.mkDerivation rec {
  name = &quot;hello-2.10&quot;;

  src = fetchurl {
    url = &quot;mirror://gnu/hello/${name}.tar.gz&quot;;
    sha256 = &quot;0ssi1wpaf7plaswqqjwigppsg5fyh99vdlb9kzl7c9lng89ndq1i&quot;;
  };

  doCheck = true;

  meta = {
    description = &quot;A program that produces a familiar, friendly greeting&quot;;
    longDescription = ''
      GNU Hello is a program that prints &quot;Hello, world!&quot; when you run it.
      It is fully customizable.
    '';
    homepage = http://www.gnu.org/software/hello/manual/;
    license = stdenv.lib.licenses.gpl3Plus;
    maintainers = &#91; stdenv.lib.maintainers.eelco &#93;;
    platforms = stdenv.lib.platforms.all;
  };
}
</code></pre><p>Ĉi tio diras al ni, ke la dosiero <code>default.nix</code>, estas dosiero kun parametro kiel atribuo kun du eroj. La rezulton de je <code>stdenv.mkDerivation</code> voki per enigo de atribua valaro la funkcio liveras. La valoro por la atribuo <code>name</code> estas signovico kun la formato <em>paknomo-A.B.C</em>, en kiu, <em>paknomo</em> estas la nomo de la pako kaj <em>A.B.C.</em> estas la versinombro. La valoro por la <code>src</code> atribuo estas la valoro liverita per la funkcion <code>fetchurl</code> voki, per alia atribuara argumento. La valoro por la atribuo <code>url</code> devas esti aŭ spegula specifo, kiel priskribita en <code>pkgs/build-support/fetchurl/mirrors.nix</code>, aŭ kutima retejadreso. Tiukaze, la GNU-spegulon ni uzis kaj la variablon <code>name</code> ni interpolis ene tiu signovico. La valoro de la atribuo <code>sha256</code> estas la tiu, kiun ni akiris per je <code>nix-prefetch-url</code> plenumi kontraŭ la retejadreso. Por la kontrolsumon akiri de <code>hello-2.10</code>, plenumu:</p><pre><code class="bash">$ nix-prefetch-url http://ftpmirror.gnu.org/hello/hello-2.10.tar.gz
downloading ‘http://ftpmirror.gnu.org/hello/hello-2.10.tar.gz’... &#91;622/709 KiB, 64.6 KiB/s&#93;
path is ‘/nix/store/3x7dwzq014bblazs7kq20p9hyzz0qh8g-hello-2.10.tar.gz’
0ssi1wpaf7plaswqqjwigppsg5fyh99vdlb9kzl7c9lng89ndq1i
</code></pre><p>Ĝi kongruas al la SHA256-specifo ĉi-supre.</p><p>La atribuo <code>doCheck</code> instruas al Nix la testojn plenumi por ĉi tiu pako.</p><p>La valoro de la atribuo <code>meta</code> estas alia atribuara specifo por aliaj detaloj pri la pako. Nix-programojn la valoroj precizigitaj ĉi tie helpas por la pakon klasi, inter aliaj aferoj. La celon de pako la mallonga signovico en atribuo <code>description</code> priskribas. La atribuo <code>longDescription</code> estas pli longa atribuo, eble plurlinia signovico por la pakon priskribi en pli da detalo. La atribuo <code>homepage</code> estas retejadreso al la retejo de la pako. Ĝin oni ne plu bezonas citi per unuoblaj aŭ duoblaj citiloj specife—ĝin ĝi faras interne. Retejadreson oni ankoraŭ devas citi se variablan interpolado oni uzas. La atribuo <code>platforms</code> estas grava: pakon ĝi ordas ĝuste—pakon sur makintoŝo oni ne devas munti kiu nur kuras sur linukso.</p><p>Se aperos nova versio de <em>GNU Hello</em>, ekzemple, versio 2.11, la ĝustajn atribuojn modifu. Sed unue, apartan branĉon ni kreu por tio:</p><pre><code>$ git checkout -b hello-2.11</code></pre><p>En <code>default.nix</code>, la nomon ŝanĝu al <code>hello-2.11</code> kaj la atribuon <code>sha256</code> ankaŭ ĝisdatigu. Kaj cetere, se oni estas nur NixOS, la jenan valoron aldonu al <code>/etc/nixos/configuration.nix</code>:</p><pre><code>nix.useSandbox = true;</code></pre><p>Se alian linuksan sistemon oni uzas, aŭ makintoŝon oni uzas, la jenan aldonu al <code>/etc/nix/nix.conf</code>:</p><pre><code>build-use-sandbox = relaxed</code></pre><p>Tiam, la pakon muntu:</p><pre><code>$ cd &#126;/nixpkgs
$ nix-build -A hello</code></pre><p>Se la kunmetaĵo sukcesis, aperos simbolligilo nomata <code>result</code> en la aktuala dosierujo. Ĉi tiu simbolligilo montras al dosierindiko en <code>/nix/store</code>. La programon ni plenumu:</p><pre><code>$ ./result/bin/hello
Hello, world!</code></pre><p>Bonege. La ŝanĝojn enmetu.</p><pre><code>$ git add -u
$ git commit -m 'hello: 2.10 -&gt; 2.11'
$ git push origin hello-2.11</code></pre><p>Fine, iru al la GitHub-deponeja <a href='https://github.com/nixos/nixpkgs'>paĝo</a>, tiam tirpeton inter <code>nixos/nixpkgs:master</code> kaj <code>vakelo/nixpkgs:hello-2.11</code> kreu.</p><h4><a name="nixpkgssendi"></a>Novan pakon sendi</h4><p>La paŝoj por novan pakon sendi estas preskaŭ simila de novan ĝisdatigi, krom malmultaj aferoj.</p><p>En la komenco, novan branĉon kreu por la pako:</p><pre><code>$ cd &#126;/nixpkgs
$ git checkout -b tthsum-1.3.2</code></pre><p>Tiam, decidu pri kiu kategorio ĝi devas aparteni:</p><pre><code>$ cd pkgs/applications/misc
$ mkdir tthsum</code></pre><p>Tiam, la dosieron <code>default.nix</code> kreu:</p><pre><code class="nix">{ stdenv, fetchurl }:

stdenv.mkDerivation rec {
  name = &quot;tthsum-${version}&quot;;
  version = &quot;1.3.2&quot;;

  src = fetchurl {
    url = &quot;http://tthsum.devs.nu/pkg/tthsum-${version}.tar.bz2&quot;;
    sha256 = &quot;0z6jq8lbg9rasv98kxfs56936dgpgzsg3yc9k52878qfw1l2bp59&quot;;
  };

  installPhase = ''
    mkdir -p $out/bin $out/share/man/man1
    cp share/tthsum.1.gz $out/share/man/man1
    cp obj-unix/tthsum $out/bin
  '';

  meta = with stdenv.lib; {
    description = &quot;An md5sum-alike program that works with Tiger/THEX hashes&quot;;
    longDescription = ''
      tthsum generates or checks TTH checksums &#40;root of the THEX hash
      tree&#41;. The Merkle Hash Tree, invented by Ralph Merkle, is a hash
      construct that exhibits desirable properties for verifying the
      integrity of files and file subranges in an incremental or
      out-of-order fashion. tthsum uses the Tiger hash algorithm for
      both the internal and the leaf nodes.
    '';
    homepage = http://tthsum.devs.nu/;
    license = licenses.gpl3Plus;
    maintainers = &#91; maintainers.ebzzry &#93;;
    platforms = platforms.unix;
  };
}
</code></pre><p>Oni povas rimarki, ke la anglan ni uzas ene tial, ke ĝi estas la devigita lingvo en la tutprojekto.</p><p>Kio novas ĉi tie estas la atribuo <code>installPhase</code>. La defaŭlta kunmetada procedoj de la <em>tthsum</em>-pako malsamas al la maniero, en kiu instalojn Nix traktas, do ni devas esti specifa pri tio. La <code>$out</code> identigilo signifas pri la fina dosierujo kie la programo loĝos en <code>/nix/store/</code>. En la uzantmedio, la programo haveblos ĉe <code>&#126;/.nix-profile/bin/tthsum</code>, kaj en la sistemmedio la programo haveblos ĉe <code>/run/current-system/sw/bin/tthsum</code>.</p><p>En ĉi tiu punkto, Nix ne ankoraŭ estas konscia pri <em>tthsum</em>. Ĝin ni devas deklari en la supra nivelo. Por tiel fari, la dosieron <code>pkgs/top-level/all-packages.nix</code> redaktu, kaj la jenan aldonu en la ĝusta kategorio.</p><pre><code class="nix">tthsum = callPackage ../applications/misc/tthsum { };
</code></pre><p>Tiam, la pakon muntu kiel priskribite ĉi-supre:</p><pre><code>$ cd &#126;/nixpkgs
$ nix-build -A tthsum</code></pre><p>Se ĉio sukcesis, la ŝanĝojn enmetu:</p><pre><code>$ git add pkgs/applications/misc/tthsum
$ git add pkgs/top-level/all-packages.nix
$ git commit -m &quot;tthsum: init at 1.3.2&quot;
$ git push origin tthsum-1.3.2</code></pre><p>Fine, iru al la GitHub-deponeja <a href='https://github.com/nixos/nixpkgs'>paĝo</a>, tiam tirpeton inter <code>nixos/nixpkgs:master</code> kaj <code>vakelo/nixpkgs:tthsum-1.3.2</code> kreu.</p><h3><a name="nixpkgsnotoj"></a>Notoj</h3><p>En ajna punkto dum la instalo de pako, la procezo estas interrompita, la pako ne estos instalita en duone bakita stato. La plej lasta paŝo de pakojn instali estas atoma. La sekreto, estas, simbolligilon de <code>/nix/store</code> al <code>&#126;/.nix-profile/</code>, la operacio kiu ĝin disponebligas al uzanto la sistemo kreas. La kreado de simbolligiloj en linukso kaj makintoŝo estas aŭ sukcesa aŭ ne.</p><p>Sur NixOS, la kanalo uzita de la ĉefuzanto estas grava tial, ke ĝi estas la tiu, kiun oni uzas kiam la sistemon rekunmeti per <code>nixos-rebuild switch</code> post ŝanĝoj al <code>/etc/nixos/configuration.nix</code> estas faritaj. Por certigi, ke la pravan kanalon oni uzas, ĝin listigu per:</p><pre><code>$ sudo nix-channel --list</code></pre><p>Por la ĉefuzantan kanalon ŝanĝi simila al la tiu, kiu estis uzita antaŭe:</p><pre><code>$ sudo nix-channel --add https://nixos.org/channels/nixos-unstable nixos</code></pre><h2><a name="medioj"></a>Medioj</h2><p>Medio estas maniero de Nix por komponantan izoladon provizi inter la sistemo kaj uzantoj. En NixOS, ekzistas tri medioj: sistemmedio, uzantmedio, kaj disvolvmedio.</p><h3><a name="sistemmedio"></a>Sistemmedio</h3><p>La sistemmedio estas modifita nur per la ĉefuzanto kiu ĝian valoron ĝi deklaras en <code>/etc/nixos/configuration.nix</code>. Ĝi estas listo, kiu la pakojn kiu disponebliĝos al ĉiuj uzantoj de la sistemo enhavas. Jen ekzemplo de <code>/etc/nixos/configuration.nix</code> kiu la sistemmedion uzas:</p><pre><code class="nix">{ config, lib, pkgs, ... }:

{
  ...
  environment.systemPackages = with pkgs; &#91; zsh vim &#93;;
  ...
}
</code></pre><p>Ĉi tio deklaras, ke la pakoj nomitaj <em>zsh</em> kaj <em>vim</em> disponeblos por ĉiuj uzantoj de la sistemo. La duumdosieroj disponeblos kiel <code>/run/current-system/sw/bin/zsh</code> kaj <code>/run/current-system/sw/bin/vim</code>, por Ziŝo kaj Vim, respektive.</p><p>Parenteze, nur ekzistas sur NixOS la sistemmedio.</p><h3><a name="uzantmedio"></a>Uzantmedio</h3><p>La uzantmedio estas la tiu, kiu estas uzita kiam ajn la komando <code>nix-env</code> estas uzita. Ekzemple, ziŝon instalante per nix-env:</p><pre><code>$ nix-env -iA nixos.zsh</code></pre><p>Ziŝo fariĝos specife disponebla por la uzanto kiu ĝin alvokas. Se <code>johano</code> estas la uzanto kiu tiun komandon plenumis, tiam la ziŝa duumdosiero disponebliĝos kiel <code>/home/johano/.nix-profile/bin/zsh</code>. Se ziŝon la uzanto <code>mario</code> ankoraŭ ne instalis en sia profilo, tiam ĝi ne disponeblas por ĝi. Se la saman kanalon kiel Johano, Mario havas, kaj la saman <em>nix-env</em>-komandon ĝi kuris, tiam la ziŝan programan datumon Nix ne plu bezonas elŝuti el nulo. Anstataŭe, la ziŝan programan datumon, kiu estis kreita de la procezo de Johano antaŭe, disponebligas por Mario. Tamen, se gitkopion aŭ alian version de kanaloj kontraŭ la tiu kiun Johano uzas, Mario uzas, tiam novan aperaĵon de ziŝo la alvoko de <code>nix-env</code> per Mario elŝutos.</p><h3><a name="disvolvmedio"></a>Disvolvmedio</h3><p>La tria medio, la dislovmedio, estas kreita per la uzo de nix-shell. La uzanton nix-shell permesas por sablujmediojn krei. La medio kreita estas izolita de la sistemo kaj kutimaj uzantmedioj. Je <code>/nix/store</code> la medio kreita ankoraŭ uzos, sed nek <code>/run/current-system/sw/</code> nek <code>&#126;/.nix-profile/</code> estos modifita. Kiun nix-shell disponigas estas medio, kiu estas aparta de la resto de la sistemo, la uzanton permesante por porokazajn disponigojn krei sen zorgoj pli la modifado de la sistemstato. Per tio, la kapablon por medion uzi uzanto gajnas por diversajn disponigojn de apo elprovi aŭ por eblojn kontrasti antaŭ liverado.</p><p>Por mediojn krei kiuj estas malkonektitaj al la resto de la sistemo, manieron por la dependencojn de apo kaj sia datumo mem apartigi, de kutima sistema interveno ni bezonas havi. Onin la nix-shell permesas por maldikajn nivelojn de abstraktado krei, la determinismon kaj risurcan mastrumadon de Nix mem ekspluatante.</p><p>Por ilustri, ni kontrolu, ke <a href='https://www.gnu.org/software/hello/'>GNU Hello</a> ne fakte estas ankoraŭ instalita:</p><pre><code>$ which hello
hello not found</code></pre><p>Se tio estas la kazo, bone. Aliokaze, la <em>GNU Hello</em>-pakon unue forigi.</p><p>Nu, por je nix-shell montri, je GNU Hello ni plenumu en nix-shell, tiam ĝi revenos al la kutima uzantŝelo.</p><pre><code>$ nix-shell --packages hello --pure --run hello
Hello, world!
$ which hello
hello not found</code></pre><p>Kion ĉi tio faras, estas, ke la duumpakon por GNU Hello ĝi elŝutos, puran ŝelan medion kreante, tiam progresas por la duumdosieron <code>hello</code> plenumi, kiu la konatan saluton montros al la ekrano. Se la <code>‑‑run</code> opcio estas forigita, ni faliĝos en ŝelo:</p><pre><code>$ nix-shell --packages hello --pure
&#91;nix-shell:&#126;&#93;$ hello
Hello, world!</code></pre><p>Ĉi tiu ŝelaperaĵo estas speciala tial, ke nur sufiĉan informon ĝi enhavas nur por la komandon <code>hello</code> igi disponebla. La valoron de <code>$PATH</code> ni eĉ povas kontroli ĉi tie:</p><pre><code class="bash">&#91;nix-shell:&#126;&#93;$ echo $PATH | tr ':' '\n'
/nix/store/kc912zn1ry1xilcm901ip7p8s1iqv0f1-hello-2.10/bin
/nix/store/f9q8k36x9jpi8jmdpwifcywzywpxvhrs-patchelf-0.9/bin
/nix/store/xx2bclrflkcvrddvp6bd3wsasqs7vsp1-paxctl-0.9/bin
/nix/store/4d6f8hg5gv20nsbq7b52qzn6bcs4fvlh-coreutils-8.26/bin
/nix/store/f3vl26f3n18khgq1kybnzvwjbm0r9grg-findutils-4.6.0/bin
/nix/store/mvnjpifk06yjffrsd50rpr3jjfrjsqiv-diffutils-3.5/bin
/nix/store/0xwrn1p8fp8h3cynszpgbmhmydbzhns5-gnused-4.4/bin
/nix/store/avmxym1w34sc17nrilsmgrk469l3ml0z-gnugrep-3.0/bin
/nix/store/2vh4wllg66rw61ffdfwp1xm4r2yns44j-gawk-4.1.3/bin
/nix/store/rhjsykhxrzj3ca8da6b4g6v1yx53xpi3-gnutar-1.29/bin
/nix/store/w1vlvxlavmz39by5xpnhva36q2lbi9hf-gzip-1.8/bin
/nix/store/mgvqw07ssjhf1hb96md97rjkfsrmfmp6-bzip2-1.0.6.0.1-bin/bin
/nix/store/69y0laqzizjycwaqivbsp273n0ag3ayi-gnumake-4.2.1/bin
/nix/store/86blj9iqyxwmdgkn3dyrpib1gkbmz91v-bash-4.4-p5/bin
/nix/store/qjklkl51d6qp98n8nncvbv62p01pp6qf-patch-2.7.5/bin
/nix/store/8pcap19p6qwf06ra4iaja3n6k6p2jzwg-xz-5.2.2-bin/bin
</code></pre><p>La eligo malsamos kontraŭ la mia pro la kradvaloroj en la tenejaj dosierindikoj. Ekster la teneja dosierindiko de <em>GNU Hello</em>, la ceteraj estas la minimumaj komponantoj de nix-shell-aperaĵo. Ĉi tiu sektoraro nomiĝas <em>stdenv</em>.</p><p>La dosierojn <code>shell.nix</code> aŭ <code>default.nix</code> nix-shell serĉas, en tiu ordo, en la aktuala dosierujo dum startigo, por la difinojn elŝarĝi. Ĝin ni kreu, ĝin konservante kiel <code>default.nix</code>:</p><pre><code class="nix">{ pkgs ? import &lt;nixpkgs&gt; {} }:

with pkgs;
stdenv.mkDerivation {
  name = &quot;shell&quot;;
  buildInputs = &#91; hello emem &#93;;
}
</code></pre><p><em>.nix</em>-dosiero estas Nix-esprimo. En ĉi tiu ekzemplo, ĝi estas funkcio kiu unu argumenton akceptas kun defaŭlta valoro. La bizara <code>&lt;nixpkgs&gt;</code> montras al la valoro de la atribuo <code>nixpkgs</code> deklarita en la <code>NIX&#95;PATH</code> media variablo. Sur NixOS, ĝi aspektas jene:</p><pre><code>$ echo $NIX&#95;PATH
nixpkgs=/nix/var/nix/profiles/per-user/root/channels/nixos/nixpkgs:nixos-config=/etc/nixos/configuration.nix:/nix/var/nix/profiles/per-user/root/channels</code></pre><p>En la dosierujo kiu estas montrata de la atribuo <code>nixpkgs</code>, estas <code>.git-revision</code> dosiero. Ĝian enhavon ni kontrolu:</p><pre><code>$ cat /nix/var/nix/profiles/per-user/root/channels/nixos/nixpkgs/.git-revision
1e8c01784a6a121fc94d111f4af7cc88dd932186</code></pre><p>Ĉi tio diras al ni la versio de Nixpkgs kanalojn uzanta en ĉi tiu profilo.</p><p>Iri reen, ĉiom da identigiloj en la lokamplekso la deklaro <code>with pkgs</code> metas, ilin igas videblaj. <code>stdenv</code>, kiu estis menciita antaŭe, estas atribuaro kiu inter multaj aferoj, la identigilon <code>mkDerivation</code> enhavas. <code>mkDerivation</code>, sinsekve, estas funkcio kiu unu atribuaran argumenton akceptas. Onin mi memorigas, ke unu eron de argumento kiu estas atribuaro la kunigkrampoj post <code>mkDerivation</code> precizigas; semantikan similecon al la kunigkrampoj de aliaj programlingvoj por la komencon kaj finon de funkciamplekso limigi ĝi ne havas. Estas pluraj alĝustigiloj por ĝi, tamen por la celoj de simpleco, nur je <code>name</code> kaj je <code>buildInputs</code> ni kontrolos—la apenaŭaj atribuaj parametroj.</p><p>Por nia bagatela ekzemplo, la voloro de <code>name</code> povas esti io ajn. La valoro de <code>buildInputs</code>, tamen, estas grava. Ĉi tie, ili estas deklaritaj <code>hello</code> kaj <code>emem</code>. Estas referencoj al valoroj en la <code>nixpkgs</code> markilo, kiun ni vidis antaŭe. Se je <code>with pkgs</code> ni ne uzis, la esprimo estus:</p><pre><code class="nix">{ pkgs ? import &lt;nixpkgs&gt; {} }:

pkgs.stdenv.mkDerivation {
  name = &quot;shell&quot;;
  buildInputs = &#91; pkgs.hello pkgs.emem &#93;;
</code></pre><p>Por ĉi tiun esprimon manĝigi al nix-shell, ambaŭ je <em>hello</em> kaj <em>emem</em> uzante, plenumu:</p><pre><code>$ nix-shell --pure --run &quot;hello | emem -w&quot;
&lt;p&gt;Hello, world!&lt;/p&gt;</code></pre><p>Fortajn abstraktadajn meĥanismojn nix-shell donas al ni kiuj estas rigarditaj tre malfacilaj por fari en aliaj aliroj. La determinismajn kvalitojn de Nix ĝi ekspluatas, fortan avantaĝon kreante.</p><h2><a name="surmetoj"></a> Surmetoj</h2><p>Estos tempoj en kiuj ŝanĝojn al la paksistemo oni devas fari, tamen ne pretas oni por iri tutfreneze kaj la gitdeponejon fuŝi. Ankaŭ estos tempoj en kiuj privatan deponejon oni volas havi, sed oni ne volas publikiĝi. Onin surmetoj povas helpi pri tio.</p><p>Kiel la nomo implicas, la surmeto meĥanismo estas maniero por abstraktan nivelon krei super la ekzistantaj esprimoj. Unu uzo estas samkiel benkseĝaron porti por intervjuo—vi ankoraŭ estas vi sube, sed draste ŝanĝiĝis via aspekto. Alia uzo samkiel viajn internajn organojn anstataŭigi per la kibernetikajn—vi ankoraŭ estas iomete vi, sed draste ŝanĝiĝis pluraj partoj de vi interne. Alia uzado, kiu estas unu el miaj plej ŝatataj, estas novan eston krei el virtuala nenio.</p><p>Surmetaj dosieroj estas viaj konataj Nix-esprimoj, per specifa formato. Ili loĝas en <code>&#126;/.config/nixpkgs/overlays/</code>. Se tiun dosierujon oni ne havas, ĝin oni povas krei per:</p><pre><code>$ mkdir -p &#126;/.config/nixpkgs/overlays</code></pre><p>Miajn surmetajn dosierojn mi strukturas en kiu ĉiu dosiero kongruas al unu pako, kies konduton mi volas ŝanĝi.</p><h3><a name="surmetojtranspasoj"></a> Transpasoj</h3><p>Ekzemple, se oni volas certigi ke la dokumentaro por <a href='https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/interpreters/racket/default.nix'>Rakido</a> estos instalitaj, la dosieron <code>&#126;/.config/nixpkgs/overlays/racket.nix</code> kreu per la jena enhavo:</p><pre><code class="nix">self: super: {
  racket = super.racket.override {
    disableDocs = false;
  };
}
</code></pre><p>Ĝi estas Nix-funkcio kun du argumentoj—<code>self</code> kaj <code>super</code>. <code>super</code> referencas al la esprimoj kiuj apartenas al la sistemo, dum <code>self</code> referencas al la aro de esprimoj kiujn oni difinas. Estas devige, ke estas nur du argumentoj kaj ili estas <code>self</code> kaj <code>super</code>.</p><p>Sekve, precizigu, ke por la <code>racket</code>-atributo, la <code>override</code>-funkcion ĝi vokos el la fonta tavolo, donante al ĝi atributan aron kiu la transpasojn enhavas.</p><p>Alia ekzemplo estas ke se je <a href='https://developer.chrome.com/native-client'>NaCl</a> por <a href='https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/networking/browsers/chromium/default.nix'>Chromium</a> oni volas ŝalti, la dosieron <code>&#126;/.config/nixpkgs/overlays/chromium.nix</code> kreu per la jena enhavo:</p><pre><code class="nix">self: super: {
  chromium = super.chromium.override {
    enableNaCl = true;
  };
}
</code></pre><p>Kiam je Racket aŭ je Chromium oni instalas, tiuj agordoj estos legataj kaj efektiviĝos.</p><pre><code>$ nix-env -iA $&#40;nix-channel --list | awk '{print $1}'&#41;.racket</code></pre><h3><a name="surmetojnovajpakoj"></a> Novaj pakoj</h3><p>La surmetan sistemon uzi por novajn pakojn krei estas ideala se la pakon oni ne volas doni al Nixpkgs, ĝin oni volos esti privata, aŭ novan infrastukturon oni volas aldoni sen la ekstran komplekson trakti.</p><p>Ni supozu, ke je <a href='https://github.com/ebzzry/kapo'>kapo</a>—Vagrant-helpilon—oni volas pakigi. Por tion fari, du aĵojn oni skribos:</p><ol><li>la supran surmetan dosieron en <code>&#126;/.config/nixpkgs/overlays/</code>; kaj</li><li>la Nix-esprimo kiu je <i>kapo</i> fakte kreas.</li></ol><p>Por #1, la dosieron <code>&#126;/.config/nixpkgs/overlays/kapo.nix</code> kreu per la jena enhavo:</p><pre><code>self: super: {
  kapo = super.callPackage ./pkgs/kapo { };
}
</code></pre><p>Tiam, por #2, la dosierarbon kreu por la esprimo. Tenu en la kalkulo, ke ne devigatas la nomo <code>pkgs</code>:</p><pre><code>$ cd &#126;/.config/nixpkgs/overlays
$ mkdir -p pkgs/kapo</code></pre><p>Tiam la dosieron <code>&#126;/.config/nixpkgs/overlays/pkgs/kapo/default.nix</code> keru per la jena enhavo:</p><pre><code class="nix">{ stdenv, fetchFromGitHub, bash }:

stdenv.mkDerivation rec {
  name = &quot;kapo-${version}&quot;;
  version = &quot;0.0.1&quot;;

  src = fetchFromGitHub {
    owner = &quot;ebzzry&quot;;
    repo = &quot;kapo&quot;;
    rev = &quot;abd22b4860f83fe7469e8e40ee50f0db1c7a5f2c&quot;;
    sha256 = &quot;0jh0kdc7z8d632gwpvzclx1bbacpsr6brkphbil93vb654mk16ws&quot;;
  };

  buildPhase = ''
    substituteInPlace kapo --replace &quot;/usr/bin/env bash&quot; &quot;${bash}/bin/bash&quot;
  '';

  installPhase = ''
    mkdir -p $out/bin
    cp kapo $out/bin
    chmod +x $out/bin/kapo
  '';

  meta = with stdenv.lib; {
    description = &quot;Vagrant helper&quot;;
    homepage = https://github.com/ebzzry/kapo;
    license = licenses.cc0;
    maintainers = &#91; maintainers.ebzzry &#93;;
    platforms = platforms.all;
  };
}
</code></pre><p>Per tiuj du dosieroj, je <i>kapo</i> oni nun povas instali:</p><pre><code>$ nix-env -iA $&#40;nix-channel --list | awk '{print $1}'&#41;.kapo</code></pre><h2><a name="finrimarkoj"></a>Finrimarkoj</h2><p>Potencajn ilojn por sistemojn kaj disvolvajn agordojn mastrumi facile Nix provizas. Fleksajn facilojn por rendimentajn laborfluojn kaj distrubuajn modelojn krei ĝi havas. Se la plej gravajn eblojn de la Nix-ekosistemo kiuj plaĉas al mi, mi devas listigi, ili estas:</p><ul><li>determinisme</li><li>reprodukteme</li><li>senstate</li><li>deklare</li><li>kohere</li><li>porteble</li><li>fideble</li><li>pure funkcie</li><li>transakciajn ĝisdatigojn havas</li></ul><p>Alia grava ano de la Nix-familio estas <a href='https://nixos.org/nixops'>NixOps</a>; onin permesas por je NixOS disponigi sur «nudmetalaj» sistemoj, virtualaj sistemoj, aŭ la nubo, per la uzo de deklara aliro kiu estas konata al ni. Ĝi eblas disponigi al <em>VirtualBox</em>, <em>Amazon EC2</em>, <em>Google Compute Engine</em>, <em>Microsoft Azure</em>, <em>Hetzner</em>, <em>Digital Ocean</em>, kaj <em>Libvirtd</em>. Iru al la <a href='https://nixos.org/nixops/manual/'>gvidilo</a> por pli da detalo.</p><p>Fundajn detalojn pri generadoj, derivaĵoj, kaj efektivigadoj estis eliziadoj intence, en ĉi tiu artikolo. Ili povas fariĝi sekcio per si mem, aŭ ĉi tiun artikolon mi eblas ĝisdatigi por tiujn temojn aldoni. Novan sekcion pri NixOs mi eblas skribi.</p><p>Emaksa ĉefregimo por Nix-dosieroj haveblas de la <a href='https://github.com/NixOS/nix-mode'>ĉefdeponejo</a> de NixOS. Ĝi ankaŭ haveblas per <a href='https://melpa.org/#/nix-mode'>MELPA</a>. Ĝin oni povas instali per:</p><pre><code>M-x package-install EN nix-mode EN
</code></pre><p>Ekzistas aliaj pakaj mastrumadaj sistemoj kiuj ĉi tiun problemareon ankaŭ provas solvi. La tiuj, kiujn mi konas estas <a href='http://appimage.org/'>AppImage</a>, <a href='http://0install.net/'>Zero Install</a>, <a href='https://snapcraft.io/'>Snapcraft</a>, kaj <a href='http://flatpak.org/'>Flatpak</a>.</p><p>La <a href='https://www.gnu.org/software/guix/'>Guix System Distribution (GuixSD)</a> estas linuksa distribuo kiu estas bazita sur Nix. Je <a href='https://www.gnu.org/software/guile/'>Guile</a> ĝi uzas kiel sia API-lingvo. La kerna kontrasto inter GuixSD kaj NixOS, estas, je <a href='https://www.gnu.org/software/shepherd/'>GNU Shepherd</a> la tiu uzas anstataŭ systemd; neliberajn pakojn ĝi ne permesas; kaj je <a href='https://www.fsfla.org/ikiwiki/selibre/linux-libre/'>Linux-libre</a>, malpligrandigita versio de la baza kerno kun ĉiom da komercaj aĵoj forigitaj, ĝi uzas. Pli da informo pri iliaj kontrastoj troveblas <a href='https://sandervanderburg.blogspot.de/2012/11/on-nix-and-gnu-guix.html'>ĉi tie</a>.</p><p>Ekster GuixSD, ekzistas aliaj projektoj kiujn Nix inspiris. Estas <a href='https://habitat.sh'>Habitat</a>, aplikaĵa aŭtomacia framo; kaj <a href='https://github.com/alexanderGugel/ied'>ied</a>, alterna paka administrilo por Node.js.</p><p>La artikoloj de <a href='https://lethalman.blogspot.com/2014/07/nix-pill-1-why-you-should-give-it-try.html'>Luca BRUNO</a>, <a href='https://lethalman.blogspot.com/2014/07/nix-pill-1-why-you-should-give-it-try.html'>James FISHER</a>, kaj <a href='https://web.archive.org/web/20180610095602/https://ocharles.org.uk/blog/posts/2014-02-04-how-i-develop-with-nixos.html'>Oliver CHARLES</a>, kune la <a href='https://nixos.org/nixos/manual'>NixOS</a>, <a href='https://nixos.org/nixpkgs/manual'>Nixpkgs</a>, kaj <a href='https://nixos.org/nix/manual'>Nix</a> gvidiloj, min ege helpis por je Nix kompreni. Apartaj dankoj iras al <a href='https://fare.livejournal.com'>François-René RIDEAU</a> por min enkonduki al Nix antaŭ multaj jaroj.</p><p>La NixOS-fondiĝo estas registrita senprofitcela organizo; la <a href='https://nixos.org/nixos/foundation.html'>oferdonoj</a> ege helpas en la disvolvo de Nix. Aliĝu al la <a href='https://nixos.org/nixos/community.html'>komunumo</a> kaj ĝin helpigu kreski!</p><p>La paĝa rubando kiu uziĝas supre estas de <a href='https://alpha.wallhaven.cc/wallpaper/751942'>wallhaven</a>.</p><h2><a name="bonifiko"></a>Bonifiko</h2><p>Jen la <a href='/eo/ipsilono/'>ipsilonkombinatoro</a> en Nix, aplikita al la faktoriala funkcio:</p><pre><code class="nix">nix-repl&gt; y = x: &#40;&#40;f: &#40;x &#40;v: &#40;&#40;f f&#41; v&#41;&#41;&#41;&#41; &#40;f: &#40;x &#40;v: &#40;&#40;f f&#41; v&#41;&#41;&#41;&#41;&#41;

nix-repl&gt; b = p: &#40;n: if n == 0 then 1 else &#40;n &#42; &#40;p &#40;n - 1&#41;&#41;&#41;&#41;

nix-repl&gt; f = y b

nix-repl&gt; f 20
2432902008176640000
</code></pre><p>aŭ, en unu esprimo, per <em>let</em>:</p><pre><code class="nix">nix-repl&gt; let y = x: &#40;&#40;f: &#40;x &#40;v: &#40;&#40;f f&#41; v&#41;&#41;&#41;&#41; &#40;f: &#40;x &#40;v: &#40;&#40;f f&#41; v&#41;&#41;&#41;&#41;&#41;;
              b = p: &#40;n: if n == 0 then 1 else &#40;n &#42; &#40;p &#40;n - 1&#41;&#41;&#41;&#41;;
              f = y b;
          in f 20
2432902008176640000
</code></pre><p>La ĉefeligujon oni povas konduki al nix-repl:</p><pre><code class="nix">$ echo 'let y = x: &#40;&#40;f: &#40;x &#40;v: &#40;&#40;f f&#41; v&#41;&#41;&#41;&#41; &#40;f: &#40;x &#40;v: &#40;&#40;f f&#41; v&#41;&#41;&#41;&#41;&#41;; b = p: &#40;n: if n == 0 then 1 else &#40;n &#42; &#40;p &#40;n - 1&#41;&#41;&#41;&#41;; f = y b; in f 20' | nix-repl
Welcome to Nix version 1.11.8. Type :? for help.

nix-repl&gt; let y = x: &#40;&#40;f: &#40;x &#40;v: &#40;&#40;f f&#41; v&#41;&#41;&#41;&#41; &#40;f: &#40;x &#40;v: &#40;&#40;f f&#41; v&#41;&#41;&#41;&#41;&#41;; b = p: &#40;n: if n == 0 then 1 else &#40;n &#42; &#40;p &#40;n - 1&#41;&#41;&#41;&#41;; f = y b; in f 20
2432902008176640000

nix-repl&gt;
</code></pre><hr/><div class="footer"><p><div class="text-small"> <a href='/eo/'>Hejmo</a> ▪ <a href='/eo/pri/'>Pri</a> ▪ <a href='/eo/citajxoj/'>Citaĵoj</a> ▪ <a href='/eo/pripensoj/'>Pripensoj</a> ▪ <a href='https://github.com/ebzzry/ebzzry.github.io'>Fonto</a> </div> <div class="text-x-small"> Kreite per <a href='https://github.com/ebzzry/emem'>emem</a> </div></p><p><div class="text-x-small"> <a rel="license" href="https://creativecommons.org/publicdomain/zero/1.0/deed.eo"><img alt="CC0 1.0 Universala (CC0 1.0) Publikaĵiga Dediĉo" class="cc" src="/bil/cc0-88x31.png" /></a><br> Ĉi tiu verko estas <a rel="license" href="https://creativecommons.org/publicdomain/zero/1.0/deed.eo">publika havaĵo.</a><br> </div></p><p></div></p></div><script src="/static/js/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create', 'UA-93746003-1', 'auto');ga('send', 'pageview');</script></body></html>