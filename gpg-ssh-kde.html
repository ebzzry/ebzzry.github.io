<!DOCTYPE html>
<html><head><title>GPG and SSH in KDE</title><meta charset="utf-8" /><meta content="max-age=86400" http-equiv="Cache-control" /><meta content="width=device-width,initial-scale=1.0,user-scalable=yes" name="viewport" /><meta content="noodp,noydir" name="robots" /><meta content="A journal about computing, human predilections, and random krakaboom." name="description" /><meta content="rommel, martinez, rommel martinez, y, y combinator, lambda, lambda calculus, lisp, scheme, racket, clojure, haskell, fallacies, symbols, marks, symbols and marks, emacs, emacs hacks, dired, retrospect, livefrog, usync, essays, english, esperanto, verb tenses, git, github, primer, introduction, linux, macos, kvm, frog, ugarit, gpg, ssh, division by zero, communicate, human, communicate like a human, krakaboom, human predilections, predilections, computing, inspiration, quotes, famous quotes, words, emem" name="keywords" /><link href="static/ico/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180" /><link href="static/ico/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" /><link href="static/ico/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" /><link href="static/ico/manifest.json" rel="manifest" /><link color="#5bbad5" href="static/ico/safari-pinned-tab.svg" rel="mask-icon" /><meta content="#ffffff" name="theme-color" /><style media="all" type="text/css">html {    color: #333;    font-size: 1em;    font-family: Georgia, Cambria, Palatino, "Palatino Linotype", "Times New Roman", Times, serif;    line-height: 1.45;    text-align: left:    width: 100%;    max-width: 40em;    margin: 0 auto 0 auto;    padding: 0;}body {    border-top: hidden;    border-bottom: hidden;    padding: 0 1.5em 1em 1.5em;    margin: 0;}#content {    -webkit-column-count: 1;    -moz-column-count: 1;    column-count: 1;}code {    font-size: 0.9em;    font-family: "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Lucida Console", "Courier New", Courier, monospace;    color: black;    display: inline-block;    font-weight: bold;}pre code {    font-size: 1em;    font-family: monospace;    line-height: 1.3em;    overflow: auto;    font-weight: normal;}kbd {    font-size: 1.1em;    padding: 0.1em 0.6em;    border: 1px solid #ccc;    font-family: monospace;    background-color: #f7f7f7;    color: #333;    -moz-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    -webkit-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    -moz-border-radius: 3px;    -webkit-border-radius: 3px;    border-radius: 3px;    display: inline-block;    margin: 0 0.1em;    text-shadow: 0 1px 0 #fff;    white-space: nowrap;}h1, h2, h3, h4, h5, h6 {    font-family: Calibri, "Gill Sans", "Gill Sans MT", "Myriad Pro", Myriad, "DejaVu Sans", Tahoma, Geneva, Helvetica, Arial, sans-serif;    margin-bottom: 0;}h1 {    font-size: 2.5em;    text-align: center;    border-bottom: 6px solid black;}h2 {    font-size: 2.0em;    text-align: left;    border-bottom: 2px solid black;}h3 {    font-size: 1.6em;    text-align: left;    border-bottom: 1px solid lightgrey;}h4 {    font-size: 1.5em;    text-align: left;}h5 {    font-size: 1.3em;    text-align: left;}ul, ol {    padding-left: 2em;}ul li {    list-style-type: square;}ul li li {    list-style-type: disc;}ul li li li {    list-style-type: circle;}ol li {    list-style-type: decimal;}p, para, b, strong, i, em, emph {    font-size: 1em;}blockquote {    font-size: 1.2em;    font-style: italic;    margin-left: 2em;}b, strong {    font-weight: bold;}i, em, emph {    font-style: italic;}table {    margin: 0.5em;    border-spacing: 0;    border-collapse: collapse;}th, td {    border: 1px solid lightgray;    padding-top: 0;    padding-bottom: 0;    padding-left: 0.45em;    padding-right: 0.45em;}</style><style media="all" type="text/css">/* Ewan Themes -- based 99.99% from Tomorrow Night Theme *//* http://jmblog.github.com/color-themes-for-google-code-highlightjs *//* Original theme - https://github.com/chriskempson/tomorrow-theme *//* http://jmblog.github.com/color-themes-for-google-code-highlightjs *//* Tomorrow Comment */.hljs-comment {  color: #969896;}/* Tomorrow Red */.hljs-variable,.hljs-attribute,.hljs-tag,.hljs-regexp,.ruby .hljs-constant,.xml .hljs-tag .hljs-title,.xml .hljs-pi,.xml .hljs-doctype,.html .hljs-doctype,.css .hljs-id,.css .hljs-class,.css .hljs-pseudo {  color: #cc6666;}/* Tomorrow Orange */.hljs-number,.hljs-preprocessor,.hljs-pragma,.hljs-built_in,.hljs-literal,.hljs-params,.hljs-constant {  color: #de935f;}/* Tomorrow Yellow */.ruby .hljs-class .hljs-title,.css .hljs-rule .hljs-attribute {  color: #f0c674;}/* Tomorrow Green */.hljs-string,.hljs-value,.hljs-inheritance,.hljs-header,.hljs-name,.ruby .hljs-symbol,.xml .hljs-cdata {  color: #b5bd68;}/* Tomorrow Aqua */.hljs-title,.css .hljs-hexcolor {  color: #8abeb7;}/* Tomorrow Blue */.hljs-function,.python .hljs-decorator,.python .hljs-title,.ruby .hljs-function .hljs-title,.ruby .hljs-title .hljs-keyword,.perl .hljs-sub,.javascript .hljs-title,.coffeescript .hljs-title {  color: #81a2be;}/* Tomorrow Purple */.hljs-keyword,.javascript .hljs-function {  color: #b294bb;}.hljs {  display: block;  overflow-x: auto;  background: #1d1f21;  color: #c5c8c6;  padding: 0.5em;  -webkit-text-size-adjust: none;}.coffeescript .javascript,.javascript .xml,.tex .hljs-formula,.xml .javascript,.xml .vbscript,.xml .css,.xml .hljs-cdata {  opacity: 0.5;}pre code {    font-size: 1.1em;    font-family: monospace;    line-height: 1.3em;    overflow: auto;}</style></head><body><div id="content"><h1>GPG and SSH in KDE</h1><p><center>September 17, 2014</center> <center>Updated: May 13, 2016</center></p><p>When both GPG and SSH are integrated with KDE, it makes inter-operating with those systems very easy. It will make the difference between a loose-fitting glove, and one that fits snugly.</p><p>This quick tutorial will go over the steps on how to go about it. To accommodate everyone, I’ll still go about how to install and configure all the necessary components.</p><h2>Table of contents</h2><ul><li><a href='#prerequisites'>Prerequisites</a></li><li><a href='#ssh'>Configure SSH</a></li><li><a href='#gpg'>Configure GPG</a></li><li><a href='#kde'>Configure KDE</a></li><li><a href='#verification'>Verification</a></li><li><a href='#closing'>Closing remarks</a></li></ul><h2>Prerequisites <a name="prerequisites"></a></h2><p>For this tutorial you need to have GPG, SSH, and Pinentry.</p><p>Nix:</p><pre><code class="bash">$ nix-env -i gnupg openssh pinentry
</code></pre><p>APT:</p><pre><code class="bash">$ sudo apt-get install gnupg2 ssh pinentry-qt4
</code></pre><p>DNF:</p><pre><code class="bash">$ sudo dnf install gnupg openssh pinentry
</code></pre><h2>Configure SSH <a name="ssh"></a></h2><p>Now that you have the parts in front of you, it’s time to assemble them. The first thing that you need to do (although in reality the files that you are going to open in this section can be done in any order that you wish), is create your SSH keys:</p><pre><code class="bash">$ ssh-keygen -t rsa
</code></pre><p><strong>DO NOT</strong> leave the passphrase empty. If you really insist, then shoot yourself, in the head.</p><p>The above command will create two files:</p><pre><code>&#126;/.ssh/id&#95;rsa.pub
&#126;/.ssh/id&#95;rsa
</code></pre><p>Next, authorize yourself on the remote server, so that password-less logins will be avaible later:</p><pre><code class="bash">$ ssh-copy-id user@host
</code></pre><h2>Configure GPG <a name="gpg"></a></h2><p>You need to create next your GPG keys. Follow the prompts that follow, making sure that you select the strongest options:</p><pre><code class="bash">$ gpg2 --gen-key
</code></pre><p>If you want to generate "better" passwords, use the <a href='http://world.std.com/~reinhold/diceware.html'>Diceware method</a>. An <a href='https://xkcd.com/936/'>XKCD comic</a> was drawn in case you’re wondering what it is.</p><p>The next thing to do is edit the main GPG config file:</p><pre><code class="bash">$ emacs &#126;/.gnupg/gpg.conf
</code></pre><p>Find the line that contains <code>use-agent</code> and uncomment it, if it is commented. If that line does not exist just put <code>use agent</code> at the end of that file:</p><p>You need to edit the agent file, next:</p><pre><code class="bash">$ emacs &#126;/.gnupg/gpg-agent.conf
</code></pre><p>Then put the following lines:</p><pre><code>no-grab
default-cache-ttl 10800
default-cache-ttl-ssh 10800
pinentry-program /usr/bin/pinentry-qt4
</code></pre><p>Those are <i>my</i> preferred values. If you want to change them, look at the manpage:</p><pre><code class="bash">$ man gpg-agent
</code></pre><h2>Configure KDE <a name="kde"></a></h2><p>You now need to link the GPG agent with KDE. You need to create a <i>startup</i> script for KDE that will invoke the GPG agent at startup. You also need to tell the GPG agent to enable SSH support (in the old days, the SSH agent has to be ran separately from GPG).</p><pre><code class="bash">$ mkdir &#126;/.kde/env
$ emacs &#126;/.kde/env/01&#95;gpg-agent.sh
</code></pre><p>Then put in the following lines:</p><pre><code class="bash">#!/bin/sh

killall gpg-agent
eval `gpg-agent --enable-ssh-support --daemon`
</code></pre><p>Make it executable:</p><pre><code class="bash">$ chmod +x &#126;/.kde/env/01&#95;gpg-agent.sh
</code></pre><p>Finally, create the <i>shutdown</i> script for the GPG agent:</p><pre><code class="bash">$ mkdir &#126;/.kde/shutdown
$ emacs &#126;/.kde/shutdown/01&#95;gpg-agent.sh
</code></pre><p>Then put in the following lines:</p><pre><code class="bash">#!/bin/sh

killall gpg-agent
</code></pre><p>Make it executable, too:</p><pre><code class="bash">$ chmod +x &#126;/.kde/shutdown/01&#95;gpg-agent.sh
</code></pre><h2>Verification <a name="verification"></a></h2><p>Unfortunately, you have to restart your KDE session for these settings to take effect. If you know a method that doesn’t require restarting the session, please let me know.</p><p>Press <kbd>Ctrl+Alt+Del</kbd> to logout, then login with your account.</p><p>Open a Konsole window, then connect to your favorite SSH server:</p><pre><code class="bash">$ ssh user@remotehost
</code></pre><p>A pinentry dialog box should appear prompting you for your passphrase. This passphrase will be cached according to your settings in <code>&#126;/.gnupg/gpg-agent.conf</code>. Subsequent SSH connection attempts will not prompt you for the passphrase within this timeout period.</p><p>A similar behavior will happen if you encrypt a file with GPG:</p><pre><code class="bash">$ gpg2 -sea -r john@remotehost file.dat
</code></pre><h2>Closing remarks <a name="closing"></a></h2><p>The steps outline above are meant to be succinct without going through the gory details. I avoided reiterating what was already said before so as not to bore you to death. If you found this useful, feel free to comment below.</p><hr/><div style="text-align: right; float: right; max-width: 18em;"><div style="font-size: small;"><a href='index.html'>Home</a>  <a href='about.html'>About</a>  <a href='quotes.html'>Quotes</a>  <a href='words.html'>Words</a>  <a href='https://github.com/ebzzry/ebzzry.github.io'>Source</a></div><div style="font-size: x-small">Site created with <a href='https://github.com/ebzzry/emem'>emem</a></div><p><div style="font-size: x-small"> <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="images/cc4-88x31.png" /></a><br> This work by <a xmlns:cc="http://creativecommons.org/ns#" href="https://ebzzry.github.io" property="cc:attributionName" rel="cc:attributionURL">Rommel M. Martinez</a> is licensed under a<br> <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Common Attribution 4.0 International License</a>. </div></p><p></div></p></div><script src="static/js/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></body></html>