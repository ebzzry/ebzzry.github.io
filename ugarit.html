<!DOCTYPE html>
<html><head><title>An Introduction to Ugarit</title><meta charset="utf-8" /><meta contents="max-age=86400" http-equiv="Cache-control" /><meta content="width=device-width,initial-scale=1.0,user-scalable=yes" name="viewport" /><link href="static/ico/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180" /><link href="static/ico/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png" /><link href="static/ico/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png" /><link href="static/ico/manifest.json" rel="manifest" /><link color="#5bbad5" href="static/ico/safari-pinned-tab.svg" rel="mask-icon" /><meta content="#ffffff" name="theme-color" /><style media="all" type="text/css">html {    color: #333;    font-size: 1em;    font-family: Georgia, Cambria, Palatino, "Palatino Linotype", "Times New Roman", Times, serif;    line-height: 1.45;    text-align: left:    width: 100%;    max-width: 40em;    margin: 0 auto 0 auto;    padding: 0;}body {    border-top: hidden;    border-bottom: hidden;    padding: 0 1.5em 1em 1.5em;    margin: 0;}#content {    -webkit-column-count: 1;    -moz-column-count: 1;    column-count: 1;}code {    font-size: 0.9em;    font-family: "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Lucida Console", "Courier New", Courier, monospace;    color: black;    display: inline-block;    font-weight: bold;}pre code {    font-size: 1em;    font-family: monospace;    line-height: 1.3em;    overflow: auto;    font-weight: normal;}kbd {    font-size: 1.1em;    padding: 0.1em 0.6em;    border: 1px solid #ccc;    font-family: monospace;    background-color: #f7f7f7;    color: #333;    -moz-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    -webkit-box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    box-shadow: 0 1px 0px rgba(0, 0, 0, 0.2),0 0 0 2px #ffffff inset;    -moz-border-radius: 3px;    -webkit-border-radius: 3px;    border-radius: 3px;    display: inline-block;    margin: 0 0.1em;    text-shadow: 0 1px 0 #fff;    white-space: nowrap;}h1, h2, h3, h4, h5, h6 {    font-family: Calibri, "Gill Sans", "Gill Sans MT", "Myriad Pro", Myriad, "DejaVu Sans", Tahoma, Geneva, Helvetica, Arial, sans-serif;    margin-bottom: 0;}h1 {    font-size: 2.5em;    text-align: center;    border-bottom: 6px solid black;}h2 {    font-size: 2.0em;    text-align: left;    border-bottom: 2px solid black;}h3 {    font-size: 1.6em;    text-align: left;    border-bottom: 1px solid lightgrey;}h4 {    font-size: 1.5em;    text-align: left;}h5 {    font-size: 1.3em;    text-align: left;}ul, ol {    padding-left: 2em;}ul li {    list-style-type: square;}ul li li {    list-style-type: disc;}ul li li li {    list-style-type: circle;}ol li {    list-style-type: decimal;}p, para, b, strong, i, em, emph {    font-size: 1em;}blockquote {    font-size: 1.2em;    font-style: italic;    margin-left: 2em;}b, strong {    font-weight: bold;}i, em, emph {    font-style: italic;}table {    margin: 0.5em;    border-spacing: 0;    border-collapse: collapse;}th, td {    border: 1px solid lightgray;    padding-top: 0;    padding-bottom: 0;    padding-left: 0.45em;    padding-right: 0.45em;}</style><style media="all" type="text/css">/* Ewan Themes -- based 99.99% from Tomorrow Night Theme *//* http://jmblog.github.com/color-themes-for-google-code-highlightjs *//* Original theme - https://github.com/chriskempson/tomorrow-theme *//* http://jmblog.github.com/color-themes-for-google-code-highlightjs *//* Tomorrow Comment */.hljs-comment {  color: #969896;}/* Tomorrow Red */.hljs-variable,.hljs-attribute,.hljs-tag,.hljs-regexp,.ruby .hljs-constant,.xml .hljs-tag .hljs-title,.xml .hljs-pi,.xml .hljs-doctype,.html .hljs-doctype,.css .hljs-id,.css .hljs-class,.css .hljs-pseudo {  color: #cc6666;}/* Tomorrow Orange */.hljs-number,.hljs-preprocessor,.hljs-pragma,.hljs-built_in,.hljs-literal,.hljs-params,.hljs-constant {  color: #de935f;}/* Tomorrow Yellow */.ruby .hljs-class .hljs-title,.css .hljs-rule .hljs-attribute {  color: #f0c674;}/* Tomorrow Green */.hljs-string,.hljs-value,.hljs-inheritance,.hljs-header,.hljs-name,.ruby .hljs-symbol,.xml .hljs-cdata {  color: #b5bd68;}/* Tomorrow Aqua */.hljs-title,.css .hljs-hexcolor {  color: #8abeb7;}/* Tomorrow Blue */.hljs-function,.python .hljs-decorator,.python .hljs-title,.ruby .hljs-function .hljs-title,.ruby .hljs-title .hljs-keyword,.perl .hljs-sub,.javascript .hljs-title,.coffeescript .hljs-title {  color: #81a2be;}/* Tomorrow Purple */.hljs-keyword,.javascript .hljs-function {  color: #b294bb;}.hljs {  display: block;  overflow-x: auto;  background: #1d1f21;  color: #c5c8c6;  padding: 0.5em;  -webkit-text-size-adjust: none;}.coffeescript .javascript,.javascript .xml,.tex .hljs-formula,.xml .javascript,.xml .vbscript,.xml .css,.xml .hljs-cdata {  opacity: 0.5;}pre code {    font-size: 1.1em;    font-family: monospace;    line-height: 1.3em;    overflow: auto;}</style></head><body><div id="content"><h1>An Introduction to Ugarit</h1><p><center>February 21, 2014</center> <center>Updated: May 13, 2016</center></p><p>How many times have you experienced hindsight, after a catastrophic event has happened? how many times have you told yourself that had you created backups of your precious data, you wouldn’t be in that dire situation, pulling your hair out, like a rabid maniac?</p><p>Most of us have been there — we lost our precious files due inadvertent causes. We lost them because of disk crash, data corruption, security breach, and other reasons. But had we created a fallback, a big, safe foam that we can land on, it wouldn’t have been a lot of trouble, and heart ache. On the flip side, creating and managing backups can be daunting, and equally dangerous.</p><p>In this post, I’ll talk about <a href='http://www.kitten-technologies.co.uk/project/ugarit/doc/trunk/README.wiki'>Ugarit</a> , a nice piece of technology, that combines ease-of-use, and security, in a single tool.</p><h2>Table of contents</h2><ul><li><a href='#introduction'>Introduction</a></li><li><a href='#installation'>Installation</a><ul><li><a href='#apt'>APT</a></li><li><a href='#nix'>Nix</a></li></ul></li><li><a href='#configuration'>Configuration</a></li><li><a href='#basic'>Basic usage</a><ul><li><a href='#create'>Creating snapshots</a></li><li><a href='#explore'>Exploring snapshots</a></li><li><a href='#extract'>Extracting snapshots directly</a></li></ul></li><li><a href='#tips'>Tips</a><ul><li><a href='#remote'>Remote filesystem</a></li><li><a href='#miscellany'>Miscellany</a></li></ul></li><li><a href='#notes'>Notes</a></li></ul><h2>Introduction <a name="introduction"></a></h2><p>Ugarit is a classic example of a tool, that requires minimal setup and configuration, but is used many times. That, once the initial tinkering is done, all you need to do is reuse the tool. But that isn’t Ugarit’s main strength — it is the almost unholy marriage, of convenience and security.</p><p>Most, if not all the time, convenience is inversely proportional to security. That is, the more convenient something is, the less secure it is. With Ugarit, creating and managing backups is as easy as typing a short command.</p><h2>Installation <a name="installation"></a></h2><h3>APT <a name="apt"></a></h3><p>First, you need to install <a href='http://www.call-cc.org/'>Chicken</a>. Most likely, it can be installed via your package manager:</p><pre><code class="bash">$ sudo apt-get install chicken-bin
</code></pre><p>If it isn’t available on your system, you may download it from <a href='http://code.call-cc.org/'>code.call-cc.org</a></p><p>After Chicken is installed, let’s install Ugarit itself, and its dependencies:</p><pre><code class="bash">$ chicken-install -s ugarit tiger-hash aes
</code></pre><p>After this command completes, the command <code>ugarit</code> will become available. To display usage:</p><pre><code class="bash">$ ugarit -h
</code></pre><h3>Nix <a name="nix"></a></h3><p>If you’re using Nix, just run the following command:</p><pre><code>$ nix-env -iA ugarit
</code></pre><h2>Configuration <a name="configuration"></a></h2><p>Ugarit at this point isn’t usable yet — you need to specify where should it store the snapshots. When creating a snapshot of a directory several terabytes big, it is ideal to store the data on a fast, reliable, stress-tolerant disk. It is not uncommon for the command <code>ls</code> to experience a noticeable lag when ran inside the data directory. Let’s presume that <code>/dev/sdb1</code> is a large filesystem and you want to mount it to <code>/ugarit/</code>.</p><pre><code class="bash">$ sudo mkdir /ugarit
$ sudo mount /dev/sdb1 /ugarit
$ sudo chown -R $USER /ugarit
</code></pre><p>Another, equally important requirement that you need to have is its config file, usually named <code>ugarit.conf</code>. It is supplied as part of the required command line arguments. It is important to note, that this file does not reside in a fixed location, in contrast with some programs that look for a config file at start-up, from <code>&#126;/</code>. But before you actually create that file, you need to run some commands. Save the outputs of these commands, because you’ll be needing them later:</p><p>Create a salt, for the hash function:</p><pre><code class="bash">$ dd if=/dev/random bs=1 count=64 2&gt;/dev/null | base64 -w 0 | tail -1
</code></pre><p>Create a key, for the vault:</p><pre><code class="bash">$ dd if=/dev/random bs=32 count=1 2&gt;/dev/null | od -An -tx1 \
| tr -d ' \t\n'
</code></pre><p>After you run those commands, you’ll create the config file, <code>ugarit.conf</code>. To make it consistent with the example above, you’ll store it inside <code>/ugarit</code>:</p><pre><code class="bash">$ emacs /ugarit/ugarit.conf
</code></pre><p>Put the following, replacing SALT, and KEY, with the salt and key strings that you generated above. Save the file, then secure it.</p><pre><code class="scheme">&#40;storage &quot;backend-fs splitlog /ugarit /ugarit/metadata&quot;&#41;
&#40;file-cache &quot;/ugarit/cache&quot;&#41;
&#40;hash tiger &quot;SALT&quot;&#41;
&#40;encryption aes &quot;KEY&quot;&#41;
&#40;compression deflate&#41;
</code></pre><p>Save the file, then secure it.</p><pre><code class="bash">$ chmod 600 /ugarit/ugarit.conf
</code></pre><h2>Basic usage <a name="basic"></a></h2><h3>Creating snapshots <a name="create"></a></h3><p>To create a snapshot, run:</p><pre><code class="bash">$ ugarit snapshot /ugarit/ugarit.conf TAG DIRECTORY
</code></pre><p><i>TAG</i> is a name that you will identify the snapshot with later, while <i>DIRECTORY</i> is the filesystem tree that you will create a snapshot of. To create, for example, a snapshot of the directory <code>pictures/</code>, with the tag <code>pix</code>, run Ugarit like this:</p><pre><code class="bash">$ ugarit snapshot /ugarit/ugarit.conf pix pictures
</code></pre><p>After the snapshot, you’ll see something similar to the following:</p><pre><code class="bash">Archiving pictures to tag pix...
Root hash: ddc888c86db6d7c468a27cc4af9b2907d219936df82e0971
Successfully snapshotted pictures to tag pix
Snapshot hash: ab290399f31fff1e3158c0ede8f90f59b2b41387af48f597
Written 910460 bytes to the vault in 4 blocks, and reused 0 bytes in 0 blocks
&#40;before compression&#41;
File cache has saved us 1 file hashings / 638104 bytes &#40;before compression&#41;
</code></pre><h3>Exploring Snapshots <a name="explore"></a></h3><p>To interactively manage the contents of the vault, run:</p><pre><code class="bash">$ ugarit explore /ugarit/ugarit.conf
</code></pre><p>To list the available commands:</p><pre><code class="bash">&gt; help
</code></pre><p>Taking hints from the help usage, you’ll extract a directory, that was part of the snapshot earlier. Let’s say that the original path of that directory was <code>pictures/holiday</code>. So, to extract the directory <code>holiday/</code> to the current directory, run:</p><pre><code class="bash">&gt; cd pix
/pix&gt; cd current
/pix/current&gt; cd contents
/pix/current/contents&gt; get holiday
Extracted holiday
/pix/current/contents&gt; exit
</code></pre><h3>Extracting Snapshots Directly <a name="extract"></a></h3><p>If, however, you know the exact path to a file or directory that you want to extract, you can instead run Ugarit with the extract mode. To extract the directory <code>holiday/</code> from above, directly, run:</p><pre><code class="bash">$ ugarit extract /ugarit/ugarit.conf /pix/current/contents/holiday
</code></pre><h2>Tips <a name="tips"></a></h2><h3>Remote filesystems <a name="remote"></a></h3><p>Ugarit is not limited to creating snapshots of a local filesystem. It can also be used to create snapshots of trees, from a remote host, mounted locally. If you have an <a href='http://fuse.sourceforge.net/sshfs.html'>SSHFS</a> mount, for example, you can still create a snapshot of it, just like any other local filesystem:</p><pre><code class="bash">$ sshfs remotehost:/ &#126;/mnt/sshfs/remotehost
$ cd &#126;/mnt/sshfs
$ ugarit snapshot /ugarit/ugarit.conf remotehost
</code></pre><p>The same applies to <a href='http://www.samba.org/samba/smbfs/'>SMBFS</a> mounts:</p><pre><code class="bash">$ sudo mount -t cifs -o user=$USER,uid=$USER //winhost/c \
&#126;/mnt/smbfs/winhost/c
$ cd &#126;/mnt/smbfs
$ ugarit snapshot /ugarit/ugarit.conf winhost
</code></pre><h3>Miscellany <a name="miscellany"></a></h3><p>To disable output, when creating snapshots:</p><pre><code class="bash">$ ugarit snapshot /ugarit/ugarit.conf -q ...
</code></pre><p>To enable very verbose output:</p><pre><code class="bash">$ ugarit snapshot -:a256 /ugarit/ugarit.conf ...
</code></pre><h2>Notes <a name="notes"></a></h2><p>When you are doubtful of the performance of the disk where you’ll be storing the snapshots, disable the <a href='http://linux.about.com/library/cmd/blcmdl1_updatedb.htm'>locate and updatedb</a> service. It is usually run periodically via cron. It places a lot of load on the disk, and may over-stress it. Your mileage may vary. If, however, you need that service, create an exclusion for the file system where you store the snapshots.</p><p>An important caveat worth mentioning is that, due to the way Ugarit works, snapshot deletions do not exist. The storage mechanism works similarly to Git, only that there is no rebase option.</p><p>Ugarit was created by <a href='http://www.snell-pym.org.uk/alaric/'>Alaric Snell-Pym</a>. If you want to learn more about it, head over to <a href="http://www.kitten-technologies.co.uk/project/ugarit/doc/trunk/README.wiki">http://www.kitten-technologies.co.uk/project/ugarit/doc/trunk/README.wiki</a>. To report bugs, go to <a href="http://www.kitten-technologies.co.uk/project/ugarit/reportlist">http://www.kitten-technologies.co.uk/project/ugarit/reportlist</a>.</p><hr/><div style="text-align: right; float: right; max-width: 18em;"><div style="font-size: small;"><a href='index.html'>Home</a>  <a href='about.html'>About</a>  <a href='quotes.html'>Quotes</a>  <a href='words.html'>Words</a>  <a href='https://github.com/ebzzry/ebzzry.github.io'>Source</a></div><div style="font-size: x-small">Site created with <a href='https://github.com/ebzzry/emem'>emem</a></div><p><div style="font-size: x-small"> <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="images/cc4-88x31.png" /></a><br> This work by <a xmlns:cc="http://creativecommons.org/ns#" href="https://ebzzry.github.io" property="cc:attributionName" rel="cc:attributionURL">Rommel M. Martinez</a> is licensed under a<br> <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Common Attribution 4.0 International License</a>. </div></p><p></div></p></div><script src="static/js/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></body></html>